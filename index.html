<html>

<head>
    <title>项目</title>
    <link rel="stylesheet" type="text/css" href="http://map.x3platform.com/dijit/themes/x3platform/x3platform.css">
    <link rel="stylesheet" href="http://map.x3platform.com/esri/css/esri.css">
    <style type="text/css">
        html,
        body,
        #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0
        }
        
        #borderContainer {
            width: 100%;
            height: 100%
        }
    </style>
</head>
<!-- 根据实际情况 配置 packages 信息 
local - packages:[{name: 'cw',location: '/arcgis/examples/cw'},{name: 'views',location: '/arcgis/examples/views'}]
-->
<script type="text/javascript" src="http://map.x3platform.com/dojo/dojo.js" data-dojo-config="parseOnLoad: true"></script>
<script type="text/javascript">
    var map;

    require([
        "cw/basemap",
        "esri/map",
        "dojo/parser",
        "dojo/on",
        "dojo/dom",
        "dojo/dom-construct",
        "dojo/store/Memory",
        "dijit/registry",
        "dijit/Dialog",
        "dijit/Tree",
        "dijit/tree/ObjectStoreModel",
        "dijit/layout/ContentPane",
        "dijit/layout/BorderContainer",
        "dijit/layout/AccordionContainer",
        "dojo/domReady!"
    ], function (
        basemap,
        Map,
        parser,
        on,
        dom,
        domConstruct,
        Memory,
        registry,
        Dialog,
        Tree,
        ObjectStoreModel,
        ContentPane
    ) {
            parser.parse();

            // Create test store, adding the getChildren() method required by ObjectStoreModel
            var myStore = new Memory({
                data: [
                    { id: 'root', name: '地图演示', type: 'planet', population: '6 billion' },
                    { id: 'quanzhou', name: '泉州', parent: 'root' },
                    { id: 'quanzhou-1', name: '摄像头信息', parent: 'quanzhou', href: 'cw/_examples/cw-quanzhou-camera.html', iframe: true },
                    { id: 'quanzhou-2', name: '区域信息', parent: 'quanzhou', href: 'cw/_examples/cw-quanzhou-regions.html', iframe: true },
                    { id: 'quanzhou-3', name: '路径信息', parent: 'quanzhou', href: 'cw/_examples/cw-quanzhou-directions.html', iframe: true },
                    { id: 'NAc', name: '表单信息', parent: 'root', href: 'cw/_examples/cw-form.html', iframe: true },
                    { id: 'NAc', name: '百度', parent: 'root', href: 'http://www.baidu.com', iframe: true },
                    { id: 'SA', name: '全城布控', parent: 'root', contentPane: 'views/map/CityControlMap', options: { cameraXhrUrl: 'cw/_examples/data/camera.json' } }
                ],
                getChildren: function (object) {
                    return this.query({ parent: object.id });
                }
            });

            // Create the model
            var myModel = new ObjectStoreModel({
                store: myStore,
                query: { id: 'root' }
            });

            // Create the Tree.
            var tree = new Tree({
                model: myModel
            }, 'treeView');

            tree.on('click', clickTreeNode);

            /**
             * item /*点中节点对应的数据项
             * node 点中的对象，这里node.item就是的第一个参数
             * evt  事件
             */
            function clickTreeNode(item, node, evt) {
                console.log(item);

                var tabs = registry.byId("windowTabContainer");

                var pane = null;
                var paneId = 'menu-tab-' + item.id;

                tabs.getChildren().forEach(function (tab) {
                    if (tab.id == paneId) {
                        pane = tab;
                    }
                });

                if (!pane) {
                    if (item.href) {
                        if (item.iframe) {
                            pane = new ContentPane({
                                id: paneId,
                                title: item.name,
                                closable: true,
                                content: domConstruct.create("iframe", {
                                    "src": item.href,
                                    "style": "border: 0; width: 100%; height: 100%"
                                })
                            });
                        }
                        else {
                            var requireScripts = !item.scripts ? [] : item.scripts.split(',');

                            pane = new ContentPane({
                                id: paneId,
                                title: item.name,
                                closable: true,
                                href: item.href
                            });
                        }

                        tabs.addChild(pane);
                    }
                    else if (item.contentPane) {
                        require([item.contentPane], function (Pane) {
                            pane = new Pane({
                                id: paneId,
                                title: item.name,
                                closable: true,
                                options: item.options || {}
                            });

                            tabs.addChild(pane);    
                            tabs.selectChild(pane);                                
                        });
                    }
                }

                tabs.selectChild(pane);
            }

            tree.startup();

            map = basemap.create({ divId: 'map' });
            /*
                        map = new Map("map", {
                            basemap: "topo",
                            center: [106.48902795844141, 29.623800368070633], //地图加载后，初始位置
                            zoom: 14,        //放大级别，值越大放大的比例就越大
                            maxZoom: 18,     // 地图最大缩放级别
                            minZoom: 1,      // 地图最小缩放级别
                            slider: false   // 设置显示地图缩放按钮
                        });
            */

            // 测试打开一个对话窗口
            var btn = dojo.byId('b');

            console.log(btn);

            function showDialog() {

                var dialog = registry.byId('diaDiv');

                if (!dialog) {
                    var pane = document.createElement("div");

                    pane.setAttribute("id", "diaDiv");

                    document.body.appendChild(pane);

                    dialog = new Dialog({ title: "dojo dialog", style: "width: 600px;height:400px;" }, pane);
                }

                dialog.show();
            }

            on(btn, 'click', showDialog);

            // 测试打开一个对话窗口
            var btnc = dojo.byId('c');

            console.log(btn);

            function showContentPane() {
                // cw/menu/commands/a.js
                var item = {
                    id: 'test',
                    name: 'test',
                    pane: 'views/demo/a'
                };

                var tabs = registry.byId("windowTabContainer");

                var pane = null;
                var paneId = 'menu-tab-' + item.id;

                tabs.getChildren().forEach(function (tab) {
                    if (tab.id == paneId) {
                        pane = tab;
                    }
                });

                if (!pane) {
                    if (item.pane) {
                        require([item.pane], function (Pane) {

                            pane = new Pane({
                                id: paneId,
                                title: item.name,
                                closable: true
                            });

                            tabs.addChild(pane);
                        });
                    }
                    else if (item.href) {
                        if (item.iframe) {
                            pane = new ContentPane({
                                id: paneId,
                                title: item.name,
                                closable: true,
                                content: domConstruct.create("iframe", {
                                    "src": item.href,
                                    "style": "border: 0; width: 100%; height: 100%"
                                })
                            });
                        }
                        else {
                            pane = new ContentPane({
                                id: paneId,
                                title: item.name,
                                closable: true,
                                href: item.href,
                                onDownloadEnd: function () {
                                    console.log(paneId + 'download end.');

                                    require([item.scripts], function (main) {
                                        main.startup();
                                    });
                                }
                            });
                        }

                        tabs.addChild(pane);
                    }
                }

                tabs.selectChild(pane);
            }

            on(btnc, 'click', showContentPane);
        });

</script>

<body class="x3platform">
    <div id="borderContainer2" data-dojo-type="dijit/layout/BorderContainer" design="sidebar" gutters="true" liveSplitters="true"
        style="width: 100%; height: 100%; padding:0;">
        <div data-dojo-type="dijit/layout/ContentPane" splitter="true" region="leading" style="width: 200px; padding:4px 4px 2px 4px; border-top:none; border-left:none; border-bottom:none;">
            <div data-dojo-type="dijit/layout/AccordionContainer" splitter="true" region="leading">
                <div data-dojo-type="dijit/layout/ContentPane" title="应用管理">
                    <button id="b">打开新窗口</button>
                    <button id="c">加载脚本</button>
                </div>
                <div data-dojo-type="dijit/layout/ContentPane" title="演示" style="padding:0;">
                    <div id="treeView"></div>
                </div>
                <div data-dojo-type="dijit/layout/ContentPane" title="全城布控"></div>
            </div>
        </div>
        <!-- 右侧
        <div data-dojo-type="dijit.layout.ContentPane" splitter="true" region="trailing" style="width: 100px;">
            Tailing Region
        </div> -->
        <div data-dojo-type="dijit/layout/ContentPane" splitter="true" region="center" style="padding:4px; border-top:none; border-right:none; border-bottom:none;">
            <div id="windowTabContainer" data-dojo-type="dijit/layout/TabContainer" style="width: 100%; height: 100%;">
                <div id="menu-tab-home" data-dojo-type="dijit/layout/ContentPane" title="主页" data-dojo-props="selected:true">
                    <div id="map"></div>
                </div>
            </div>
        </div>
        <!-- 
        <div data-dojo-type="dijit.layout.ContentPane" splitter="true" liveSplitters="true" region="top">
            Top Region
        </div>-->
        <!-- 
        <div data-dojo-type="dijit.layout.ContentPane" splitter="true" region="bottom">
            Bottom Region
        </div>-->
    </div>
</body>

</html>