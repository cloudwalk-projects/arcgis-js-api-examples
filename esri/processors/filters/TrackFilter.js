// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["../../core/declare","dojo/_base/array","dojo/_base/lang","../Filter"],function(g,h,k,l){return g([l],{declaredClass:"esri.processors.filters.TrackFilter",normalizeCtorArgs:function(a){"string"===typeof a&&(a={trackIdField:a});return a},getDefaults:function(){return k.mixin(this.inherited(arguments),{idField:"id",parentField:"parent"})},trackIdField:null,idField:null,parentField:null,run:function(a){if(this.trackIdField&&a){var b=a.removed||[],d=a.added||[],c,e,f;if(b.length){e=0;for(f=b.length;e<
f;e++)c=b[e],this._removeItemFromOutput(c,this.idField)}d.length&&this.output.addMany(a.added.map(function(a){a[this.parentField]=a.attributes[this.trackIdField];return a}.bind(this)))}},_getIndexOfItem:function(a,b,d){var c=a[b];return d.findIndex(function(a){return a[b]===c},this)},_removeItemFromOutput:function(a,b){var d=a[b],c;c=this._getIndexOfItem(a,b,this.output);-1!==c&&this.output.removeAt(c);return{index:c,id:d,parent:a[this.parentField]}},_getItemsByParent:function(a,b){return b.filter(function(b){return b[this.parentField]===
a},this)},_getTracksAffectedByChanges:function(a){a=a||{};var b=a.added||[],d=[],b=b.concat(a.removed||[]);if(b.length)for(var c=0,e=b.length;c<e;c++)a=b[c],-1===h.indexOf(d,a[this.parentField])&&d.push(a[this.parentField]);return d}})});