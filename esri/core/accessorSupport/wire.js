// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","./utils"],function(q,f,e){function k(b,a,c){a=e.splitPath(a);if(Array.isArray(a)){for(var g=[],d=0;d<a.length;d++)g.push((new h(a[d],c)).install(b));return new l(g)}b=(new h(a,c)).install(b);return new m(b)}var h=function(){function b(a,c){this.path=a;this.callback=c;this.chain=null;this.path=a;-1<a.indexOf(".")&&(this.chain=e.pathToArray(a));this.callback=c;return this}b.prototype.install=function(a){a=this.chain?new n(this,a):new p(this,a);return a};b.prototype.notify=
function(a){this.callback(a,this.path)};return b}(),p=function(){function b(a,c){this.binding=a;this.target=c;e.getProperties(c).addCursor(this.binding.path,this)}b.prototype.destroy=function(){this.target&&(e.getProperties(this.target).removeCursor(this.binding.path,this),this.target=this.binding=null)};b.prototype.propertyDestroyed=function(a,c){e.getProperties(this.target).removeCursor(c,this)};b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=
function(a,c){this.binding&&this.binding.notify(this.target)};return b}(),n=function(){function b(a,c){this.binding=a;this.target=c;this.stack=[];this.properties=e.getProperties(c);this.stack.push({properties:this.properties,propertyName:a.chain[0]});this.properties.addCursor(a.chain[0],this);this.moveForward();return this}b.prototype.destroy=function(){for(var a;a=this.stack.pop();)a.properties.removeCursor(a.propertyName,this);this.target=this.binding=null};b.prototype.propertyDestroyed=function(a,
c){this.moveBackward(a,c)};b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=function(a,c){this.binding&&(this.moveBackward(a,c),this.moveForward(),this.binding.notify(this.target))};b.prototype.moveBackward=function(a,c){for(var b=this.stack,d=b[b.length-1];d.properties!==a&&d.propertyName!==c;)d.properties.removeCursor(d.propertyName,this),b.pop(),d=b[b.length-1]};b.prototype.moveForward=function(){var a=this.stack,b=a[a.length-
1],b=b.properties.internalGet(b.propertyName);if((b=e.getProperties(b))&&a.length<this.binding.chain.length)a=this.binding.chain[a.length],this.stack.push({properties:b,propertyName:a}),b.addCursor(a,this),this.moveForward()};return b}(),l=function(){function b(a){this.cursors=a}b.prototype.remove=function(){for(var a=this.cursors;0<a.length;)a.pop().destroy();this.cursors=null};return b}(),m=function(){function b(a){this.cursor=a}b.prototype.remove=function(){this.cursor.destroy();this.cursor=null};
return b}();f.create=function(b,a){var c=e.splitPath(b);if(Array.isArray(c)){for(var g=[],d=0;d<c.length;d++)g.push(new h(c[d],a));return function(a){for(var b=[],c=0,d=g.length;c<d;c++)b[c]=g[c].install(a);return new l(b)}}var f=new h(c,a);return function(a){return new m(f.install(a))}};f.wire=k;Object.defineProperty(f,"__esModule",{value:!0});f.default=k});