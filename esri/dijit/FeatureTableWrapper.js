// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/FeatureTableWrapper/templates/FeatureTableWrapper.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d "_bcNode" class\x3d"esri-feature-table-wrapper-border-container" data-dojo-type\x3d"dijit.layout.BorderContainer" gutters\x3d"false"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d "_cpLeadingNode" class\x3d"esri-feature-table-wrapper-content-pane" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'leading\', liveSplitters:true"  style\x3d "width: 100%; height: 100%;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_gridNode" style\x3d "width: 100%; height: 100%;"\x3e\x3c/div\x3e    \r\n    \x3c/div\x3e   \r\n    \x3cdiv data-dojo-attach-point\x3d "_cpCenterNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\', liveSplitters:true" style\x3d "height: 100%; display:none;"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d "_cpTrailingNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'trailing\'" style\x3d "height: 100%; display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/FeatureTableWrapper","dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_WidgetBase dojo/aspect dojo/Deferred dojo/has dojo/on dojo/string dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/_base/lang dojo/fx dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry dgrid/util/misc ../kernel ../IdentityManager ../layers/FeatureLayer ../dijit/FeatureTable ../dijit/FeatureLayerQueryStore dijit/Menu dijit/MenuItem dijit/a11yclick dijit/form/DropDownButton dijit/form/Button dijit/layout/BorderContainer dijit/layout/ContentPane dojo/text!./FeatureTableWrapper/templates/FeatureTableWrapper.html".split(" "),
function(m,x,y,I,t,z,l,u,k,A,B,h,J,K,n,p,L,M,q,C,N,v,D,r,E,F,s,O,P,G,w,H){m=A([y,m,x],{declaredClass:"esri.dijit.FeatureTableWrapper",baseClass:"esri-feature-table-wrapper",templateString:H,domNode:null,featureLayer:null,editable:!0,hiddenFields:null,fieldInfos:null,gridOptions:null,dateOptions:null,selectedRows:null,selectedRowIds:null,outFields:null,syncSelection:!0,zoomToSelection:!0,showDataTypes:!1,showGridHeader:!0,showGridMenu:!0,showFeatureCount:!0,showColumnHeaderTooltips:!0,showRelatedRecords:!1,
showDestinationRelationships:!1,showAttachments:!1,batchCount:50,css:{relatedBC:"esri-feature-table-related-border-container",relatedCPLeading:"esri-feature-table-related-leading-content-pane",buttonNode:"esri-feature-table-button",columnChangeMenuNode:"esri-feature-table-column-change-menu",iconUIDown:"icon-ui-down",iconUIMenu:"icon-ui-menu",iconUIClose:"icon-ui-close"},showFieldDetails:!0,showCyclicalRelationships:!1,_columnRules:null,_relatedTableInfos:null,_subLayouts:null,_activePromises:null,
_popupDateFormats:{shortDate:{datePattern:"M/d/y"},shortDateLE:{datePattern:"d/M/y"},longMonthDayYear:{datePattern:"MMMM d, y"},dayShortMonthYear:{datePattern:"d MMM y"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",timeEnabled:!0},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",timeEnabled:!0},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",timeEnabled:!0},shortDateLEShortTime24:{datePattern:"d/M/y",
timePattern:"H:mm",timeEnabled:!0},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",timeEnabled:!0},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",timeEnabled:!0},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",timeEnabled:!0},longMonthYear:{datePattern:"MMMM y"},shortMonthYear:{datePattern:"MMM y"},year:{datePattern:"y"}},constructor:function(a,b){this.hiddenFields=[];this._columnRules=
{};this._relatedTableInfos=[];this._subLayouts=[];this._activePromises=[];this._buttonInfos={}},startup:function(){this.inherited(arguments);this._generatePrimaryTable()},destroy:function(){this.inherited(arguments);0<this._activePromises.length&&k.forEach(this._activePromises,function(a){a.cancel()})},_generateFeatureTable:function(a){var b=a.layer,c=a.node,e=!isNaN(a.layerId)&&null!==a.layerId?a.layerId:!isNaN(b.layerId)&&null!==b.layerId?b.layerId:null;a=a.filterIds||null;var d=[],g=!this.featureTable&&
this.showFieldDetails,f;this.layerInfos&&(f=(f=(f=(f=this.layerInfos[e]||null)?f.popupInfo:null)?f.fieldInfos:null)?this._updatePopupInfosDateFormat(f):null);e&&d.push(e);this.featureTable&&this.featureTable.featureLayer&&d.push(this.featureTable.featureLayer.layerId);k.forEach(this._relatedTableInfos,function(a){d.push(a.layer.layerId)});b=new D({featureLayer:b,editable:this.editable,fieldInfos:f,gridOptions:this.gridOptions,dateOptions:this.dateOptions,hiddenFields:this.hiddenFields,showAttachments:this.showAttachments,
showRelatedRecords:this.showRelatedRecords,showDestinationRelationships:this.showDestinationRelationships,showGridMenu:this.showGridMenu,showDataTypes:this.showDataTypes,showGridHeader:this.showGridHeader,showFeatureCount:this.showFeatureCount,menuFunctions:this.menuFunctions,batchCount:this.batchCount,showStatistics:this.showStatistics,showColumnHeaderTooltips:this.showColumnHeaderTooltips,showFieldDetails:g,filterIds:a,visibleLayerIds:d,showCyclicalRelationships:this.showCyclicalRelationships},
c);b.own(l(b,"error",h.hitch(this,function(a){this.emit("error",a)})),l(b,"edits-complete",h.hitch(this,function(a){this.emit("edits-complete",a)})));b.startup();return b},_generatePrimaryTable:function(){var a=this._generateFeatureTable({layer:this.featureLayer,node:this._gridNode});this.featureTable=a;this._buttonInfos[a.id]={columnHider:this._generateColumnHiderButton(a)};a.on("show-related-records",h.hitch(this,function(b){var c=this._buttonInfos[a.id];this._removeButton(c.columnHider);c.columnHider=
null;a.showFieldDetails=!1;a.showFeatureCount=!1;a._updateGridHeaderText();this._shrinkTable({table:a,leadingPane:this._cpLeadingNode,centerPane:this._cpCenterNode,columnId:b.columnId}).then(h.hitch(this,function(e){c.column=this._generateColumnPickerButton(a);a.columns.push({unhidable:!0,label:"ft_related-records-small",field:"ft_related-records-small",get:function(d){d=a._getRelatedRecordsByIds(d[a.idProperty],b.relationship.id);return u.substitute(a._i18nStrings.parenValue,{value:d&&d.features?
d.features.length:0})}});a.grid.set("selectionMode","single");a.refresh();a.selectRows([b.row[a.idProperty]]);return this._generateRelatedRecordsTable({parentLayer:this.featureLayer,parentTable:e,relationshipInfos:b,attachNode:this._cpCenterNode})})).then(h.hitch(this,function(a){this._wireUpRelatedRecordsTable(a)}))}));a.on("show-detailed-field-view",h.hitch(this,function(b){var c=b.columnId,e=b.fieldInfo,d=this._buttonInfos[a.id];this._removeButton(d.columnHider);d.columnHider=null;a.showFeatureCount=
!1;a.showFieldDetails=!1;a._updateGridHeaderText();this._shrinkTable({table:a,leadingPane:this._cpLeadingNode,centerPane:this._cpCenterNode,columnId:c,finalWidth:this._cpLeadingNode.domNode.getBoundingClientRect().width/6}).then(h.hitch(this,function(){d.column=this._generateColumnPickerButton(a);this.emit("show-detailed-field-view",{columnId:c,table:a,fieldInfo:e})}))}))},_generateRelatedRecordsTable:function(a){var b=new t,c=a.relationshipInfos,e=a.attachNode,d=a.parentTable,g,f;f=k.map(c.records,
function(a){return a.attributes[d.idProperty]});e=this._generateSubLayout(e.domNode);a=this._generateFeatureLayer(c.relationship.relatedTableId);f=this._generateFeatureTable({layer:a,layerId:c.relationship.relatedTableId,node:e.gridContainer,filterIds:f});this._buttonInfos[f.id]={columnHider:this._generateColumnHiderButton(f),close:this._generateRelatedTableCloseButton(f)};g={layout:e,layer:a,table:f,relationshipInfos:c,parentTable:d};this._relatedTableInfos.push(g);this.own(l.once(f,"load",h.hitch(this,
function(){this._activePromises.splice(k.indexOf(b),1);b.resolve(g)})));this._activePromises.push(b);return b},_wireUpRelatedRecordsTable:function(a){var b=this._relatedTableInfos.indexOf(a),c=a.parentTable,e=a.relationshipInfos,d=a.table;this._setUpRelatedTableEvents(a,c);d.own(l(c,"row-select",h.hitch(this,function(a){var f=this.featureLayer.objectIdField;a=c._getRelatedRecordsByIds(a[0].data[f],e.relationship.id);var h=b===this._relatedTableInfos.length-1;if(a)if(a=k.map(a.features,function(a){return a.attributes[f]}),
d.set("filterIds",a),d._updateGridHeaderText(),d.dataStore instanceof r){if(h=d._generateCacheStore(a),d.grid.set("store",h),d.set("dataStore",h),b!==this._relatedTableInfos.length-1){a=a[0];var l={data:{}};l.data[f]=a;d.selectRows([a]);setTimeout(function(){d.emit("row-select",[l])},500)}}else d._updateGridHeaderText(),d.refresh(),b!==this._relatedTableInfos.length-1&&d.selectRows([a[0]]);else if(h)d.dataStore instanceof r&&(d.grid.store=null),d.set("filterIds",[]),d._updateGridHeaderText(),d.refresh();
else for(a=this._relatedTableInfos.length-1;a>=b;a--)if(h=this._relatedTableInfos[a].table)h.dataStore instanceof r&&(h.grid.store=null),h.set("filterIds",[]),d._updateGridHeaderText(),h.refresh()})))},_setUpRelatedTableEvents:function(a){var b=a.table,c=a.layout,e=a.layer;b.on("show-related-records",h.hitch(this,function(a){var g=this._buttonInfos[b.id];this._removeButton(g.columnHider);this._removeButton(g.close);g.columnHider=null;g.close=null;b.showFieldDetails=!1;b.showFeatureCount=!1;b._updateGridHeaderText();
this._shrinkTable({table:b,leadingPane:c.contentPaneLeading,centerPane:c.contentPaneCenter,columnId:a.columnId}).then(h.hitch(this,function(f){g.column=this._generateColumnPickerButton(b);b.columns.push({unhidable:!0,label:"ft_related-records-small",field:"ft_related-records-small",get:function(c){c=b._getRelatedRecordsByIds(c[b.idProperty],a.relationship.id);return u.substitute(b._i18nStrings.parenValue,{value:c&&c.features?c.features.length:0})}});b.grid.set("selectionMode","single");b.refresh();
b.selectRows([a.row[b.idProperty]]);return this._generateRelatedRecordsTable({parentLayer:e,parentTable:f,relationshipInfos:a,attachNode:c.contentPaneCenter})})).then(h.hitch(this,function(a){this._wireUpRelatedRecordsTable(a)}))}))},_generateFeatureLayer:function(a){var b=this.featureLayer._url.path,b=b.substring(0,b.lastIndexOf("/")+1);return new v(b+a,{mode:v.MODE_ONDEMAND,outFields:["*"],visible:!0})},_updatePopupInfosDateFormat:function(a){k.forEach(a,function(a){a.format&&a.format.dateFormat&&
(a.format.dateFormat=this._popupDateFormats[a.format.dateFormat])},this);return a},_showPane:function(a){p.set(a.domNode,"display","block")},_hidePane:function(a){p.set(a.domNode,"display","none")},_generateSubLayout:function(a){var b=new G({className:this.css.relatedBC,gutters:!1,design:"headline"}),c=new w({region:"leading",className:this.css.relatedCPLeading}),e=n.create("div",{},c.domNode),d=new w({region:"center",style:"display: none;"});b.addChild(c);b.addChild(d);b.placeAt(a);b.startup();return{borderContainer:b,
contentPaneLeading:c,contentPaneCenter:d,gridContainer:e}},_shrinkTable:function(a){var b=new t,c=a.table,e=a.leadingPane,d=a.centerPane,g=a.columnId,f=a.finalWidth||220;a=B.animateProperty({node:e.id,properties:{width:{start:function(){return e.domNode.getBoundingClientRect().width},end:h.hitch(this,function(){return f})}}}).play();l(a,"End",h.hitch(this,function(a){this._addHiddenColumnRules(c,g);this._showPane(d);this._bcNode.resize();c.resize();this._activePromises.splice(k.indexOf(b),1);b.resolve(c)}));
this._activePromises.push(b);return b},_removeTable:function(a){a=this.featureTable._findFirst(this._relatedTableInfos,"table",a);var b=k.indexOf(this._relatedTableInfos,a),c;this._hidePane(a.layout.contentPaneCenter);this._bcNode.resize();k.forEach(this._relatedTableInfos,function(a,c){if(c>=b){a.layout.borderContainer.destroy();var g=a.table;if(!g.loaded||!g.dataStore)g.on("load",g.destroy);else g.destroy()}});this._relatedTableInfos.splice(b);0<this._relatedTableInfos.length?(a=this._relatedTableInfos[this._relatedTableInfos.length-
1].table,c=this._relatedTableInfos[this._relatedTableInfos.length-1]):a=this.featureTable;this._growTable({table:a,info:c||[]})},_growTable:function(a){var b=a.table,c=a.info;a=b.columns;var e,d=this._buttonInfos[b.id];this._removeHiddenColumnRules(b);d.column&&(this._removeButton(d.column),d.column=null);d.columnHider=this._generateColumnHiderButton(b);b===this.featureTable?(this._hidePane(this._cpCenterNode),p.set(this._cpLeadingNode.domNode,"width","100%"),this._bcNode.resize()):(e=c.layout.contentPaneLeading,
c=c.layout.contentPaneCenter,this._hidePane(c),p.set(e.domNode,"width","100%"),this._bcNode.resize(),d.close=this._generateRelatedTableCloseButton(b));"ft_related-records-small"===a[a.length-1].field&&(a.pop(),b.refresh());b.grid.set("selectionMode","extended");b.showFeatureCount=!0;b.showFieldDetails=!0;b._updateGridHeaderText();b.resize()},_addHiddenColumnRules:function(a,b){this._columnRules[a.id]&&this._removeHiddenColumnRules(a);var c=Object.keys(a.grid.columns),e="#"+q.escapeCssIdentifier(a.id)+
" .dgrid-column-",d=[],g,f,d=k.map(c,function(a,c){g=e+q.escapeCssIdentifier(c,"-");f=c===b;return q.addCssRule(g,f?"display: table-cell;":"display: none;")});this._columnRules[a.id]=d},_removeHiddenColumnRules:function(a){this._columnRules[a.id]&&(k.forEach(this._columnRules[a.id],function(a,c){a.remove()}),this._columnRules[a.id]=[])},_generateRelatedTableCloseButton:function(a){var b;b=n.create("div",{className:this.css.buttonNode+" "+this.css.iconUIClose,tabIndex:0},a._gridHeaderNode.domNode);
l(b,s,h.hitch(this,function(){this._removeButton(this._buttonInfos[a.id].close);this._removeTable(a)}));return{buttonNode:b}},_generateColumnHiderButton:function(a){var b;b=n.create("div",{className:this.css.buttonNode+" "+this.css.iconUIMenu,tabIndex:0},a._gridHeaderNode.domNode);l(b,s,function(){a.grid._toggleColumnHiderMenu()});return{buttonNode:b}},_generateColumnPickerButton:function(a){var b=a._gridHeaderNode.domNode,c,e;e=this._generateColumnPickerMenu(a);c=n.create("div",{className:this.css.buttonNode+
" "+this.css.iconUIDown,tabIndex:0},b);l(c,s,function(a){e._openMyself({target:a.target,delegatedTarget:c,iframe:null,coords:{x:a.pageX,y:a.pageY}})});return{buttonNode:c}},_generateColumnPickerMenu:function(a){var b=new E({className:this.css.columnChangeMenuNode});k.forEach(a.columns,function(c,e){var d=parseInt(c.id,10),g=a._findFirst(a.layerInfo.fieldInfos,"name",c.field);if(!("ft_related-records"===c.type||"ft_related-records-small"===c.field||"ft_attachments"===c.type||"esriFieldTypeOID"===g.type||
"esriFieldTypeGUID"===g.type||"esriFieldTypeGlobalID"===g.type||-1!==k.indexOf(a._unsupportedFieldTypes,g.type))){var f=new F({label:c.label,onClick:h.hitch(this,function(){this._addHiddenColumnRules(a,d);this.emit("column-focus-change",{fieldInfo:g,column:c})})});b.addChild(f)}},this);b.startup();return b},_removeButton:function(a){a&&a.buttonNode&&a.buttonNode.parentNode&&a.buttonNode.parentNode.removeChild(a.buttonNode)}});z("extend-esri")&&h.setObject("dijit.FeatureTableWrapper",m,C);return m});