// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/Tapestry","dojo/_base/declare ./BaseWidget dojo/_base/lang dojo/_base/array dojo/on require dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/query dojo/i18n!../../nls/jsapi dojox/html/entities ./dom".split(" "),function(v,w,x,y,z,B,g,C,h,D,k,A,r){function s(a){return"Tapestry_LifeMode"+a.match(/\d+/)[0]}function t(a){return"http://downloads.esri.com/esri_content_doc/dbl/us/tapestry/segment"+a+".pdf"}k=k.geoenrichment.dijit.Tapestry;return v(w,{baseClass:"Infographics_Tapestry",
_mainTable:null,_detailsTable:null,updateUIExpanded:function(){this.inherited(arguments);this._updateUI()},updateUICollapsed:function(){this.inherited(arguments);this._updateUI()},createUIExpanded:function(a){this.inherited(arguments);this._createUI(a)},createUICollapsed:function(a){this.inherited(arguments);this._createUI(a)},_createUI:function(a){a=this._mainTable=a.addContent("table",{"class":"Tapestry_Main_Table"});z(a,".Tapestry_Main_Button:click",x.hitch(this,this._toDetailView));this.expanded?
r.createCols(a,[0.25,0.4,0.35]):r.createCols(a,[0.55,0.45])},_updateUI:function(){function a(){m=p.insertCell(-1)}function e(a){var c=l._getValue(b,"CODE");h.add(a,"Tapestry_Main_Button Tapestry_Details_Image code_"+(3>c.length?"0"+c:c)+" LifeModeBorder "+s(c));a=g.create("div",null,a);g.create("span",{"class":"Tapestry_thumbnail_Code LifeModeBorder "+s(c),innerHTML:c},a)}this._toMainView();var c,b;for(b=0;3>b;b++)if(this._getValue(b,"NAME"))c=b+1;else break;var d,p,m,l=this;d=this._mainTable;var n,
f;for(b=d.rows.length;b<c;b++)p=d.insertRow(-1),h.add(p,"Tapestry_LifeMode"),this.expanded&&a(),a(),h.add(m,"Tapestry_Main_Name Tapestry_Main_Button LifeModeColor"),a(),h.add(m,"Tapestry_Main_Pct Tapestry_Main_Button LifeModeColor"),this.expanded&&(a(),h.add(m,"Tapestry_Main_Arrow Tapestry_Main_Button"),g.create("div",null,m));for(;d.rows.length>2*c;)d.deleteRow(-1);n=this.expanded?1:0;f=this.expanded?2:1;for(b=0;b<c;b++){var u=d.rows,q=u[b].cells;this.expanded&&(q[0].removeAttribute("class"),g.empty(q[0]),
e(q[0]));q[n].innerHTML=this._getValue(b,"NAME")+"\x3cbr\x3e\x3cspan class\x3d'Tapestry_Main_Value'\x3e"+this._formatValue(b,"VALUE")+" "+k.hhLabel+"\x3c/span\x3e";q[f].innerHTML=this._formatValue(b,"PRC")+"\x3cbr\x3e\x3cspan class\x3d'Tapestry_Main_PctLabel'\x3e"+k.prtHhLabel+"\x3c/span\x3e";u[b].setAttribute("data-index",b.toString())}},_getValue:function(a,e){return this.getValueByName(0,"TOP"+(a+1).toString()+e)},_formatValue:function(a,e){return this.formatByName(0,"TOP"+(a+1).toString()+e)},
_toDetailView:function(a){function e(){y.forEach(b.rows,function(a){h.remove(a,"clicked")})}var c;a=a.target;for(var b=this._mainTable;a&&a!==b;){if(c=a.getAttribute("data-index")){c=+c;break}a=a.parentNode}if(this.expanded){if(this._detailsTableRow){if(this._detailsTableRow.previousSibling===a){h.remove(a,"clicked");this._toMainView();return}this._toMainView();e()}h.add(a,"clicked");this.createDetailsTable(a);this._createDetailedViewExpanded(c)}else window.open(t(this._getValue(c,"NUM")),"_blank")},
createDetailsTable:function(a){this._detailsTableRow=g.create("tr",null,a,"after");a=g.create("td",{colSpan:"4"},this._detailsTableRow);this._detailsTable=g.create("table",{"class":"Tapestry_Details_Table"},a);r.createCols(this._detailsTable,[0.35,0.35,0.3])},_createDetailedViewExpanded:function(a){function e(){m=p.insertRow(-1)}function c(a){l=m.insertCell(-1);a&&h.add(l,a)}function b(a,b,c){var d={};a&&(d["class"]=a);b&&(d.innerHTML=A.encode(b));return g.create("div",d,c||l)}function d(d,e){c("Tapestry_Details_FieldCell");
var f=b("LifeModeBorder");b("Tapestry_Details_Label",d,f);b(null,n._formatValue(a,e),f)}var p=this._detailsTable,m,l,n=this,f=n._getValue(a,"CODE");h.add(p,s(f));3>f.length&&(f="0"+f);e();d(k.hhTypeLabel,"TYPE");d(k.medianAgeLabel,"AGE");c("Tapestry_Details_Image household code_"+f);l.rowSpan=2;b();b(null,n._getValue(a,"TYPE"));e();d(k.employmentLabel,"JOB");d(k.educationLabel,"EDUCATION");e();d(k.incomeLabel,"INCOME");d(k.raceEthnicityLabel,"RACE");c("Tapestry_Details_Image housing code_"+f);l.rowSpan=
2;b();b(null,n._getValue(a,"HOUSE"));e();c();l.colSpan=2;f=g.create("a",{href:t(n._getValue(a,"NUM")),target:"_blank"},l);b("Tapestry_Details_Name","View full segment profile",f)},_toMainView:function(){this._detailsTableRow&&(g.destroy(this._detailsTableRow),this._detailsTableRow=this._detailsTable=null)}})});