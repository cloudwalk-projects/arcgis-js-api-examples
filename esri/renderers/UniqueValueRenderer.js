// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ../core/urlUtils ../core/Logger ../core/Error ../portal/Portal ../symbols/WebStyleSymbol ../symbols/support/jsonUtils ../symbols/support/symbolUtils ./Renderer ./support/arcadeUtils".split(" "),function(w,x,r,e,f,g,p,s,m,n,t,k,u,v,l){var h=s.getLogger("esri.renderers.UniqueValueRenderer");return function(q){function b(a){q.call(this);this._valueInfoMap={};
this._isDefaultSymbolDerived=!1;this.type="uniqueValue";this.styleOrigin=this.portal=this.fieldDelimiter=this.defaultLabel=this.legendOptions=this.valueExpressionTitle=this.valueExpression=this.field3=this.field2=this.field=null;this._set("uniqueValueInfos",[])}r(b,q);b.prototype.writeValueExpression=function(a,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new m("property:unsupported",this.declaredClass+".valueExpression is not supported in Web Scene. Please remove this property to save the Web Scene.",
{instance:this,propertyName:"valueExpression",context:c})):d.valueExpression=a};b.prototype.writeValueExpressionTitle=function(a,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new m("property:unsupported",this.declaredClass+".valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpressionTitle",context:c})):d.valueExpressionTitle=a};Object.defineProperty(b.prototype,"compiledFunc",{get:function(){return l.createFunction(this.valueExpression)},
enumerable:!0,configurable:!0});b.prototype.writeLegendOptions=function(a,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new m("property:unsupported",this.declaredClass+".legendOptions is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"legendOptions",context:c})):d.legendOptions=g.clone(a)};Object.defineProperty(b.prototype,"defaultSymbol",{set:function(a){this._isDefaultSymbolDerived=!1;this._set("defaultSymbol",a)},enumerable:!0,
configurable:!0});b.prototype.readDefaultSymbol=function(a,d,c){return k.read(a,d,c)};b.prototype.writeDefaultSymbol=function(a,d,c){if(!this._isDefaultSymbolDerived&&(a=k.write(a,{},c)))d.defaultSymbol=a};b.prototype.readPortal=function(a,d,c){return c.portal||n.getDefault()};b.prototype.readStyleOrigin=function(a,d,c){if(d.styleName)return Object.freeze({styleName:d.styleName});if(d.styleUrl)return a=p.read(d.styleUrl,c),Object.freeze({styleUrl:a})};b.prototype.writeStyleOrigin=function(a,d,c){a.styleName?
d.styleName=a.styleName:a.styleUrl&&(d.styleUrl=p.write(a.styleUrl,c))};Object.defineProperty(b.prototype,"uniqueValueInfos",{set:function(a){this.styleOrigin?h.error("#uniqueValueInfos\x3d","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",a.slice(0)),this._updateValueInfoMap())},enumerable:!0,configurable:!0});b.prototype.readUniqueValueInfos=function(a,d,c){if(Array.isArray(a))return a.map(function(a){a=g.clone(a);a.symbol=k.read(a.symbol,
d,c);return a})};b.prototype.writeUniqueValueInfos=function(a,d,c){this.styleOrigin||(d.uniqueValueInfos=(this.uniqueValueInfos||[]).map(function(a){a=g.clone(a);a.symbol&&(a.symbol=k.write(a.symbol,{},c));a.value+="";return g.fixJson(a)}))};b.prototype.addUniqueValueInfo=function(a,d){if(this.styleOrigin)h.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else{var c;c="object"===typeof a?a:{value:a,symbol:d};this.uniqueValueInfos.push(c);
this._valueInfoMap[c.value+""]=c}};b.prototype.removeUniqueValueInfo=function(a){if(this.styleOrigin)h.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var d=0;d<this.uniqueValueInfos.length;d++)if(this.uniqueValueInfos[d].value+""===a+""){delete this._valueInfoMap[a];this.uniqueValueInfos.splice(d,1);break}};b.prototype.getUniqueValueInfo=function(a,d){var c=this.field,b=a.attributes;if(this.valueExpression)c=l.executeFunction(this.compiledFunc,
l.createExecContext(a,l.getView(d)));else if(this.field2){var f=this.field2,e=this.field3,g=[];c&&g.push(b[c]);f&&g.push(b[f]);e&&g.push(b[e]);c=g.join(this.fieldDelimiter||"")}else c=c&&"function"===typeof c?c(a):b[c];return this._valueInfoMap[c+""]};b.prototype.getSymbol=function(a,b){var c=this.getUniqueValueInfo(a,b);return c&&c.symbol||this.defaultSymbol};b.prototype.clone=function(){var a=new b({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:g.clone(this.defaultSymbol),
valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:g.clone(this.visualVariables),legendOptions:g.clone(this.legendOptions),authoringInfo:g.clone(this.authoringInfo)});this._isDefaultSymbolDerived&&(a._isDefaultSymbolDerived=!0);a._set("portal",this.portal);var d=g.clone(this.uniqueValueInfos);this.styleOrigin&&(a._set("styleOrigin",Object.freeze(g.clone(this.styleOrigin))),Object.freeze(d));a._set("uniqueValueInfos",
d);a._updateValueInfoMap();return a};b.prototype.collectRequiredFields=function(a){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(b){b&&(a[b]=!0)})};b.prototype.populateFromStyle=function(){var a=this;return u.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(b){var c=[];a._valueInfoMap={};b&&(b.data&&Array.isArray(b.data.items))&&b.data.items.forEach(function(f){var e=new t({styleUrl:b.styleUrl,styleName:b.styleName,portal:a.portal,name:f.name});!a.defaultSymbol&&
f.name===b.data.defaultItem&&(a.defaultSymbol=e,a._isDefaultSymbolDerived=!0);e={value:f.name,symbol:e};c.push(e);a._valueInfoMap[f.name]=e});a._set("uniqueValueInfos",Object.freeze(c));!a.defaultSymbol&&a.uniqueValueInfos.length&&(a.defaultSymbol=a.uniqueValueInfos[0].symbol,a._isDefaultSymbolDerived=!0);return a})};b.prototype._updateValueInfoMap=function(){var a=this;this._valueInfoMap={};this.uniqueValueInfos.forEach(function(b){return a._valueInfoMap[b.value+""]=b})};b.fromPortalStyle=function(a,
d){var c=new b(d&&d.properties);c._set("styleOrigin",Object.freeze({styleName:a}));c._set("portal",d&&d.portal||n.getDefault());c=c.populateFromStyle();c.otherwise(function(b){h.error("#fromPortalStyle('"+a+"'[, ...])","Failed to create unique value renderer from style name",b)});return c};b.fromStyleUrl=function(a,d){var c=new b(d&&d.properties);c._set("styleOrigin",Object.freeze({styleUrl:a}));c=c.populateFromStyle();c.otherwise(function(b){h.error("#fromStyleUrl('"+a+"'[, ...])","Failed to create unique value renderer from style URL",
b)});return c};e([f.property()],b.prototype,"type",void 0);e([f.property({json:{readFrom:"field1",writeTo:"field1"}})],b.prototype,"field",void 0);e([f.property({json:{writable:!0}})],b.prototype,"field2",void 0);e([f.property({json:{writable:!0}})],b.prototype,"field3",void 0);e([f.property({json:{writable:!0}})],b.prototype,"valueExpression",void 0);e([f.write("valueExpression")],b.prototype,"writeValueExpression",null);e([f.property({json:{writable:!0}})],b.prototype,"valueExpressionTitle",void 0);
e([f.write("valueExpressionTitle")],b.prototype,"writeValueExpressionTitle",null);e([f.property({dependsOn:["valueExpression"]})],b.prototype,"compiledFunc",null);e([f.property({json:{writable:!0}})],b.prototype,"legendOptions",void 0);e([f.write("legendOptions")],b.prototype,"writeLegendOptions",null);e([f.property({json:{writable:!0}})],b.prototype,"defaultLabel",void 0);e([f.property()],b.prototype,"defaultSymbol",null);e([f.read("defaultSymbol")],b.prototype,"readDefaultSymbol",null);e([f.write("defaultSymbol")],
b.prototype,"writeDefaultSymbol",null);e([f.property({json:{writable:!0}})],b.prototype,"fieldDelimiter",void 0);e([f.property({type:n,readOnly:!0})],b.prototype,"portal",void 0);e([f.read("portal",["styleName"])],b.prototype,"readPortal",null);e([f.property({readOnly:!0,json:{writable:!0}})],b.prototype,"styleOrigin",void 0);e([f.read("styleOrigin",["styleName","styleUrl"])],b.prototype,"readStyleOrigin",null);e([f.write("styleOrigin")],b.prototype,"writeStyleOrigin",null);e([f.property()],b.prototype,
"uniqueValueInfos",null);e([f.read("uniqueValueInfos")],b.prototype,"readUniqueValueInfos",null);e([f.write("uniqueValueInfos")],b.prototype,"writeUniqueValueInfos",null);e([f.property({dependsOn:["field","field2","field3"],readOnly:!0})],b.prototype,"requiredFields",void 0);return b=e([f.subclass("esri.renderer.UniqueValueRenderer")],b)}(f.declared(v))});