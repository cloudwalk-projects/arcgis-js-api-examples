// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../../core/lang ../../../core/promiseUtils ../../support/utils ./support/utils ./color ./size ../support/utils".split(" "),function(x,m,f,l,g,n,c,t,p,h){function u(a){if(!a||!a.layer||!a.field&&!a.valueExpression&&!a.sqlExpression)return g.reject(c.createError("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var b=f.mixin({},a);b.basemap=c.getBasemapId(b.basemap);
b.layer=h.createLayerAdapter(b.layer);return!b.layer?g.reject(c.createError("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+q)):b.layer.load().then(function(){var a=h.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});return(a=c.verifyBasicFieldValidity(b.layer,a,"univariate-colorsize-visual-variables:invalid-parameters"))?g.reject(a):b})}function r(a,b){var k=f.mixin({},a),e=0===b?k.colorOptions:
k.sizeOptions;delete k.sizeOptions;delete k.colorOptions;return f.mixin(k,e)}function v(a){if(!a||!a.layer||!a.field&&!a.valueExpression&&!a.sqlExpression)return g.reject(c.createError("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var b=f.mixin({},a);b.basemap=c.getBasemapId(b.basemap);b.symbolType=b.symbolType||"2d";b.layer=h.createLayerAdapter(b.layer);return!b.layer?g.reject(c.createError("univariate-colorsize-continuous-renderer:invalid-parameters",
"'layer' must be one of these types: "+q)):b.layer.load().then(function(){var a=h.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});return(a=c.verifyBasicFieldValidity(b.layer,a,"univariate-colorsize-continuous-renderer:invalid-parameters"))?g.reject(a):b})}function w(a){a=f.mixin({},a);var b=a.sizeOptions;delete a.sizeOptions;delete a.colorOptions;return f.mixin(a,b)}function s(a){return u(a).then(function(b){var a;return t.createVisualVariable(r(b,
0)).then(function(e){var d=r(b,1);d.statistics=e.statistics;a=e;return p.createVisualVariable(d)}).then(function(e){var d=a.visualVariable,c=e.visualVariable,f=d.stops.length;c.minDataValue=d.stops[0].value;c.maxDataValue=d.stops[f-1].value;return{basemapId:b.basemap,statistics:a.statistics,defaultValuesUsed:a.defaultValuesUsed,color:{visualVariable:d,colorScheme:a.colorScheme},size:{visualVariable:c,sizeScheme:e.sizeScheme},authoringInfo:{type:"univariate-color-size",visualVariables:[l.clone(a.authoringInfo.visualVariables[0]),
l.clone(e.authoringInfo.visualVariables[0])]}}})})}var q=h.supportedLayerTypes.join(", ");m.createVisualVariables=s;m.createContinuousRenderer=function(a){return v(a).then(function(a){var c;return p.createContinuousRenderer(w(a)).then(function(e){var d=f.mixin({},a),g="3d-volumetric"===d.symbolType;delete d.symbolType;delete d.defaultSymbolEnabled;d.worldScale=g;d.statistics=e.statistics;c=e;return s(d)}).then(function(a){var b=c.renderer;b.visualVariables=[n.cloneSizeVariable(a.size.visualVariable),
n.cloneColorVariable(a.color.visualVariable)];b.authoringInfo=l.clone(a.authoringInfo);return{renderer:b,statistics:c.statistics,defaultValuesUsed:c.defaultValuesUsed,color:a.color,size:a.size,basemapId:a.basemapId}})})}});