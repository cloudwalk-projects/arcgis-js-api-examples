// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/GenerateRendererTask ../../../../core/accessorSupport/decorators ../../statistics/support/utils ./LayerAdapter".split(" "),function(r,s,l,m,e,f,n,h,g,p){var q=/(https?:)?\/\/services.*\.arcgis\.com/i;return function(k){function d(a){k.call(this);this._layer=a.layer}l(d,k);d.prototype.getField=function(a){return this._layer.getField(a)};
d.prototype.getFieldUsageInfo=function(a){return!this._layer.getField(a)?null:{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0}};d.prototype.queryStatistics=function(a){var b=this._layer;if(this.hasLocalSource||!b.advancedQueryCapabilities.supportsStatistics)return e.reject(new f("feature-layer-adapter:not-supported","Layer does not support statistics query"));var c=b.createQuery();c.outStatistics=a.outStatistics;c.groupByFieldsForStatistics=a.groupByFieldsForStatistics;
c.orderByFields=a.orderByFields;c.where=g.mergeWhereClauses(c.where,a.where);c.sqlFormat=a.sqlFormat;return b.queryFeatures(c)};d.prototype.queryFeatureCount=function(a){if(this.hasLocalSource)return e.reject(new f("feature-layer-adapter:not-supported","Layer does not support count query"));var b=this._layer,c=b.createQuery();c.where=g.mergeWhereClauses(c.where,a);return b.queryFeatureCount(c)};d.prototype.generateRenderer=function(a){var b=this._layer;if(this.hasLocalSource||10.1>b.version)return e.reject(new f("feature-layer-adapter:not-supported",
"Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)"));var c=new n({url:b.parsedUrl.path,gdbVersion:b.gdbVersion}),b=b.createQuery();b.where=g.mergeWhereClauses(b.where,a.where);return c.execute(a)};d.prototype.getAllFeatures=function(a){return!this.hasLocalSource&&!a?e.reject(new f("feature-layer-adapter:missing-parameters","View is required for service based layers")):a?a.then(function(){return a.graphics}):this.hasLocalSource?e.resolve(this._layer.source):
null};d.prototype.load=function(){var a=this,b=this._layer,c=b.load().then(function(){a.geometryType=b.geometryType;a.objectIdField=b.objectIdField;a.supportsSQLExpression=q.test(b.url);a.hasLocalSource=!b.url&&!!b.source;if(a.hasLocalSource)return e.reject(new f("feature-layer-adapter:not-supported","Feature collection is not supported"))});this.addResolvingPromise(c);return this};return d=m([h.subclass()],d)}(h.declared(p))});