// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports dojo/string ../../../../core/Error ../../../../tasks/support/ClassBreaksDefinition ../../support/utils".split(" "),function(y,e,q,r,s,t){function h(a){return q.pad(a,2,"0")}function k(a,b){var c;"date"===b||"number"===b?("number"===b&&(a=new Date(a)),c="TIMESTAMP'"+a.getUTCFullYear()+"-"+h(a.getUTCMonth()+1)+"-"+h(a.getUTCDate())+" "+h(a.getUTCHours())+":"+h(a.getUTCMinutes())+":"+h(a.getUTCSeconds())+"'"):c=a;return c}function l(a,b){var c;if(b instanceof Date)c="date";else if("number"===
typeof b)c="number";else if("string"===typeof b){var d=a.getField(b);"\x3cnow\x3e"===b.toLowerCase()?c="":d&&d.type===u&&(c="field")}return c}function f(a,b){return new r(a,b)}function m(a){var b=("number"===typeof a?new Date(a):new Date).getUTCFullYear(),c=Date.UTC(b,0,1,12,0,0,0),b=Date.UTC(b,11,31,12,0,0,0);"number"===typeof a&&(a<c&&(c=a),a>b&&(b=a));return[c,b]}function n(a,b){var c=a;b&&(c=c?"("+c+") AND ("+b+")":b);return c}function v(a){var b=a.layer;return a.fields.filter(function(a){a=b.getFieldUsageInfo(a);
return!a||!a.supportsLayerQuery})}var p=["integer","small-integer","single","double"],u="date",w={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},x=Math.LOG10E;e.msSinceUnixEpochSQL=function(a,b){var c=new Date(0),c="("+k(b,l(a,b))+" - "+k(c,l(a,c))+")",d=w.milliseconds,e="/";1>d&&(d=1/d,e="*");return 1===d?c:"("+c+" "+e+" "+d+")"};e.getFieldExpr=function(a,b){var c=a.field,d=a.normalizationType,e=a.normalizationField,f=c;"percent-of-total"===d?f="(("+c+
" / "+b+") * 100)":"log"===d?f="(log("+c+") * "+x+")":"field"===d&&(f="("+c+" / "+e+")");return f};e.getSQLFilterForNormalization=function(a){var b=a.field,c=a.normalizationType;a=a.normalizationField;var d;"log"===c?d="(NOT "+b+" \x3d 0)":"field"===c&&(d="(NOT "+a+" \x3d 0)");return d};e.createCBDefn=function(a,b){var c=a.field,d=a.classificationMethod||"equal-interval",e=a.normalizationType,f=a.normalizationField,g=new s;g.classificationField=c;g.breakCount=b;g.classificationMethod=d;g.standardDeviationInterval=
"standard-deviation"===d?a.standardDeviationInterval||1:void 0;g.normalizationType=e;g.normalizationField="field"===e?f:void 0;return g};e.createError=f;e.getRangeExpr=function(a,b,c){b=null!=b?a+" \x3e\x3d "+b:"";a=null!=c?a+" \x3c\x3d "+c:"";c="";return(c=b&&a?n(b,a):b||a)?"("+c+")":""};e.verifyFieldType=function(a,b,c,d){var e=null;if(b){if(b.name===a.objectIdField||-1===d.indexOf(b.type))e=f(c,"'field' should be one of these types: "+d.join(","))}else e=f(c,"'field' is not defined in the layer schema");
return e};e.verifyNumericField=function(a,b,c){var d;if(b){if(b.name===a.objectIdField||-1===p.indexOf(b.type))d=f(c,"'field' should be one of these numeric types: "+p.join(","))}else d=f(c,"'field' is not defined in the layer schema");return d};e.getSuggestedDataRange=function(a){var b=a&&a.statistics;b||(b={});var c,d;null==b.min?a.isDate?(a=m(),c=a[0],d=a[1]):(c=0,d=100):b.min===b.max&&(a.isDate?(a=m(b.min),c=a[0],d=a[1]):0>b.min?(c=2*b.min,d=0):0<b.min?(c=0,d=2*b.min):(c=0,d=100));return{min:null!=
c?c:b.min,max:null!=d?d:b.max,defaultValuesUsed:null!=c||null!=d}};e.getCustomExprVal=function(a,b){var c;b=b.toLowerCase();if(a)for(var d in a)if(d.toLowerCase()!==b){c=a[d];break}return c};e.getAttributeVal=function(a,b){var c;b=b.toLowerCase();if(a)for(var d in a)if(d.toLowerCase()===b){c=a[d];break}return c};e.mergeWhereClauses=n;e.getNormalizationType=function(a){var b=a.normalizationType;b||(a.normalizationField?b="field":null!=a.normalizationTotal&&(b="percent-of-total"));return b};e.verifyBasicFieldValidity=
function(a,b,c){var d=t.getUnknownFields({layer:a,fields:b});if(d.length)return f(c,"Unknown fields: "+d.join(", ")+". You can only use fields defined in the layer schema");a=v({layer:a,fields:b});if(a.length)return f(c,"Unsupported fields: "+a.join(", ")+". You can only use fields that can be fetched i.e. FieldUsageInfo.supportsLayerQuery must be true")}});