// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require dojo/_base/lang dojo/Deferred ../request ../renderers/support/jsonUtils ./QueryTask ./Task ./support/StatisticDefinition ./support/Query".split(" "),function(h,f,k,l,m,n,p,g,q){return p.createSubclass({declaredClass:"esri.tasks.GenerateRendererTask",constructor:function(){this._handler=f.hitch(this,this._handler);this._handleExecuteResponse=this._handleExecuteResponse.bind(this)},normalizeCtorArgs:function(a,c){if(f.isObject(a)&&("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.CSVLayer"===
a.declaredClass)){var b=a,e=f.mixin({featureLayer:b},c);"string"===typeof b.url&&"esri.layers.CSVLayer"!==b.declaredClass&&(e.url=b.url);return e}return this.inherited(arguments)},properties:{checkValueRange:{value:null},gdbVersion:{value:null,type:String},source:{value:null},parsedUrl:{get:function(){var a=this._parseUrl(this.url);a.path+="/generateRenderer";return a}}},execute:function(a,c){var b;if(this._features=a.features||this._getCollectionFeatures()){b=new k;var e=this._features;h(["./support/generateRenderer"],
function(d){var c;"esri.tasks.support.ClassBreaksDefinition"===a.classificationDefinition.declaredClass?c=d.createClassBreaksRenderer({features:e,definition:a.classificationDefinition}):"esri.tasks.support.UniqueValueDefinition"===a.classificationDefinition.declaredClass&&(c=d.createUniqueValueRenderer({features:e,definition:a.classificationDefinition}));c?b.resolve(this._handleExecuteResponse(c)):b.reject()});return b.promise}var d=f.mixin(a.toJSON(),{f:"json"});this._field="esri.tasks.support.ClassBreaksDefinition"===
a.classificationDefinition.declaredClass?a.classificationDefinition.classificationField:a.classificationDefinition.attributeField;this.source&&(d.layer=JSON.stringify({source:this.source}));this.gdbVersion&&(d.gdbVersion=this.gdbVersion);d={query:d,callbackParamName:"callback"};if(this.requestOptions||c)d=f.mixin({},this.requestOptions,c,d);return l(this.parsedUrl.path,d).then(this._handleExecuteResponse)},_handleExecuteResponse:function(a){a=a.data;var c;c="esri.renderer.ClassBreaksRenderer"===a.declaredClass||
"esri.renderer.UniqueValueRenderer"===a.declaredClass?a:m.fromJSON(a);if(!this.checkValueRange)return this._processRenderer(c);a=new n(this.url);var b=new g({statisticType:"min",onStatisticField:this._field}),e=new g({statisticType:"max",onStatisticField:this._field}),b=new q({outStatistics:[b,e]});return a.execute(b).then(f.hitch(this,function(a){a=a.features[0].attributes;for(var b in a)if(0===b.toLowerCase().indexOf("min"))var e=a[b];else var f=a[b];return this._processRenderer(c,e,f)}))},_processRenderer:function(a,
c,b){"esri.renderer.ClassBreaksRenderer"===a.declaredClass?a.classBreakInfos.forEach(function(e,d){0===d&&(void 0!==c&&null!==c)&&(e.minValue=c);d===a.classBreakInfos.length-1&&(void 0!==b&&null!==b)&&(e.maxValue=b)}):a.uniqueValueInfos.forEach(function(e,d){0===d&&(void 0!==c&&null!==c)&&(e.value=c);d===a.uniqueValueInfos.length-1&&(void 0!==b&&null!==b)&&(e.value=b)});return a},_getCollectionFeatures:function(){var a=this.featureLayer;return a&&a.hasMemorySource&&a.graphics}})});