// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("../../core/kebabDictionary ../../core/JSONSupporter ../../core/lang ../../Graphic ../../layers/support/Field ../../geometry/SpatialReference ../../geometry/support/graphicsUtils ../../geometry/support/jsonUtils dojo/_base/lang".split(" "),function(l,u,v,w,x,t,y,z,A){l=l({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"});return u.createSubclass({declaredClass:"esri.tasks.support.FeatureSet",
classMetadata:{reader:{exclude:["fieldAliases","transform"]}},getDefaults:function(){return A.mixin(this.inherited(arguments),{features:[]})},displayFieldName:null,exceededTransferLimit:null,features:null,_featuresReader:function(a,b){var h=t.fromJSON(b.spatialReference),m;m=a.map(function(a){var b=w.fromJSON(a);a=a.geometry&&a.geometry.spatialReference;b.geometry&&!a&&(b.geometry.spatialReference=h);return b});b.transform&&this._hydrate(b.transform,b.geometryType,m);return m},fields:null,_fieldsReader:function(a){return a.map(function(a){return x.fromJSON(a)})},
geometryType:null,_geometryTypeReader:l.fromJSON,spatialReference:null,_spatialReferenceReader:function(a){return t.fromJSON(a)},toJSON:function(a){var b={hasZ:this.hasZ,hasM:this.hasM};this.displayFieldName&&(b.displayFieldName=this.displayFieldName);this.fields&&(b.fields=this.fields.map(function(a){return a.toJSON()}));this.spatialReference?b.spatialReference=this.spatialReference.toJSON():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJSON());
this.features[0]&&(this.features[0].geometry&&(b.geometryType=z.getJsonType(this.features[0].geometry)),b.features=y._encodeGraphics(this.features,a));b.exceededTransferLimit=this.exceededTransferLimit;b.transform=this.transform;return v.fixJson(b)},quantize:function(a){var b=a.translate[0],h=a.translate[1],m=a.scale[0],l=a.scale[1],q=this.features,r=function(a,p,b){var n,c,g,e,f,d,k=[];n=0;for(c=a.length;n<c;n++)if(g=a[n],0<n){if(d=p(g[0]),g=b(g[1]),d!==e||g!==f)k.push([d-e,g-f]),e=d,f=g}else e=
p(g[0]),f=b(g[1]),k.push([e,f]);return 0<k.length?k:null},s=function(a,p,b){if("point"===a)return function(a){a.x=p(a.x);a.y=b(a.y);return a};if("polyline"===a||"polygon"===a)return function(a){var c,d,e,f,k;e=a.rings||a.paths;k=[];c=0;for(d=e.length;c<d;c++)f=e[c],(f=r(f,p,b))&&k.push(f);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null};if("multipoint"===a)return function(a){var c;c=r(a.points,p,b);return 0<c.length?(a.points=c,a):null};if("extent"===a)return function(a){return a}}(this.geometryType,
function(a){return Math.round((a-b)/m)},function(a){return Math.round((h-a)/l)}),d,k;d=0;for(k=q.length;d<k;d++)s(q[d].geometry)||(q.splice(d,1),d--,k--);this.transform=a;return this},_hydrate:function(a,b,h){if(a){var m=a.translate[0],l=a.translate[1],q=a.scale[0],r=a.scale[1],s=function(a,b,l){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=l(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,n,c,g,e,f,h,m;d=0;for(n=a.length;d<
n;d++){e=a[d];c=0;for(g=e.length;c<g;c++)f=e[c],0<c?(h+=f[0],m+=f[1]):(h=f[0],m=f[1]),f[0]=b(h),f[1]=l(m)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=l(a.ymin);a.xmax=b(a.xmax);a.ymax=l(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,h,c,g,e;d=0;for(h=a.length;d<h;d++)c=a[d],0<d?(g+=c[0],e+=c[1]):(g=c[0],e=c[1]),c[0]=b(g),c[1]=l(e)}}(b,function(a){return a*q+m},function(a){return l-a*r});a=0;for(b=h.length;a<b;a++)h[a].geometry&&s(h[a].geometry)}}})});