// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/accessorSupport/decorators dojo/_base/lang ./support/basemapDefinitions ./core/Collection ./core/collectionUtils ./core/Evented ./core/JSONSupport ./core/Loadable ./core/promiseUtils ./core/requireUtils ./core/urlUtils ./core/Logger ./portal/Portal ./portal/PortalItem ./layers/Layer".split(" "),function(s,E,t,d,c,n,u,l,e,v,w,x,p,y,m,z,A,B,C){var D=0,f=l.ofType(C),q=z.getLogger("esri.Basemap");return function(r){function b(a){r.call(this);
this.thumbnailUrl=this.resourceInfo=this.portalItem=this.id=null;this.title="Basemap";this.id=Date.now().toString(16)+"-basemap-"+D++;this.baseLayers=new l;this.referenceLayers=new l;var b=function(a){"elevation"===a.type&&q.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a basemap layer and will therefore be ignored.")};this.baseLayers.on("after-add",function(a){return b(a.item)});this.referenceLayers.on("after-add",function(a){return b(a.item)})}t(b,r);b.prototype.initialize=
function(){var a=this;this.otherwise(function(b){q.error("#load()","Failed to load basemap (title: '"+a.title+"', id: '"+a.id+"')",b)});this.resourceInfo&&this.read(this.resourceInfo)};Object.defineProperty(b.prototype,"baseLayers",{set:function(a){this._set("baseLayers",e.referenceSetter(a,this._get("baseLayers"),f))},enumerable:!0,configurable:!0});b.prototype.writeBaseLayers=function(a,b,h){var c=[];if(!a)return c;h=n.mixin({},h,{layerContainerType:"basemap"});this.baseLayers.forEach(function(a){if(a.write){var b=
{};a.write(b,h)&&c.push(b)}});this.referenceLayers.forEach(function(a){if(a.write){var b={isReference:!0};a.write(b,h)&&c.push(b)}});b.baseMapLayers=c};Object.defineProperty(b.prototype,"referenceLayers",{set:function(a){this._set("referenceLayers",e.referenceSetter(a,this._get("referenceLayers"),f))},enumerable:!0,configurable:!0});b.prototype.writeTitle=function(a,b){b.title=a||"Basemap"};b.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this};b.prototype.clone=
function(){var a={id:this.id,title:this.title};this.resourceInfo||this.portalItem?(a.portalItem=this.portalItem,a.resourceInfo=this.resourceInfo):(a.baseLayers=this.baseLayers.slice(),a.referenceLayers=this.referenceLayers.slice());return new b(a)};b.prototype.read=function(a,b){b&&b.origin&&(this._layerOrigin=b.origin);b&&b.portal&&(this._layerPortal=b.portal);return this.inherited(arguments)};b.prototype.write=function(a,b){a=a||{};this.inherited(arguments,[a,b]);!this.loaded&&(this.resourceInfo&&
this.resourceInfo.baseMapLayers)&&(a.baseMapLayers=this.resourceInfo.baseMapLayers.map(function(a){a=n.clone(a);a.url&&m.isProtocolRelative(a.url)&&(a.url="https:"+a.url);a.templateUrl&&m.isProtocolRelative(a.templateUrl)&&(a.templateUrl="https:"+a.templateUrl);return a}));return a};b.prototype.toJSON=function(){return this.write(null,{origin:"web-map"})};b.prototype._loadFromSource=function(){var a=this.resourceInfo,b=this.portalItem;return a?this._loadFromJSON(a):b?this._loadFromItem(b):p.resolve(null)};
b.prototype._loadFromJSON=function(a,b){var c=this,d=this.portalItem&&this.portalItem.portal||this._layerPortal||null;return y.when(s,"./portal/support/layersCreator").then(function(k){var g=[];if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){var e={context:{origin:c._layerOrigin||"web-map",layerContainerType:"basemap",url:b,portal:d},defaultLayerType:"DefaultTileLayer"},f=k.populateOperationalLayers(c.baseLayers,a.baseMapLayers.filter(function(a){return!a.isReference}),e);g.push.apply(g,f);k=
k.populateOperationalLayers(c.referenceLayers,a.baseMapLayers.filter(function(a){return a.isReference}),e);g.push.apply(g,k)}return p.eachAlways(g)}).then(function(){})};b.prototype._loadFromItem=function(a){var b=this,c;return a.load().then(function(a){return a.fetchData()}).then(function(d){var e=m.urlToObject(a.itemUrl);c={origin:"portal-item",portal:a.portal||A.getDefault(),url:e};b.resourceInfo=d.baseMap;b.read(b.resourceInfo,c);b.read({title:a.title,thumbnailUrl:a.thumbnailUrl},c);return b._loadFromJSON(b.resourceInfo,
e)})};b.fromJSON=function(a){return!a?null:new b({resourceInfo:a})};b.fromId=function(a){return(a=u[a])?b.fromJSON(a):null};d([c.property({type:f,json:{writeAlways:!0}}),c.cast(e.castForReferenceSetter)],b.prototype,"baseLayers",null);d([c.write("baseLayers")],b.prototype,"writeBaseLayers",null);d([c.property({json:{origins:{webScene:{writable:!0}}}})],b.prototype,"id",void 0);d([c.property({type:B})],b.prototype,"portalItem",void 0);d([c.property({type:f}),c.cast(e.castForReferenceSetter)],b.prototype,
"referenceLayers",null);d([c.property()],b.prototype,"resourceInfo",void 0);d([c.property()],b.prototype,"thumbnailUrl",void 0);d([c.property()],b.prototype,"title",void 0);d([c.write("title")],b.prototype,"writeTitle",null);return b=d([c.subclass("esri.Basemap")],b)}(c.declared(w,v,x))});