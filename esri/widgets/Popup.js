// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/widgets/Popup/templates/Popup.html":'\x3cdiv role\x3d"presentation" class\x3d"${_css.invisible}"\x3e\r\n  \x3c!-- Popup Container --\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_containerNode" class\x3d"${_css.container} ${_css.alignTop} ${_css.shadow}"\x3e\r\n    \x3cdiv class\x3d"${_css.main}"\x3e\r\n      \x3c!-- Popup Docked Pagination --\x3e\r\n      \x3csection class\x3d"${_css.paginationDocked}"\x3e\r\n        \x3cdiv role\x3d"presentation" class\x3d"${_css.loadingContainer}" title\x3d"${_i18n.loading}"\x3e\r\n          \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLoading}"\x3e\x3c/span\x3e\r\n          \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.loading}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${_css.paginationDockedButtons}"\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_previousDockedNode" class\x3d"${_css.button} ${_css.paginationPrevious}" title\x3d"${_i18n.previous}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLeftTriangleArrow} ${_css.paginationPreviousIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconRightTriangleArrow} ${_css.paginationPreviousIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.previous}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_pageTextDockedNode" class\x3d"${_css.paginationText}"\x3e\x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_nextDockedNode" class\x3d"${_css.button} ${_css.paginationNext}" title\x3d"${_i18n.next}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconRightTriangleArrow} ${_css.paginationNextIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLeftTriangleArrow} ${_css.paginationNextIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.next}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_pageMenuDockedNode" class\x3d"${_css.button} ${_css.featureMenuButton}" title\x3d"${_i18n.menu}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconPaginationMenu}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.menu}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/section\x3e\r\n      \x3c!-- /Popup Docked Pagination --\x3e\r\n      \x3c!-- Popup Header --\x3e\r\n      \x3cheader class\x3d"${_css.header}"\x3e\r\n        \x3ch1 data-dojo-attach-point\x3d"_titleNode" class\x3d"${_css.headerTitle}"\x3e\x3c/h1\x3e\r\n        \x3cdiv class\x3d"${_css.headerButtons}"\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_dockNode" class\x3d"${_css.button} ${_css.buttonDock}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconDock} ${_css.iconDockToRight}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconDock} ${_css.iconDockToTop}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconDock} ${_css.iconDockToLeft}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconDock} ${_css.iconDockToBottom}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.dock}\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconUndock}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.undock}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_closeNode" class\x3d"${_css.button}" title\x3d"${_i18n.close}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconClose}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.close}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/header\x3e\r\n      \x3c!-- /Popup Header --\x3e\r\n      \x3c!-- Popup Content --\x3e\r\n      \x3carticle class\x3d"${_css.content}" data-dojo-attach-point\x3d"_bodyContentNode"\x3e\x3c/article\x3e\r\n      \x3c!-- /Popup Content --\x3e\r\n      \x3c!-- Popup Footer --\x3e\r\n      \x3cfooter class\x3d"${_css.footer}"\x3e\r\n        \x3c!-- Popup Actions --\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_actionsNode" class\x3d"${_css.actions}"\x3e\x3c/div\x3e\r\n        \x3c!-- /Popup Actions --\x3e\r\n        \x3c!-- Popup Pagination --\x3e\r\n        \x3csection class\x3d"${_css.pagination}"\x3e\r\n          \x3cdiv role\x3d"presentation" class\x3d"${_css.loadingContainer}" title\x3d"${_i18n.loading}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLoading}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.loading}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_previousNode" class\x3d"${_css.button} ${_css.paginationPrevious}" title\x3d"${_i18n.previous}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLeftTriangleArrow} ${_css.paginationPreviousIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconRightTriangleArrow} ${_css.paginationPreviousIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.previous}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_pageTextNode" class\x3d"${_css.paginationText}"\x3e\x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_nextNode" class\x3d"${_css.button} ${_css.paginationNext}" title\x3d"${_i18n.next}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconRightTriangleArrow} ${_css.paginationNextIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconLeftTriangleArrow} ${_css.paginationNextIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.next}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_pageMenuNode" class\x3d"${_css.button} ${_css.featureMenuButton}" title\x3d"${_i18n.menu}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.iconPaginationMenu}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.menu}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/section\x3e\r\n        \x3c!-- /Popup Pagination --\x3e\r\n      \x3c/footer\x3e\r\n      \x3c!-- /Popup Footer --\x3e\r\n      \x3c!-- Popup Menu --\x3e\r\n      \x3csection class\x3d"${_css.featureMenu}" data-dojo-attach-point\x3d"_pageMenuSectionNode" aria-hidden\x3d"true"\x3e\r\n        \x3ch2 class\x3d"${_css.featureMenuHeader}" data-dojo-attach-point\x3d"_pageMenuInfoNode"\x3e\x3c/h2\x3e\r\n        \x3cnav class\x3d"${_css.featureMenuViewport}"\x3e\r\n          \x3col class\x3d"${_css.featureMenuList}" role\x3d"menu" data-dojo-attach-point\x3d"_paginationNode"\x3e\x3c/ol\x3e\r\n        \x3c/nav\x3e\r\n      \x3c/section\x3e\r\n      \x3c!-- /Popup Menu --\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Popup Pointer --\x3e\r\n    \x3cdiv class\x3d"${_css.pointer}" role\x3d"presentation"\x3e\r\n      \x3cdiv class\x3d"${_css.pointerDirection} ${_css.shadow}"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- /Popup Pointer --\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- /Popup Container --\x3e\r\n\x3c/div\x3e\r\n'}});
define("./support/viewModelWiring ./Widgette ./Popup/PopupViewModel ../core/HandleRegistry ../core/watchUtils ../views/2d/viewpointUtils dijit/a11yclick dijit/_TemplatedMixin dojo/keys dojo/on dojo/query dojo/Deferred dojo/i18n!./Popup/nls/Popup dojo/text!./Popup/templates/Popup.html ../core/lang dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style ./Popup/PopupRenderer ./Popup/PopupRendererViewModel ./Spinner ./Message require".split(" "),function(y,G,
H,I,m,C,n,J,A,f,D,K,E,L,r,z,e,k,p,M,B,N,O,P,Q,R){var S=R.toUrl("./Popup/images/default-action.svg"),c={hidden:"esri-hidden",invisible:"esri-invisible",iconText:"esri-icon-font-fallback-text",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",
iconPaginationMenu:"esri-icon-layer-list",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-rotating esri-icon-loading-indicator",iconZoom:"esri-icon-zoom-in-magnifying-glass",base:"esri-popup",container:"esri-popup__position-container",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",shadow:"esri-popup--shadow",showDock:"esri-popup--dock-button-visible",showContent:"esri-popup--content-visible",showFooter:"esri-popup--footer-visible",showTitle:"esri-popup--title-visible",
showPagination:"esri-popup--pagination-visible",hasPopupRenderer:"esri-popup--has-popup-renderer",hasPromiseFeatures:"esri-popup--has-promise-features",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",
canDockToLeft:"esri-popup--can-dock-to-left",canDockToRight:"esri-popup--can-dock-to-right",canDockToTop:"esri-popup--can-dock-to-top",canDockToBottom:"esri-popup--can-dock-to-bottom",hasPaginationMenuOpen:"esri-popup--feature-menu-open",alignTop:"esri-popup--top-aligned",alignBottom:"esri-popup--bottom-aligned",alignLeftTop:"esri-popup--left-top-aligned",alignLeftBottom:"esri-popup--left-bottom-aligned",alignRightTop:"esri-popup--right-top-aligned",alignRightBottom:"esri-popup--right-bottom-aligned",
hasPendingPromises:"esri-popup--has-pending-promises",isPendingPromisesResult:"esri-popup--is-pending-promises-result",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",button:"esri-popup__button",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",actions:"esri-popup__actions",action:"esri-popup__action",
actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",pagination:"esri-popup__pagination",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",
paginationText:"esri-popup__pagination-page-text",paginationDocked:"esri-popup__pagination-docked",paginationDockedButtons:"esri-popup__pagination-docked-buttons",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",
featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title"},v={auto:"auto",topLeft:"top-left",topCenter:"top-center",topRight:"top-right",bottomLeft:"bottom-left",bottomCenter:"bottom-center",bottomRight:"bottom-right"},F={buttonEnabled:!0,position:v.auto,breakpoint:{width:544}},q={popupRenderer:"popup-renderer",acions:"actions",actionsChange:"actions-change",paginationTitles:"pagination-titles",view:"view"};return G.createSubclass([J],{declaredClass:"esri.widgets.Popup",
baseClass:c.base,templateString:L,constructor:function(){this._handleRegistry=new I;this._contentStorage=p.create("div")},postCreate:function(){var a=this;this.inherited(arguments);var b=this.viewModel;this.own(m.whenTrue(b,"view.ready",function(){this._wireUpView(this.viewModel.view)}.bind(this)),m.init(b,"pendingPromisesCount,featureCount,promises,location",function(){var a=this.viewModel;this._displayPendingFeaturesStatus(a.pendingPromisesCount,a.featureCount,a.promises,a.location)}.bind(this)),
m.init(b,"features",this._updateFeatures.bind(this)),m.init(b,"selectedFeatureIndex,selectedFeature",function(){var a=this.viewModel;this._updateSelectedFeature(a.selectedFeature);this._updateActions(a.actions,a.features,a.selectedFeature);this._updatePageText(a.features,a.selectedFeatureIndex);this._createPaginationNodes(a.features,a.selectedFeatureIndex);this._bodyContentNode.scrollTop=0}.bind(this)),m.init(b,"title",function(a){this._updateTitle(a);this.reposition()}.bind(this)),m.init(b,"actions",
function(a){var b=this.viewModel;this._updateActions(a,b.features,b.selectedFeature);this._actionChangeListener(a)}.bind(this)),m.init(b,"content",function(a){this._updateContent(a);this.reposition()}.bind(this)),m.init(b,"location",function(a){this._togglePopupLocationRepositioning(this.visible);this._autoAlign();this.reposition()}.bind(this)),f(this._dockNode,n,this._toggleDock.bind(this)),f(this._closeNode,n,this.close.bind(this)),f(this._previousNode,n,b.previous.bind(b)),f(this._previousDockedNode,
n,b.previous.bind(b)),f(this._nextNode,n,b.next.bind(b)),f(this._nextDockedNode,n,b.next.bind(b)),f(this._pageMenuNode,n,this._togglePageMenu.bind(this)),f(this._pageMenuDockedNode,n,this._togglePageMenu.bind(this)),f(this._pageMenuInfoNode,n,this._togglePageMenu.bind(this)),f(this._paginationNode,f.selector("li",n),function(){a._selectFeature(this)}),f(this._paginationNode,f.selector("li","keyup"),function(b){a._keyupFeature(b,this)}),f(this._actionsNode,f.selector("[data-action-index]",n),function(){a._actionEvent(this)}),
f(b,"trigger-action",function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()}.bind(this)));y.setUpEventDelegates(this,"trigger-action")},destroy:function(){this._destroyPopupRendererVMs();this._destroyMessage();this._destroySpinner();this._destroyPopupRenderer();this._handleRegistry.destroy();this._handleRegistry=null},properties:{_popupRenderer:{readOnly:!0,value:null},actions:{aliasOf:"viewModel.actions"},alignment:{value:"top",set:function(a){this._set("alignment",a);this.reposition()}},
autoPanEnabled:!0,autoAlignmentEnabled:!1,content:{aliasOf:"viewModel.content"},closeOnViewChangeEnabled:!1,currentDockPosition:{readOnly:!0,value:null},dockOptions:{value:F,set:function(a){var b=z.clone(F),d=this.viewModel.get("view.breakpoints"),c={};d&&(c.width=d.xsmall,c.height=d.xsmall);a=z.mixin({},b,a);b=z.mixin({},b.breakpoint,c);!0===a.breakpoint?a.breakpoint=b:"object"===typeof a.breakpoint&&(a.breakpoint=z.mixin({},b,a.breakpoint));this._set("dockOptions",a);this._toggleDockButton(a)}},
dockEnabled:{value:!1,set:function(a){this._set("dockEnabled",a);this._togglePopupDocking(a);this._togglePopupLocationRepositioning(this.visible);this._autoAlign();this.reposition()}},featureCount:{aliasOf:"viewModel.featureCount"},features:{aliasOf:"viewModel.features"},location:{aliasOf:"viewModel.location"},messageEnabled:{value:!0,set:function(a){this._set("messageEnabled",a);this._createMessage(a,this.viewModel.view)}},paginationEnabled:{value:!0,set:function(a){var b=this.viewModel;this._set("paginationEnabled",
a);this._updatePagination(b.features,b.selectedFeatureIndex);this._updateFooterVisibility(b.features,b.actions);this.reposition()}},promises:{aliasOf:"viewModel.promises"},rendered:{dependsOn:["viewModel.content","_popupRenderer.rendered"],get:function(){var a=this._contentIsPopupRenderer()&&this.get("_popupRenderer.rendered");return this._popupRenderer?a:!0},readOnly:!0},selectedFeature:{aliasOf:"viewModel.selectedFeature"},selectedFeatureIndex:{aliasOf:"viewModel.selectedFeatureIndex"},spinnerEnabled:{value:!0,
set:function(a){this._set("spinnerEnabled",a);this._createSpinner(a,this.viewModel.view)}},title:{aliasOf:"viewModel.title"},view:{aliasOf:"viewModel.view"},viewModel:{type:H},visible:{value:!1,set:function(a){this._set("visible",a);e.remove(this._containerNode,c.hasPaginationMenuOpen);e.toggle(this.domNode,c.invisible,!a);this._togglePopupLocationRepositioning(a);this._toggleContentVisibility(a);this._autoAlign();this.reposition()}}},_css:c,_i18n:E,_hideActionsTextNum:3,_animationDelay:10,_pointerOffset:16,
_popupRendererVMs:[],clear:y.createMethodDelegate("clear"),close:function(){this.set("visible",!1)},next:y.createMethodDelegate("next"),previous:y.createMethodDelegate("previous"),reposition:function(){this._positionPopup();return this._moveIntoView()},open:function(a){var b=z.mixin({updateLocationEnabled:!1},a);this.viewModel.set(b);a.promises?this.set("visible",!1):this.set("visible",!0)},triggerAction:y.createMethodDelegate("triggerAction"),_actionChangeListener:function(a){this._handleRegistry.remove(q.actionsChange);
a&&this._handleRegistry.add([a.on("change",function(){var a=this.viewModel;this._updateActions(a.actions,a.features,a.selectedFeature)}.bind(this))],q.actionsChange)},_actionEvent:function(a){var b=this.viewModel;if(a=k.get(a,"data-action-index"))a=parseInt(a,10),b.triggerAction(a)},_addContent:function(){var a=this.viewModel;this._updateSelectedFeature(a.selectedFeature);this._updateContent(a.content);this._updateTitle(a.title);this._updatePageText(a.features,a.selectedFeatureIndex)},_updateActions:function(a,
b,d){this._updateActionButtons(a,d);this._updateFooterVisibility(b,a);this.reposition()},_contentIsPopupRenderer:function(){var a=this.get("viewModel.content"),b=this.get("_popupRenderer.domNode");return!(!a||!(b&&a===b))},_updateActionButtons:function(a,b){this._handleRegistry.remove(q.actions);if(this._actionsNode){var d=document.createDocumentFragment(),s=a.length;s&&a.forEach(function(a,g){"zoom-to"===a.id&&(a.title=this._i18n.zoom,a.className=c.iconZoom);var l=a.title,h=a.className,x=a.image;
!x&&!h&&(x=S);var u=b&&b.attributes;u&&(l=l?r.substitute(u,l):"",h=h?r.substitute(u,h):null,x=x?r.substitute(u,x):null);var f=p.create("div",{tabindex:"0",title:l},d);k.set(f,"data-action-index",g);e.add(f,[c.button,c.action]);var w=p.create("span",{"aria-hidden":!0},f);e.add(w,c.icon);h&&e.add(w,h);x&&(e.add(w,c.actionImage),B.set(w,"background-image","url("+x+")"));l={className:c.actionText,textContent:l};s>=this._hideActionsTextNum&&(l.className=c.iconText);var n=p.create("span",l,f);this._handleRegistry.add([m.init(a,
"visible",function(a){e.toggle(f,c.hidden,!a)}),m.init(a,"className",function(a,b){u&&(a=r.substitute(u,a),b=r.substitute(u,b));e.remove(w,b);e.add(w,a)}),m.init(a,"image",function(a){u&&(a=r.substitute(u,a));e.toggle(w,c.actionImage,!!a);B.set(w,"background-image",a?"url("+a+")":"")}),m.init(a,"title",function(a){u&&(a=r.substitute(u,a));a=a||"";k.set(f,"title",a);k.set(n,"textContent",a)})],q.actions)},this);p.place(d,this._actionsNode,"only")}},_getLocationScreenPoint:function(){var a=this.viewModel,
b;if(a.location&&this.visible){var d=a.location;d&&a.get("view.ready")&&(b=a.view.toScreen(d))}return b},_calculatePosition:function(a,b,d){var c=this.alignment,t,g=this._pointerOffset,l=null,h=null,e=null,f=null;if(a&&b&&d){t=b.h;if("top"===c||"bottom"===c)t+=g;b=b.w;if("left-top"===c||"left-bottom"===c||"right-top"===c||"right-bottom"===c)b+=g,t+=g;var k=b/2,m=a.y,n=a.x,p=d.height-m,q=d.width-n,r=b;switch(c){case "bottom":l=m+g;h=n-k;r=k;break;case "left-top":e=p+g;f=q+g;break;case "left-bottom":l=
m+g;f=q+g;break;case "right-top":e=p+g;h=n+g;break;case "right-bottom":l=m+g;h=n+g;break;default:e=p+g,h=n-k,r=k}d=d.padding;d=this.dockEnabled?{left:d.left?d.left+"px":"",top:d.top?d.top+"px":"",right:d.right?d.right+"px":"",bottom:d.bottom?d.bottom+"px":""}:{top:null!==l?l+"px":"auto",left:null!==h?h+"px":"auto",bottom:null!==e?e+"px":"auto",right:null!==f?f+"px":"auto"};return{height:t,width:b,box:{top:null!==l?l:a.y-t,left:null!==h?h:a.x-r,bottom:null!==e?e:a.y+t,right:null!==f?f:a.x+r},style:d}}},
_createPopupRendererVMs:function(a){this._destroyPopupRendererVMs();a&&1<a.length&&a.forEach(function(a,d){var c=new O({contentEnabled:!1,graphic:a});this._popupRendererVMs.push(c)},this)},_destroyPopupRendererVMs:function(){this._handleRegistry.remove(q.paginationTitles);this._popupRendererVMs.forEach(function(a){a.destroy()});this._popupRendererVMs.length=0},_createPaginationNodes:function(a,b){this._handleRegistry.remove(q.paginationTitles);if(a){var d=a.length;this._paginationNode&&k.set(this._paginationNode,
"innerHTML","");1<d&&(d=r.substitute({total:d},this._i18n.selectedFeatures),k.set(this._pageMenuInfoNode,"textContent",d),a.forEach(function(a,d){var g=this._i18n.untitled,l=p.create("li",{role:"menuitem",className:c.featureMenuItem},this._paginationNode);d===b?(k.set(l,"aria-label",E.selectedFeature),e.add(l,c.featureMenuSelected)):k.set(l,"data-feature-index",d);var h=p.create("span",{className:c.featureMenuTitle,innerHTML:g},l);if(g=this._popupRendererVMs[d])g=m.init(g,"title",function(a){k.set(h,
"innerHTML",a)}),this._handleRegistry.add(g,q.paginationTitles);d===b&&p.create("span",{className:c.iconCheckMark},h)},this))}},_createMessage:function(a,b){this._destroyMessage();a&&b&&(this._message=new Q({visible:!1,text:this._i18n.noFeaturesFound,viewModel:{view:b}}),this._message.startup(),p.place(this._message.domNode,b.root))},_createSpinner:function(a,b){this._destroySpinner();a&&b&&(this._spinner=new P({visible:!1,viewModel:{view:b}}),this._spinner.startup(),p.place(this._spinner.domNode,
b.root))},_updateContent:function(a){a&&a.nodeName?(p.place(a,this._contentStorage),p.place(a,this._bodyContentNode,"only")):"string"===typeof a&&(this._destroyPopupRenderer(),k.set(this._bodyContentNode,"innerHTML",a));this._bodyContentNode.scrollTop=0;e.toggle(this._containerNode,c.hasPopupRenderer,this._contentIsPopupRenderer());e.toggle(this._containerNode,c.showContent,!!a);e.remove(this._containerNode,c.hasPaginationMenuOpen);this._autoAlign()},_destroyPopupRenderer:function(){this._popupRenderer&&
!this._popupRenderer._destroyed&&(this._handleRegistry.remove(q.popupRenderer),this._popupRenderer.destroy(),this._set("_popupRenderer",null))},_destroyMessage:function(){this._message&&(this._message.destroyRendering(),this._message.destroy(),this._message=null)},_destroySpinner:function(){this._spinner&&(this._spinner.destroyRendering(),this._spinner.destroy(),this._spinner=null)},_setDockEnabledForViewSize:function(a){a.breakpoint&&this.set("dockEnabled",this._shouldDockAtCurrentViewSize(a))},
_togglePopupDocking:function(a){e.remove(this._containerNode,c.hasPaginationMenuOpen);e.toggle(this._containerNode,c.isDocked,!!a);k.set(this._dockNode,"title",a?this._i18n.undock:this._i18n.dock);this._updateDockPosition(this.dockOptions)},_dockingThresholdCrossed:function(a,b,d){var c=a[0];a=a[1];var e=b[0];b=b[1];var g=d.width;d=d.height;return c<=g&&e>g||c>g&&e<=g||a<=d&&b>d||a>d&&b<=d},_determineDockPosition:function(a){var b=this.viewModel,d=b.view,c=d&&d.padding,c=d&&d.width-c.left-c.right;
return(b=d&&b.get("view.breakpoints"))&&c<=b.xsmall?a.bottomCenter:!this.isLeftToRight()?a.topLeft:a.topRight},_updateDockPosition:function(a){e.remove(this._containerNode,[c.isDockedTopLeft,c.isDockedTopCenter,c.isDockedTopRight,c.isDockedBottomLeft,c.isDockedBottomCenter,c.isDockedBottomRight,c.canDockToTop,c.canDockToBottom,c.canDockToLeft,c.canDockToRight]);var b,d,s;b=a.position;b=b===v.auto?this._determineDockPosition(v):"function"===typeof b?b.call(this):b;switch(b){case v.topLeft:d=c.isDockedTopLeft;
s=c.canDockToLeft;break;case v.topCenter:d=c.isDockedTopCenter;s=c.canDockToTop;break;case v.bottomLeft:d=c.isDockedBottomLeft;s=c.canDockToLeft;break;case v.bottomCenter:d=c.isDockedBottomCenter;s=c.canDockToBottom;break;case v.bottomRight:d=c.isDockedBottomRight;s=c.canDockToRight;break;default:d=c.isDockedTopRight,s=c.canDockToRight}e.toggle(this._containerNode,s,!!a.buttonEnabled);this.dockEnabled?(e.add(this._containerNode,d),this._set("currentDockPosition",b)):this._set("currentDockPosition",
null);this._popupRenderer&&this._popupRenderer.resize();this.reposition()},_toggleDockButton:function(a){var b=this._containerNode;e.toggle(b,c.showDock,!!a.buttonEnabled);e.toggle(b,c.isDocked,!!this.dockEnabled);this._updateDockPosition(a)},_updateFooterVisibility:function(a,b){var d=this._isPaginationEnabled(a)||b&&b.length;e.toggle(this._containerNode,c.showFooter,!!d)},_isPaginationEnabled:function(a){return this.paginationEnabled&&a&&1<a.length},_updatePagination:function(a,b){this._updatePageText(a,
b);this._createPaginationNodes(a,b);e.toggle(this._containerNode,c.showPagination,this._isPaginationEnabled(a))},_displayPendingFeaturesStatus:function(a,b,d,s){var t=0<a&&0===b;d=d&&d.length;a&&(d&&a===d)&&this.set("visible",!1);e.toggle(this._containerNode,c.hasPendingPromises,!!a);e.toggle(this._containerNode,c.isPendingPromisesResult,!!t);e.toggle(this._containerNode,c.hasPromiseFeatures,!!b);this._message&&this._message.set({visible:!1});t?this._spinner&&(this._spinner.set({visible:!0}),this._spinner.viewModel.point=
s):(this._spinner&&(this._spinner.viewModel.point=null),d&&b&&!this.visible?this.set("visible",!0):d&&(!b&&this.visible)&&this.set("visible",!1),!b&&d&&this._message&&(this._message.set({visible:!0}),this._message.viewModel.point=s))},_moveIntoView:function(){var a=new K;setTimeout(a.resolve.bind(this),this._animationDelay);return a.then(function(){if(!this._destroyed){var a=this.viewModel,d=this.get("viewModel.view");if(a&&d&&d.stationary){var c=this._getLocationScreenPoint();if(c){var e=this._sizePopup(),
e=this._calculatePosition(c,e,d),g=d.width,l=d.height,h=d.padding,f=d.ui.padding;if(this.autoPanEnabled&&!this.autoAlignmentEnabled){if(c.y<h.top||c.y>l-h.bottom||c.x<h.left||c.x>g-h.right)return a.centerAtLocation();if(!this.dockEnabled&&e&&e.width<d.width&&e.height<d.height){var k=c=0;e.box.top<h.top?k=-e.box.top+f.top+h.top:e.box.bottom>l-h.bottom&&(k=-(e.box.bottom-l+h.bottom)-f.bottom);e.box.left<h.left?c=e.box.left-f.left-h.left:e.box.right>g-h.right&&(c=e.box.right-g+h.right+f.right);if(c||
k)return e=C.translateBy(C.create(),d.viewpoint,[c,k]),d.goTo(e,a.animationOptions)}}}}}}.bind(this))},_isScreenPointWithinView:function(a,b){return b&&a&&-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height},_autoAlign:function(){if(this.autoAlignmentEnabled&&this.visible){var a=this.get("viewModel.view"),b=this._getLocationScreenPoint();if(this._isScreenPointWithinView(b,a)){var d=this._sizePopup(),c=this._pointerOffset,e=d.h+c,d=(d.w+c)/2,g,l,h,f,c=a.padding;b.x-d<0+c.left&&(l=!0);b.x+d>a.width-c.right&&
(g=!0);b.y-e<0+c.top&&(h=!0);b.y+e>a.height-c.bottom&&(f=!0);l?this._set("alignment",h?"right-bottom":"right-top"):g?this._set("alignment",h?"left-bottom":"left-top"):h?this._set("alignment",f?"top":"bottom"):this._set("alignment","top")}}},_positionPopup:function(){var a=this.viewModel.view;if(a){e.remove(this._containerNode,[c.alignTop,c.alignBottom,c.alignLeftTop,c.alignLeftBottom,c.alignRightTop,c.alignRightBottom]);this._triggerOffset();var b;switch(this.alignment){case "bottom":b=c.alignBottom;
break;case "right-top":b=c.alignRightTop;break;case "right-bottom":b=c.alignRightBottom;break;case "left-top":b=c.alignLeftTop;break;case "left-bottom":b=c.alignLeftBottom;break;default:b=c.alignTop}e.add(this._containerNode,b);b=this._getLocationScreenPoint();var d=this._sizePopup();(a=(a=this._calculatePosition(b,d,a))&&a.style)&&B.set(this._containerNode,a)}},_removeContent:function(){this._destroyPopupRenderer();k.set(this._bodyContentNode,"innerHTML","");k.set(this._titleNode,"innerHTML","");
k.set(this._pageTextNode,"innerHTML","");k.set(this._pageTextDockedNode,"innerHTML","");e.remove(this._containerNode,[c.showTitle,c.showContent])},_keyupFeature:function(a,b){var d=a.keyCode;if(d===A.UP_ARROW||d===A.DOWN_ARROW){a.stopPropagation();a.preventDefault();var c=D("li",this._paginationNode),e=c.length,g=c.indexOf(b),f;d===A.UP_ARROW?f=g-1:d===A.DOWN_ARROW&&(f=g+1);0>f?f=e-1:f>=e&&(f=0);c[f].focus()}},_selectFeature:function(a){var b=this.viewModel,d=-1;(a=k.get(a,"data-feature-index"))&&
(d=parseInt(a,10));-1!==d&&(b.selectedFeatureIndex=d);e.remove(this._containerNode,c.hasPaginationMenuOpen);this._pageMenuNode.focus()},_updateSelectedFeature:function(a){var b=this.viewModel,d,c="",e="";if(a){if(d=a.layer)c=d.id||"",e=d.title||"";if(!this._popupRenderer||this._popupRenderer&&this._popupRenderer._destroyed){this._handleRegistry.remove(q.popupRenderer);this._set("_popupRenderer",new N);d=m.init(this._popupRenderer.viewModel,"title",function(a){b.title=a});var g=m.init(this._popupRenderer.viewModel,
"content",function(a){b.content=a?this._popupRenderer.domNode:null}.bind(this)),l=f(this._popupRenderer,"resize",this.reposition.bind(this));this._handleRegistry.add([d,g,l],q.popupRenderer);this._popupRenderer.startup()}this._popupRenderer.viewModel.graphic=a}this._toggleFeatureUpdatedClass();k.set(this._containerNode,"data-layer-title",e);k.set(this._containerNode,"data-layer-id",c);this.reposition()},_updateFeatures:function(a){var b=this.viewModel;this._createPopupRendererVMs(a);this._updatePagination(a,
b.selectedFeatureIndex);this._updateFooterVisibility(a,b.actions);this.reposition()},_shouldDockAtCurrentViewSize:function(a){var b=this.viewModel;a=a.breakpoint;return b.view&&(a.hasOwnProperty("width")&&b.view.ui.width<=a.width||a.hasOwnProperty("height")&&b.view.ui.height<=a.height)},_sizePopup:function(){return M.getContentBox(this._containerNode)},_updateTitle:function(a){a=a||"";k.set(this._titleNode,"innerHTML",a);e.toggle(this._containerNode,c.showTitle,!!a);e.remove(this._containerNode,c.hasPaginationMenuOpen)},
_toggleDock:function(){this.set("dockEnabled",!this.dockEnabled)},_togglePageMenu:function(){e.toggle(this._containerNode,c.hasPaginationMenuOpen);var a=e.contains(this._containerNode,c.hasPaginationMenuOpen);k.set(this._pageMenuSectionNode,"aria-hidden",!a);var b=D("li",this._paginationNode),d=b[0];b.forEach(function(b){k.set(b,"tabIndex",a?"0":"")});a?d&&d.focus():this._pageMenuNode.focus()},_updatePageText:function(a,b){var d="";this._isPaginationEnabled(a)&&(d=r.substitute({index:b+1,total:a.length},
this._i18n.pageText));this._pageTextNode&&k.set(this._pageTextNode,{textContent:d});this._pageTextDockedNode&&k.set(this._pageTextDockedNode,{textContent:d})},_triggerOffset:function(){this._containerNode.offsetWidth=this._containerNode.offsetWidth},_toggleFeatureUpdatedClass:function(){e.remove(this._containerNode,c.hasFeatureUpdated);this._triggerOffset();e.add(this._containerNode,c.hasFeatureUpdated)},_viewPointChanged:function(){this.closeOnViewChangeEnabled?this.close():this._positionPopup()},
_wireUpView:function(a){this._handleRegistry.remove(q.view);this._viewPointEvent=null;if(a){var b="viewpoint";"3d"===a.type&&(b="camera");this._viewPointEvent=m.pausable(a,b,this._viewPointChanged.bind(this));this._handleRegistry.add([a.watch("padding",this.reposition.bind(this)),a.watch("size",this._updateDockEnabledForViewSize.bind(this)),f(a,"resize",this.reposition.bind(this)),this._viewPointEvent],q.view);this._togglePopupLocationRepositioning(this.visible);this._createMessage(this.messageEnabled,
a);this._createSpinner(this.spinnerEnabled,a);this._setDockEnabledForViewSize(this.dockOptions);this._toggleDockButton(this.dockOptions);this.reposition()}},_updateDockEnabledForViewSize:function(a,b){var d=this.get("viewModel.view.padding"),c=d.left+d.right,e=d.top+d.bottom,d=[],f=[];d[0]=a[0]-c;d[1]=a[1]-e;f[0]=b[0]-c;f[1]=b[1]-e;c=this.dockOptions;this._dockingThresholdCrossed(d,f,c.breakpoint)&&this._setDockEnabledForViewSize(c);this._updateDockPosition(c)},_togglePopupLocationRepositioning:function(a){var b=
this.viewModel;this._viewPointEvent&&(a&&b.location&&!this.dockEnabled?this._viewPointEvent.resume():this._viewPointEvent.pause())},_toggleContentVisibility:function(a){a?this._addContent():this._removeContent()}})});