// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["../support/GeolocationPositioning"],function(b){return b.createSubclass({properties:{state:{dependsOn:["view.ready","tracking"],readOnly:!0},tracking:{readOnly:!0}},declaredClass:"esri.widgets.Track.TrackViewModel",destroy:function(){this._viewReady&&this._viewReady.cancel();this._stopWatchingPosition()},_watchId:null,_trackStartingTimeoutId:null,state:"disabled",_stateGetter:function(){return!this._geolocationUsable?"feature-unsupported":!this.get("view.ready")?"disabled":this.tracking?
"tracking":null!==this._trackStartingTimeoutId?"waiting":"ready"},tracking:!1,_trackingGetter:function(){return null!==this._watchId},start:function(){"disabled"===this.state||this.tracking||this._startTracking()},stop:function(){"disabled"!==this.state&&this.tracking&&this._stopTracking()},_stopWatchingPosition:function(){null!==this._watchId&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=null);this.notifyChange("tracking")},_stopTracking:function(){this._stopWatchingPosition();
this._clear()},_startTracking:function(){this._stopWatchingPosition();var a=navigator.geolocation.watchPosition(function(b){this._watchId=a;this.notifyChange("tracking");this._setPosition(b).then(function(a){this._clearWaitingTimer();this.view.graphics.remove(this.graphic);this.graphic&&(this.graphic=this.graphic.clone(),this.view.graphics.push(this.graphic));this.emit("track",{position:a})}.bind(this)).otherwise(function(a){this._emitError(a);this._clearWaitingTimer();throw a;}.bind(this))}.bind(this),
this._handleWatchPositionError.bind(this),this.geolocationOptions);this._trackStartingTimeoutId=setTimeout(function(){this._trackStartingTimeoutId=null;this.notifyChange("state")}.bind(this),15E3);this.notifyChange("state")},_handleWatchPositionError:function(a){this._emitError(a);this._clearWaitingTimer()},_clearWaitingTimer:function(){clearTimeout(this._trackStartingTimeoutId);this._trackStartingTimeoutId=null;this.notifyChange("state")},_emitError:function(a){this.emit("track-error",{error:a})}})});