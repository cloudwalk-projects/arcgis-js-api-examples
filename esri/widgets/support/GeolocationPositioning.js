// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("../../config ../../core/Accessor ../../core/Error ../../core/Evented ../../core/promiseUtils ../../geometry/Point ../../geometry/support/webMercatorUtils ../../Graphic ../../portal/Portal ../../symbols/PictureMarkerSymbol ../../tasks/GeometryService ../../tasks/support/ProjectParameters dojo/_base/lang require".split(" "),function(f,k,g,l,d,m,n,p,q,r,s,t,h,u){return k.createSubclass([l],{properties:{geolocationOptions:{},goToLocationEnabled:{},graphic:{type:p},view:{}},declaredClass:"esri.widgets.support.GeolocationPositioning",
getDefaults:function(){return h.mixin(this.inherited(arguments),{geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0},graphic:{}})},initialize:function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext"),b=b&&window.isSecureContext||!b&&"https:"===window.location.protocol;if(!b||!a)this._geolocationUsable=!1;a||console.log(this.declaredClass,"navigator.geolocation unsupported.");b||console.log(this.declaredClass,"navigator.geolocation requires a secure origin.")},
destroy:function(){this._clear()},_geolocationUsable:!0,_iconPath:"../../images/support/sdk_gps_location.png",geolocationOptions:null,goToLocationEnabled:!0,graphic:null,_graphicSetter:function(a){a&&!a.symbol&&(a.symbol=new r({url:u.toUrl(this._iconPath),width:21,height:21}));this._set("graphic",a)},view:null,_clear:function(){this.view&&this.view.graphics.remove(this.graphic)},_positionToObject:function(a){return a?{coords:h.mixin({},a.coords),timestamp:a.timestamp}:{}},_getGeometryServiceUrl:function(){if(f.geometryServiceUrl)return d.resolve(f.geometryServiceUrl);
var a=q.getDefault();return a.load().always(function(){return a.get("helperServices.geometry.url")})},_projectPoint:function(a){var b=this.get("view.spatialReference");return b.isWGS84?d.resolve(a):b.isWebMercator?d.resolve(n.geographicToWebMercator(a)):this._getGeometryServiceUrl().then(function(c){if(!c)return d.reject(new g("geometry-service:missing-url","Geometry service URL is missing"));c=new s({url:c});var e=new t({geometries:[a],outSR:b});return c.project(e).then(function(a){return a[0]})})},
_getScale:function(a){a=a&&a.coords&&a.coords.accuracy;return this.scale||a||5E4},_createPoint:function(a){a=a&&a.coords;return!a?null:new m({longitude:a.longitude,latitude:a.latitude,z:a.altitude||null,spatialReference:{wkid:4326}})},_animatePoint:function(a,b,c){return!this.goToLocationEnabled?d.resolve(b):this.view.goTo({target:a,scale:c}).then(function(){return b})},_setPosition:function(a){a=this._positionToObject(a);var b=this.graphic,c=this._createPoint(a);c&&(b.geometry=c);var e=this._getScale(a);
return c?this._projectPoint(c).then(function(c){return this._animatePoint(c,a,e,b)}.bind(this)).then(function(){return a}):d.reject(new g("positioning:invalid-point","Cannot position invalid point"))}})});