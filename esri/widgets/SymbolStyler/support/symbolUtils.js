// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports dojo/Deferred dojo/dom-construct dojo/on dojo/_base/lang dojox/gfx dojox/gfx/matrix ../../Legend/support/swatchUtils ../../../core/screenUtils ../../../core/promiseUtils ../../../symbols/support/Symbol3DOutline".split(" "),function(Z,d,U,E,F,G,V,W,H,q,X,Y){function m(a,b){a[b]||(a[b]={})}function k(a,b){return-1<a.indexOf(b)}function h(a){return a&&"Icon"===a.type}function l(a){return a&&"Object"===a.type}function v(a){return a&&"Extrude"===a.type}function w(a){return a&&"Text"===
a.type}function x(a){return g(a,"simple-line","2d")}function r(a){return g(a,"simple-marker","2d")}function y(a){return g(a,"picture-marker","2d")}function e(a){return k(a.type,"3d")}function f(a){return a.symbolLayers.getItemAt(0)}function I(a,b){return g(a,"marker",b)||g(a,"point",b)}function g(a,b,c){b=k(a&&a.type,b+"-symbol");return!c?b:b&&("3d"===c?e(a):!e(a))}function J(a,b){return g(a,"line",b)}function K(a,b){return g(a,"fill",b)}function z(a){return e(a)?!1:a&&"string"===typeof a.style&&
k(n,a.style)}function A(a){if(e(a))return a=(a=f(a))&&"Fill"===a.type||h(a)&&L(a)?{color:a.outline.color,size:q.pt2px(a.outline.size)}:a&&"Line"===a.type||a&&"Path"===a.type?{color:a.material&&a.material.color,size:q.pt2px(a.size)}:null,a;a=x(a)?{color:a.color,size:a.width}:g(a,"fill","2d")||r(a)?{color:a.get("outline.color"),size:a.get("outline.width")}:null;return a}function M(a,b){if(!isNaN(b)&&a)if(e(a)){var c=f(a);h(c)||c&&"Fill"===c.type?(m(c,"outline"),c.outline.size=q.px2pt(b)):c&&"Line"===
c.type?(m(c,"size"),c.size=q.px2pt(b)):c&&"Path"===c.type&&(m(c,"size"),c.size=b)}else x(a)?a.width=b:a&&a.outline&&(a.outline.width=b)}function N(a,b){b&&(a&&!e(a))&&(b=A(a).color?b:"none",x(a)?a.style=b:a&&a.outline&&(a.outline.style=b))}function O(a,b){if(a&&!isNaN(b))if(e(a)){var c=f(a);if(h(c)||w(c))c.size=q.px2pt(b);else if(l(c)){var d=c.width,p=c.height,P=c.depth,s=Math.max(d,p,P),s=b/s;c.set({width:d*s,height:p*s,depth:P*s})}else v(c)&&(c.size=b)}else if(c=a.width,c!==b)if(y(a)){if(d=a.url,
p=Q({dimensions:a,targetDimension:"width",targetSize:b}),a.height=p.height,a.width=p.width,d&&!("http://"===d||!k(d,"http://")&&!k(d,"data:")))if(a.xoffset||a.yoffset)c=a.width/c,a.xoffset=Math.round(a.xoffset*c),a.yoffset=Math.round(a.yoffset*c)}else a.size=b}function R(a,b){e(a)?B(a,{color:b}):a.color=b}function C(a,b){if(e(a)){var c=f(a);c&&"Line"===c.type||c&&"Path"===c.type?B(a,{color:b}):(m(c,"outline"),c.outline.color=b)}else A(a).color=b}function Q(a){var b=a.dimensions,c=a.targetSize;return"height"===
("height"===a.targetDimension?"height":"width")?{height:c,width:b.width/b.height*c}:{height:b.height/b.width*c,width:c}}function B(a,b){var c=f(a);c.material=b.color?G.mixin({},c.material,b):void 0}function S(a){return h(a)&&k(n,a.get("resource.primitive"))}function L(a){return!h(a)?!1:a.outline&&!a.get("resource.href")}function T(a,b){if(e(a)&&e(b)){var c=f(a),d=f(b);return h(c)&&h(d)&&!c.resource.href&&!d.resource.href&&!k(n,c.resource.primitive)&&k(n,d.resource.primitive)}return D(a,b)}function D(a,
b){return r(a)&&r(b)&&!z(a)&&z(b)}var n=["x","cross"];d.is3d=e;d.getSymbolLayer=f;d.isPoint=I;d.hasExtrudeSymbolLayer=function(a){return e(a)&&v(f(a))};d.hasTextSymbolLayer=function(a){return e(a)&&w(f(a))};d.isLine=J;d.isPolygon=K;d.hasPureOutlineStyle=z;d.getOutline=A;d.setOutlineWidth=M;d.setOutlineStyle=N;d.setSize=O;d.getMarkerLength=function(a){if(e(a)){a=f(a);if(h(a)||w(a))return q.pt2px(a.size);if(l(a))return Math.max(a.width,a.height,a.depth);if(v(a))return a.size}else{if(r(a))return a.size;
if(y(a))return Math.max(a.width,a.height,a.depth)}};d.setFillColor=R;d.getFillColor=function(a){return e(a)?f(a).get("material.color"):a.color};d.setOutlineColor=C;d.renderOnSurface=function(a,b,c){void 0===c&&(c=24);return H.getSwatchInfo(a,c).then(function(c){var d=c.swatch,e=c.sizes[0],f=c.sizes[1],h=V.createSurface(b,e,f);try{if(null==d)throw"no shape descriptors!";d.forEach(function(b){var c=h.createGroup();b.forEach(function(a){var b=a.shape,d=a.fill,e=a.stroke;if(b){var f="text"===b.type;f&&
!b.text&&(b.text="Aa");"image"===b.type&&(b.src&&"data:"!==b.src.substr(0,5))&&(b.src+=(!k(b.src,"?")?"?":"\x26")+"legend\x3d1");b=c.createShape(b).setFill(d).setStroke(e?e:{width:0});f&&b.setFont(a.font)}});var d=c.getBoundingBox();b=d.width;var u=d.height,p=-(d.x+b/2),g=-(d.y+u/2),l=h.getDimensions(),p={dx:p+l.width/2,dy:g+l.height/2},g=!1;if((r(a)&&"path"===a.style||H.isVolumetricSymbol(a))&&0!==d.width&&0!==d.height){var g=d.width/d.height,m=1,n=1,t=r(a)&&"path"===a.style?q.pt2px(a.size):e>f?
e:f;isNaN(t)||(1<g?(m=t/d.width,n=t/g/d.height):(n=t/d.height,m=t*g/d.width));c.applyTransform(W.scaleAt(m,n,{x:l.width/2,y:l.height/2}));g=!0}if(!g&&(b>e||u>f))d=b/e>u/f,b=((d?e:f)-5)/(d?b:u),G.mixin(p,{xx:b,yy:b});c.applyTransform(p)})}catch(g){h.clear(),h.destroy()}return h})};d.preserveAspectRatio=Q;d.testImageUrl=function(a){var b=new U,c=E.create("img"),d=F(c,"load",function(){0===c.width&&0===c.height?b.reject("image has both width and height of 0"):b.resolve({width:c.width,height:c.height})}),
e=F(c,"error",function(a){b.reject("error ocurred while loading image",a)});c.src=a;b.promise.always(function(){d.remove();e.remove();E.destroy(c)});return b.promise};d.updateShape=function(a){e(a.symbol);O(a.symbol,a.size)};d.updateFill=function(a){e(a.symbol);R(a.symbol,a.color)};d.updateOutline=function(a){e(a.symbol)?C(a.symbol,a.color):(C(a.symbol,a.color),N(a.symbol,a.pattern));M(a.symbol,a.size)};d.blendsIntoBackground=function(a){if(e(a))return!1;var b=void 0;return(b=a&&a.outline?a.outline.color:
a.color)&&246<b.r&&246<b.g&&246<b.b};d.updateMaterial=B;d.ensureSupportedSimpleFillSymbolStyle=function(a){if(g(a,"simple-fill","2d")&&("none"!==a.style||"solid"!==a.style))a.style="solid"};d.getApplicableTabs=function(a,b){void 0===b&&(b=[]);if(e(a)){var c=b,d=f(a),g=d.type,h=["Icon","Object"],l=["Icon","Object","Fill","Extrude","Text"],m=["Icon","Fill","Line","Path"];return{shape:{state:k(c,"shape")||!k(h,g)?"excluded":"enabled"},fill:{state:k(c,"fill")||!k(l,g)?"excluded":S(d)?"disabled":"enabled"},
outline:{state:k(c,"outline")||!k(m,g)?"excluded":L(d)||S(d)?"enabled":"disabled"}}}var c=b,d=a.type,g=["simple-marker-symbol","picture-marker-symbol"],h=["simple-marker-symbol","simple-fill-symbol"],l=["simple-marker-symbol","simple-line-symbol","simple-fill-symbol"],m=J(a),n=K(a);return{shape:{state:k(c,"shape")||m||n?"excluded":k(g,d)?"enabled":"disabled"},fill:{state:k(c,"fill")||m?"excluded":h[0]===d&&k(["circle","square","diamond"],a.style)||h[1]===d?"enabled":"disabled"},outline:{state:k(c,
"outline")?"excluded":k(l,d)?"enabled":"disabled"}}};d.getSizeUnit=function(a){return e(a)&&(a=f(a).type,"Extrude"===a||"Object"===a)?"meters":"pixels"};d.getOutlineUnit=function(a){return e(a)&&"Path"===f(a).type?"meters":"pixels"};d.getSymbolSource=function(a){return e(a)?I(a)?(a=f(a),l(a)?"web-style:volumetric":h(a)?"web-style:flat":"web-style"):"web-style":"symbol-set"};d.getDimensionality=function(a){a=f(a).type;return"Object"===a||"Path"===a||"Extrude"===a?"volumetric":"flat"};d.ensureProps=
function(a){if(e(a)){var b=f(a);if(h(b)&&(b.outline||(b.outline=new Y.Symbol3DOutline({color:void 0,size:0})),void 0===b.size))return b.computeSize().then(function(c){b.size=c[0];return a});if(l(b)&&void 0===b.width&&void 0===b.height&&void 0===b.depth)return b.computeSize().then(function(c){b.set({width:c[0],height:c[1],depth:c[2]});return a})}return X.resolve(a)};d.switchedFromRasterToVectorSymbol=function(a,b){if(e(a)&&e(b)){var c=f(a),d=f(b);return h(c)&&l(d)&&!!c.resource.href&&!d.resource.href&&
!!d.resource.primitive}return y(a)&&r(b)};d.switchedToPureOutline=T;d.switchedFromPureOutline=function(a,b){return e(a)&&e(b)?T(b,a):D(b,a)};d.switchedSmsStyleToPureOutline=D});