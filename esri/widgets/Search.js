// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/widgets/Search/templates/Search.html":'\x3cdiv role\x3d"presentation"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${_css.container}" data-dojo-attach-point\x3d"_containerNode"\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.searchIn}" id\x3d"${id}_menu_button" class\x3d"${_css.sourcesButton} ${_css.button}" tabindex\x3d"0" data-dojo-attach-point\x3d"_sourceButtonNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${_css.dropdownIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${_css.dropupIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${_css.sourceName}" data-dojo-attach-point\x3d"_sourceNameNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_sourcesNode" class\x3d"${_css.menu} ${_css.sourcesMenu}" role\x3d"menu"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${_css.inputContainer}"\x3e\r\n      \x3cform class\x3d"${_css.form}" data-dojo-attach-point\x3d"_formNode" role\x3d"search"\x3e\r\n        \x3cinput aria-label\x3d"${_i18n.searchButtonTitle}" maxlength\x3d"${viewModel.maxInputLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${_css.input}" value\x3d"${viewModel.searchTerm}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"_inputNode" role\x3d"textbox"\x3e\r\n      \x3c/form\x3e\r\n      \x3cdiv role\x3d"button" class\x3d"${_css.clearButton} ${_css.button}" tabindex\x3d"0" data-dojo-attach-point\x3d"_clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${_css.clearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${_css.spinnerIcon} ${_css.rotating}"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_suggestionsNode" class\x3d"${_css.menu} ${_css.suggestionsMenu}" role\x3d"menu"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.searchButtonTitle}" class\x3d"${_css.submitButton} ${_css.button}" tabindex\x3d"0" data-dojo-attach-point\x3d"_submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${_css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${_css.fallbackText}"\x3e${_i18n.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_noResultsMenuNode" class\x3d"${_css.menu} ${_css.noResultsMenu}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("../core/lang ../core/watchUtils ./Search/SearchViewModel ./support/viewModelWiring ./Widgette dijit/_FocusMixin dijit/_TemplatedMixin dijit/a11yclick dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!./Search/nls/Search dojo/text!./Search/templates/Search.html".split(" "),function(y,u,t,w,z,A,B,s,x,n,l,f,k,e,v,q,C){var d={base:"esri-search",hasValue:"esri-search--has-value",hasMultipleSources:"esri-search--multiple-sources",isSearchLoading:"esri-search--loading",
showSuggestions:"esri-search--show-suggestions",showSources:"esri-search--sources",showNoResults:"esri-search--no-results",container:"esri-search__container",input:"esri-search__input",inputContainer:"esri-search__input-container",form:"esri-search__form",submitButton:"esri-search__submit-button",sourcesButton:"esri-search__sources-button",clearButton:"esri-search__clear-button",sourceName:"esri-search__source-name",suggestionsMenu:"esri-search__suggestions-menu",sourcesMenu:"esri-search__sources-menu",
source:"esri-search__source",activeSource:"esri-search__source--active",noResultsMenu:"esri-search__no-results-menu",noResultsBody:"esri-search__no-results-body",noResultsHeader:"esri-search__no-results-header",noResultsText:"esri-search__no-results-text",noValueText:"esri-search__no-value-text",showMoreResults:"esri-search__more-results--show-more-results",moreResults:"esri-search__more-results",moreResultsList:"esri-search__more-results-list",moreResultsHeader:"esri-search__more-results-header",
moreResultsLatLonHeader:"esri-search__more-results-lat-long-header",moreResultsItem:"esri-search__more-results-item",moreResultsListHeader:"esri-search__more-results-list-header",button:"esri-widget-button",fallbackText:"esri-icon-font-fallback-text",rotating:"esri-rotating",menu:"esri-menu",header:"esri-header",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",
spinnerIcon:"esri-icon-loading-indicator",noticeIcon:"esri-icon-notice-triangle"};return z.createSubclass([B,A],{declaredClass:"esri.widgets.Search",baseClass:d.base,templateString:C,postCreate:function(){this.inherited(arguments);var a=this,b=this.viewModel,c=this.id+"_more_results";this._moreResultsId=c;b.getExtraSearchResultAttributes=this._getExtraSearchResultAttributes.bind(this);b.popupTemplate.set({title:q.searchResult,content:'\x3cdiv class\x3d"{searchTheme}"\x3e\x3cdiv id\x3d"{searchMoreResultsId}" class\x3d"{searchMoreResults}"\x3e\x3cdiv class\x3d"{searchMoreResultsItem}"\x3e{searchResult}\x3c/div\x3e\x3cdiv\x3e{searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'});
this.own(u.init(b,"placeholder",function(a){var c=this._getSourceName(b.activeSourceIndex);n.set(this._sourceNameNode,"textContent",c);n.set(this._inputNode,{placeholder:a})}.bind(this)),u.init(b,"searchTerm",function(a){var c=a?q.clearButtonTitle:"";a||(b.clear(),this._hideMenus(),this._hideLoading());a!==this._inputNode.value&&n.set(this._inputNode,"value",a);n.set(this._clearNode,"title",c);l.toggle(this._containerNode,d.hasValue,a)}.bind(this)),u.init(b,"sources, activeSourceIndex",function(){this._updateSourcesMenu(b.sources)}.bind(this)),
u.init(b,"activeSourceIndex",function(){this._updateSourcesMenu(b.sources)}.bind(this)),u.init(b,"view.popup",function(a){(a=a&&a.domNode)&&b.popupEnabled&&this.own(e(a,e.selector("#"+c+"_show",s),this._handleShowMoreResultsClick.bind(this)),e(a,e.selector("#"+c+"_list li a",s),this._handleMoreResultClick.bind(this)),e(a,e.selector("#"+c+" [data-switch-coordinates]",s),this._handleSwitchCoordinatesClick.bind(this)))}.bind(this)),b.on("search-complete",function(a){0===a.numResults&&(this._createEmptyResultsStructure(a.searchTerm),
this._showNoResultsMenu());this._hideLoading()}.bind(this)),b.on("suggest-complete",function(a){this._updateSuggestionsMenu(a.results,a.searchTerm)}.bind(this)),b.on("select-result",function(){this._hideMenus();this._hideLoading()}.bind(this)),b.on("search-start",function(){this._hideMenus();this._showLoading()}.bind(this)),b.on("search-clear, search-start",this._closePopup.bind(this)),e(this._submitNode,s,this._handleSearchButtonClick.bind(this)),e(this._sourceButtonNode,s,this._handleSourcesMenuToggleClick.bind(this)),
e(this._inputNode,s,this._handleInputClick.bind(this)),e(this._clearNode,s,this._handleClearButtonClick.bind(this)),e(this._formNode,"submit",function(a){a.preventDefault();b.cancelSuggest();b.search()}.bind(this)),e(this._inputNode,"keyup",this._handleInputKey.bind(this)),e(this._sourceButtonNode,"keyup",this._handleSourceButtonKey.bind(this)),e(this._suggestionsNode,"li:click, li:keyup",function(b){a._suggestionsEvent(b,this)}),e(this._sourcesNode,"li:click, li:keyup",function(b){a._sourcesEvent(b,
this)}),e(this._inputNode,"input, paste",function(){b.searchTerm!==this._inputNode.value&&(b.searchTerm=this._inputNode.value);b.suggest()}.bind(this)),this.on("blur",function(){this._hideMenus()}.bind(this)));w.setUpEventDelegates(this,"search-clear search-complete search-start select-result suggest-start suggest-complete".split(" "))},_css:d,_i18n:q,properties:{activeSource:{aliasOf:"viewModel.activeSource"},activeSourceIndex:{aliasOf:"viewModel.activeSourceIndex"},allPlaceholder:{aliasOf:"viewModel.allPlaceholder"},
autoNavigate:{aliasOf:"viewModel.autoNavigate"},autoSelect:{aliasOf:"viewModel.autoSelect"},defaultSource:{aliasOf:"viewModel.defaultSource"},locationToAddressDistance:{aliasOf:"viewModel.locationToAddressDistance"},maxResults:{aliasOf:"viewModel.maxResults"},maxSuggestions:{aliasOf:"viewModel.maxSuggestions"},minSuggestCharacters:{aliasOf:"viewModel.minSuggestCharacters"},popupEnabled:{aliasOf:"viewModel.popupEnabled"},popupOpenOnSelect:{aliasOf:"viewModel.popupOpenOnSelect"},popupTemplate:{aliasOf:"viewModel.popupTemplate"},
resultGraphic:{aliasOf:"viewModel.resultGraphic"},resultGraphicEnabled:{aliasOf:"viewModel.resultGraphicEnabled"},results:{aliasOf:"viewModel.results"},searchAllEnabled:{aliasOf:"viewModel.searchAllEnabled"},searchTerm:{aliasOf:"viewModel.searchTerm"},selectedResult:{aliasOf:"viewModel.selectedResult"},sources:{aliasOf:"viewModel.sources"},suggestions:{aliasOf:"viewModel.suggestions"},suggestionsEnabled:{aliasOf:"viewModel.suggestionsEnabled"},view:{aliasOf:"viewModel.view"},viewModel:{type:t}},clear:function(){var a=
this.viewModel;a.clearGraphics();n.get(this._inputNode,"value")&&n.set(this._inputNode,"value","");a.searchTerm="";l.remove(this._containerNode,d.hasValue);n.set(this._clearNode,"title","");this._hideMenus();this._hideLoading();this._closePopup()},focus:function(){this._focusManager.focus(this._inputNode)},blur:function(){this._inputNode.blur();this._focusManager.curNode&&this._focusManager.curNode.blur()},search:w.createMethodDelegate("search"),suggest:w.createMethodDelegate("suggest"),_getSourceName:function(a){var b=
this.viewModel.sources;return a===t.ALL_INDEX?q.all:b.getItemAt(a).name},_getExtraSearchResultAttributes:function(a){return{searchTheme:d.root,searchResult:this._toSearchResultHTML(a),searchMoreResults:d.moreResults,searchMoreResultsItem:d.moreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._toMoreResultsHTML()}},_handleClearButtonClick:function(){this.viewModel.clear();this.focus()},_handleSwitchCoordinatesClick:function(a){a.preventDefault();a=n.get(a.target,"data-switch-coordinates");
var b=this.viewModel;a&&(b.cancelSuggest(),b.searchTerm=a,b.search())},_handleMoreResultClick:function(a){a.preventDefault();var b=a.target;a=parseInt(n.get(b,"data-source-index"),10);var c=parseInt(n.get(b,"data-index"),10),b=this.viewModel,h=b.results;h&&h[a]&&h[a].results&&(a=h[a].results[c])&&b.select(a)},_handleShowMoreResultsClick:function(a){a.preventDefault();var b=this._moreResultsId;if(a=x.byId(b))if(l.toggle(a,d.showMoreResults),b=x.byId(b+"_show"))a=l.contains(a,d.showMoreResults)?q.hideMoreResults:
q.showMoreResults,n.set(b,"textContent",a);this._repositionPopup()},_closePopup:function(){var a=this.viewModel;a.popupEnabled&&a.get("view.popup")&&a.view.popup.set("visible",!1)},_repositionPopup:function(){var a=this.viewModel;a.get("view.popup")&&a.view.popup.reposition()},_sourcesEvent:function(a,b){var c=n.get(b,"data-index"),h=v("li",this._sourcesNode),d=h.indexOf(b),g=a.keyCode,c=parseInt(c,10);g===k.ESCAPE?(this._hideSourcesMenu(),this.focus()):"click"===a.type||g===k.ENTER?(this.viewModel.activeSourceIndex=
c,this.focus(),this._updateSourcesMenu(this.viewModel.sources),this._hideSourcesMenu()):g===k.UP_ARROW?(a.stopPropagation(),a.preventDefault(),c=d-1,h=0>c?this._sourceButtonNode:h[c],this._focusManager.focus(h)):g===k.DOWN_ARROW&&(a.stopPropagation(),a.preventDefault(),c=d+1,h=c>=h.length?this._sourceButtonNode:h[c],this._focusManager.focus(h))},_suggestionsEvent:function(a,b){var c=n.get(b,"data-source-index"),d=parseInt(n.get(b,"data-index"),10),r=v("li",this._suggestionsNode),g=this.viewModel,
f=g.sources,e=r.indexOf(b),m=a.keyCode,c=parseInt(c,10);g.cancelSuggest();if(m===k.BACKSPACE||m===k.DELETE)this.focus();else if(m===k.ESCAPE)this._hideMenus(),this.focus();else if(m===k.UP_ARROW)a.stopPropagation(),a.preventDefault(),g=e-1,0>g?this.focus():this._focusManager.focus(r[g]);else if(m===k.DOWN_ARROW)a.stopPropagation(),a.preventDefault(),g=e+1,g>=r.length?this.focus():this._focusManager.focus(r[g]);else if("click"===a.type||m===k.ENTER){for(var r=g.suggestions,p,e=0;e<r.length;e++)if(m=
r[e],m.sourceIndex===c){p=m.results;p=p[d];break}p&&(p.index=c,f.getItemAt(c).featureLayer?(c=f.getItemAt(c).featureLayer.objectIdField,p[t.OBJECT_ID_FIELD]=p.feature.attributes[c]):p.magicKey&&p.text&&(g.searchTerm=p.text,g.currentSuggestion=p),g.search(p),this.focus())}},_toSearchResultHTML:function(a){if(!a.feature||!a.feature.attributes||!(a.feature.attributes.Addr_type&&"LatLong"===a.feature.attributes.Addr_type))return a.name;var b=a.name.split(" "),c,h;2===b.length&&(c=b[0],h=b[1]);if(!h||
!c)return a.name;c=parseFloat(c);h=parseFloat(h);a=h+", "+c;b=""+('\x3cdiv class\x3d"'+d.moreResultsItem+'"\x3e');b+='\x3cdiv class\x3d"'+d.moreResultsLatLonHeader+'"\x3e'+q.lonlat+"\x3c/div\x3e";b+=c+", "+h;b=b+"\x3c/div\x3e"+('\x3cdiv class\x3d"'+d.moreResultsItem+'"\x3e');this._validSwitchCoordinates(h,c)&&(b+='\x3cdiv class\x3d"'+d.moreResultsLatLonHeader+'"\x3e'+q.reverseLonLatHeader+"\x3c/div\x3e",b+='\x3ca data-switch-coordinates\x3d"'+a+'" tabindex\x3d"0" href\x3d"#"\x3e'+a+"\x3c/a\x3e",b+=
"\x3c/div\x3e");return b},_validSwitchCoordinates:function(a,b){return b!==a&&!(90<b||-90>b||180<a||-180>a)},_toMoreResultsHTML:function(){var a=this.viewModel,b="",c="",h=a.results,r=a.sources,g=0,f,e;if(h){for(var c=c+('\x3cdiv class\x3d"'+d.moreResultsItem+'"\x3e'),c=c+('\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+q.showMoreResults+"\x3c/a\x3e"),c=c+"\x3c/div\x3e"+('\x3cdiv class\x3d"'+d.moreResultsList+'"\x3e'),c=c+('\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e'),m=0;m<h.length;m++)if(e=
(f=h[m].results)&&0<f.length){e=f.length;var k=1===e&&f[0]===f;if(1<this._totalResults(h)&&!k)var l=this._getSourceName(m),c=c+('\x3cdiv class\x3d"'+d.moreResultsListHeader+'"\x3e'+l+"\x3c/div\x3e");if(e&&!k){c+="\x3cul\x3e";k=r.getItemAt(m).maxResults||a.maxResults;for(l=0;l<e&&l<k;++l)f[l]!==f&&a.selectedResult!==f[l]&&(c+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+l+'" data-source-index\x3d"'+m+'" href\x3d"#"\x3e'+f[l].name+"\x3c/a\x3e\x3c/li\x3e",g++);c+="\x3c/ul\x3e"}}c+="\x3c/div\x3e";
c+="\x3c/div\x3e"}0<g&&(b+=c);return b},_totalResults:function(a){return Object.keys(a).length},_handleSearchButtonClick:function(){var a=this.viewModel;a.cancelSuggest();a.search()},_handleSourceButtonKey:function(a){if(a){var b=a.keyCode===k.UP_ARROW,c=a.keyCode===k.DOWN_ARROW;if(b||c)a.stopPropagation(),a.preventDefault(),this._showSourcesMenu(),a=v("li",this._sourcesNode),this._focusManager.focus(a[b?a.length-1:0])}},_handleInputKey:function(a){if(a){var b=a.keyCode,c=a.ctrlKey||a.metaKey||b===
k.copyKey||b===k.LEFT_ARROW||b===k.RIGHT_ARROW||b===k.ENTER,d=v("li",this._suggestionsNode),f=this.viewModel,g=f.suggestions;if(c)return a;b===k.TAB||b===k.ESCAPE?(f.cancelSuggest(),this._hideMenus()):(c=b===k.UP_ARROW,b=b===k.DOWN_ARROW,c||b?(a.stopPropagation(),a.preventDefault(),f.cancelSuggest(),b&&g&&this._showSuggestionsMenu(),a=c?d.length-1:0,this._focusManager.focus(d[a])):f.suggest())}},_handleInputClick:function(){this._hideSourcesMenu();this._hideNoResultsMenu()},_updateSuggestionsMenu:function(a,
b){var c=this.viewModel;if(this._suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var h,e=c.sources;if(a){h=f.create("div");for(var g=0;g<a.length;g++)if(a[g]&&a[g].results&&a[g].results.length){var l=this._getSourceName(g);1<e.length&&c.activeSourceIndex===t.ALL_INDEX&&f.create("div",{className:d.header,textContent:l},h);for(var l=f.create("ul",{},h),k=e.getItemAt(g).maxSuggestions||c.maxSuggestions,m=0;m<a[g].results.length&&m<k;++m){var p=f.create("li",{"data-index":m,"data-source-index":a[g].sourceIndex,
role:"menuitem",tabindex:0},l),n=a[g].results[m];(n.text||n.name).replace(RegExp("("+b+")","gi"),"|$1|").split("|").forEach(function(a){a.toLowerCase()===b.toLowerCase()?f.create("strong",{textContent:a},p):(a=document.createTextNode(a),f.place(a,p))})}}f.place(h,this._suggestionsNode,"only");this._suggestionsNode.scrollTop=0;this._showSuggestionsMenu()}else f.empty(this._suggestionsNode),this._hideSuggestionsMenu()}},_updateSourcesMenu:function(a){var b=this.viewModel,c=this._containerNode,h=this._sourcesNode;
if(!a||1>=a.length)l.remove(c,d.hasMultipleSources),f.empty(h);else{var e,g=b.activeSourceIndex,k=f.create("ul");b.searchAllEnabled&&f.create("li",{"data-index":t.ALL_INDEX,role:"menuitem",className:g===t.ALL_INDEX?d.source+" "+d.activeSource:d.source,tabIndex:0,textContent:q.all},k);for(e=0;e<a.length;e++)b=e===g?d.source+" "+d.activeSource:d.source,f.create("li",{"data-index":e,role:"menuitem",className:b,tabIndex:0,textContent:this._getSourceName(e)},k);l.add(c,d.hasMultipleSources);f.place(k,
h,"only");h.scrollTop=0}},_showLoading:function(){l.add(this._containerNode,d.isSearchLoading)},_hideLoading:function(){l.remove(this._containerNode,d.isSearchLoading)},_createEmptyResultsStructure:function(a){var b=a&&a.trim(),c=f.create("div",{className:d.noResultsBody});a&&b?(f.create("div",{className:d.noResultsHeader,textContent:q.noResults},c),f.create("div",{className:d.noResultsText,textContent:y.substitute({value:'"'+a+'"'},q.noResultsFound)},c)):(a=f.create("div",{},c),f.create("span",{"aria-hidden":"true",
className:d.noticeIcon},a),f.create("span",{className:d.noValueText,textContent:q.emptyValue},a));f.place(c,this._noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){l.remove(this._containerNode,d.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();l.add(this._containerNode,d.showNoResults)},_hideSourcesMenu:function(){l.remove(this._containerNode,
d.showSources)},_hideSuggestionsMenu:function(){l.remove(this._containerNode,d.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();l.add(this._containerNode,d.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();l.add(this._containerNode,d.showSuggestions)},_handleSourcesMenuToggleClick:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();l.toggle(this._containerNode,d.showSources)}})});