// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(u,v,w,q){var f,r,p,s=q.angle,t=q.lerp,y=q.slerpOrLerp,c=w.vec3d,k=w.mat3d,g=c.create(),l=c.create(),h=c.create(),d=c.create(),m=c.create();f=c.createFrom(0,0,1);r=c.createFrom(0,1,0);p=c.createFrom(1,0,0);var x=k.create();u=function(){function e(a){void 0===a&&(a="global");this.viewingMode=a;this.center=c.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=c.create(r)}e.prototype.pixelsPerPanAtZoom=
function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.pixelsPerRotateAtZoom=function(a){a=Math.max(Math.cos(Math.abs(this.pitch)),0.5);return this.size/2/a};e.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var n=c.length(this.center),d=c.length(a.center);b.pan=s(this.center,a.center)*((n+d)/2)}else b.pan=c.dist(this.center,a.center);
n=Math.abs(a.yaw-this.yaw);n>=Math.PI&&(n=2*Math.PI-n);d=Math.abs(a.pitch-this.pitch);b.rotate=Math.max(n,d);b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};e.prototype.interpolate=function(a,b,d){"global"===this.viewingMode?y(a.center,b.center,d.pan,this.center,z):c.lerp(a.center,b.center,d.pan,this.center);this.distance=t(a.distance,b.distance,d.zoom);this.pitch=t(a.pitch,b.pitch,d.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);this.yaw=t(a,b,d.rotate)};e.prototype.copyFrom=
function(a){c.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;c.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};e.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,x);c.set(a.center,this.center);k.multiplyVec3(b,c.subtract(a.center,a.eye,d));k.multiplyVec3(b,a.up,m);this.distance=c.length(d);d[0]/=this.distance;d[1]/=this.distance;d[2]/=this.distance;this.pitch=
this._eyeUpToPitch(d,m);this.yaw=this._eyeUpToYaw(d,m);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};e.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(0.5*this.fov)};e.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,x);k.transpose(b);this._axisAngleVec3(p,this.pitch-Math.PI/2,r,d);this._axisAngleVec3(f,this.yaw,d);this._axisAngleVec3(p,this.pitch-Math.PI/2,f,m);this._axisAngleVec3(f,this.yaw,m);
c.scale(d,this.distance);k.multiplyVec3(b,d);k.multiplyVec3(b,m);a.center=this.center;a.eye=c.subtract(this.center,d,d);a.up=m};e.prototype._axisAngleVec3=function(a,b,d,e){void 0===e&&(e=d);var f=Math.cos(b);b=Math.sin(b);c.scale(d,f,g);c.scale(c.cross(a,d,l),b);c.scale(a,(1-f)*c.dot(a,d),h);return c.add(c.add(g,l,e),h,e)};e.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,h);c.normalize(c.cross(this.lookAtDirection,h,g));0===g[0]&&(0===g[1]&&0===g[2])&&c.set(p,g);c.normalize(c.cross(h,
g,l));b||(b=k.create());b[0]=g[0];b[1]=l[0];b[2]=h[0];b[3]=g[1];b[4]=l[1];b[5]=h[1];b[6]=g[2];b[7]=l[2];b[8]=h[2];return b};e.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?c.set(f,b):c.normalize(a,b)};e.prototype._eyeUpToPitch=function(a,b){return Math.PI-s(f,a)};e.prototype._eyeUpToYaw=function(a,b){var d=0.5>Math.abs(b[2])?b:a;return s(p,c.normalize(c.cross(d,f,l)),f)};return e}();var z=1E-4;Object.defineProperty(v,"__esModule",{value:!0});v.default=u});