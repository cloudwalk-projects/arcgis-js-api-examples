// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),function(t,B,r,y,z,C){var u=z.vec3d,s=z.mat4d,D=C.Vec3Compact,d=u.create(),h=u.create(),n=u.create(),k=r.deg2rad(1),v=r.rad2deg(1),A=new t({wkt:'      GEOCCS["Spherical geocentric",        DATUM["Not specified",          SPHEROID["Sphere",'+y.earthRadius+',0]],        PRIMEM["Greenwich",0.0,          AUTHORITY["EPSG","8901"]],        UNIT["m",1.0],        AXIS["Geocentric X",OTHER],        AXIS["Geocentric Y",EAST],        AXIS["Geocentric Z",NORTH]      ]    '}),
g=y.earthRadius,p=function(a){return a===A?1:a.isWGS84?2:a.isWebMercator?3:0};t=function(a,c,b,e){b[e++]=a[c++];b[e++]=a[c++];b[e]=a[c]};var w=function(a,c,b,e){var d=0.4999999*Math.PI,f=k*a[c+1],f=r.clamp(f,-d,d),d=Math.sin(f);b[e++]=k*a[c]*g;b[e++]=g/2*Math.log((1+d)/(1-d));b[e]=a[c+2]},x=function(a,c,b,e){var d=g+a[c+2],f=k*a[c+1];a=k*a[c];c=Math.cos(f);b[e++]=Math.cos(a)*c*d;b[e++]=Math.sin(a)*c*d;b[e]=Math.sin(f)*d},E=[void 0,x,t,w],q=[void 0,function(a,c,b,e){var d=D.length(a,c),f=r.asin(a[c+
2]/d),h=Math.cos(f);a=(0<a[c+1]?1:-1)*r.acos(a[c]/(h*d));b[e++]=v*a;b[e++]=v*f;b[e]=d-g},t,function(a,c,b,e){b[e++]=v*(a[c++]/g);b[e++]=v*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/g)));b[e]=a[c]}];return{SphericalRenderSpatialReference:A,vectorToVector:function(a,c,b,e){2===a.length?(d[0]=a[0],d[1]=a[1],d[2]=0,a=d):a===b&&(u.set(a,d),a=d);return this.bufferToBuffer(a,c,0,b,e,0,1)},pointToVector:function(a,c,b){d[0]=a.x;d[1]=a.y;d[2]=a.z||0;return this.bufferToBuffer(d,a.spatialReference,0,c,b,0,1)},
vectorToPoint:function(a,c,b,e){"esri.SpatialReference"===b.declaredClass?(e=b,b=new B({spatialReference:e})):e=e||b.spatialReference;return this.bufferToBuffer(a,c,0,d,e,0,1)?(b.x=d[0],b.y=d[1],b.z=d[2],b.spatialReference=e,b):null},xyzToVector:function(a,c,b,e,m,f){d[0]=a;d[1]=c;d[2]=b;return this.bufferToBuffer(d,e,0,m,f,0,1)},bufferToBuffer:function(a,c,b,e,d,f,g){g=g||1;var l=p(c),k=p(d);g=b+3*g;if(l===k&&(0!==l||c.equals(d))){if(e!==a||b!==f)for(;b<g;b++,f++)e[f]=a[b]}else if(0<l&&0<k)if(2!==
k)if(d=E[k],2!==l)for(l=q[l];b<g;b+=3,f+=3)l(a,b,h,0,c.wkid),d(h,0,e,f);else for(;b<g;b+=3,f+=3)d(a,b,e,f);else for(l=q[l];b<g;b+=3,f+=3)l(a,b,e,f,c.wkid);else return!1;return!0},computeLinearTransformation:function(a,c,b,e){var d=p(a),f=p(e);if(d===f&&(0!==d||a.equals(e)))return s.identity(b),s.translate(b,c),!0;if(1===f){if(e=q[d])return e(c,0,h,0,a.wkid),x(h,0,n,0),e=k*h[0],c=k*h[1],a=Math.sin(e),e=Math.cos(e),d=Math.sin(c),c=Math.cos(c),b[0]=-a,b[4]=-d*e,b[8]=c*e,b[12]=n[0],b[1]=e,b[5]=-d*a,b[9]=
c*a,b[13]=n[1],b[2]=0,b[6]=c,b[10]=d,b[14]=n[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===f&&(2===d||1===d))return q[d](c,0,h,0,a.wkid),a=k*h[1],w(h,0,n,0),s.identity(b),s.translate(b,n),a=1/Math.cos(a),s.scale(b,[a,a,1]),!0;return!1},mbsToMbs:function(a,c,b,d){var m=p(c),f=p(d);if(m===f&&(0!==m||c.equals(d)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===f){if(d=q[m])return d(a,0,h,0,c.wkid),x(h,0,b,0),b[3]=a[3],!0}else if(3===f&&(2===m||1===m))return q[m](a,0,h,0,c.wkid),c=k*h[1],c=
Math.abs(c)+Math.asin(a[3]/(g+a[2])),w(h,0,b,0),c>0.9999*Math.PI?b[3]=Number.MAX_VALUE:(c=1/Math.cos(c),b[3]=c*a[3]),!0;return!1},extentToBoundingBox:function(a,c,b){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(d,a.spatialReference,0,c,b,0,1);d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(d,a.spatialReference,0,c,b,3,1);null==a.xmin&&(c[0]=-Infinity);null==
a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return e},extentToBoundingRect:function(a,c,b){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(d,a.spatialReference,0,d,b,0,1);c[0]=d[0];c[1]=d[1];d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(d,a.spatialReference,
0,d,b,0,1);c[2]=d[0];c[3]=d[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return e},webMercator:{x2lon:function(a){return a/g},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/g))},lon2x:function(a){return a*g},lat2y:function(a){a=Math.sin(a);return g/2*Math.log((1+a)/(1-a))}}}});