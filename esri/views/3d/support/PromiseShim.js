// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports"],function(m,n){function l(b,a,d){setTimeout(b,0,a,d)}function k(b){return null!=b&&"object"===typeof b&&"then"in b&&"function"===typeof b.then}var c;(function(b){b[b.Pending=0]="Pending";b[b.Rejected=1]="Rejected";b[b.Resolved=2]="Resolved"})(c||(c={}));return function(){function b(a){var b=this;this.init(c.Pending);a(function(a){return b.resolve(a)},function(a){return b.reject(a)})}b.prototype.then=function(a,d){if(this.state===c.Pending){var e=b.pending(a,d);this._addToChain(e);
return e}if(this.state===c.Resolved)return null!=a?b.tryResolveAsync(a,this.value):b.resolve(this.value);if(this.state===c.Rejected)return null!=d?b.tryResolveAsync(d,this.error):b.reject(this.error)};b.prototype.catch=function(a){return this.then(null,a)};b.resolve=function(a){if(a instanceof b)return a;if(k(a)){var d=Object.create(b.prototype);d.init(c.Pending);a.then(function(a){d.resolve(a)},function(a){d.reject(a)});return d}var e=Object.create(b.prototype);e.init(c.Resolved,a);return e};b.reject=
function(a){var d=Object.create(b.prototype);d.init(c.Rejected,null,a);return d};b.all=function(a){var d=a.length;if(0===d)return b.resolve([]);var e=a.map(b.resolve),c=b.pending();a=function(){0===--d&&c.resolve(e.map(b.getValue))};for(var f=function(a){c.reject(a)},h=0;h<e.length;h++)e[h].then(a,f);return c};b.prototype.init=function(a,b,e,c,f){void 0===b&&(b=null);void 0===e&&(e=null);void 0===c&&(c=null);void 0===f&&(f=null);this.state=a;this.value=b;this.error=e;this.callback=c;this.errback=
f;this.chainedPromise=this.firstPromise=null};b.pending=function(a,d){var e=Object.create(b.prototype);e.init(c.Pending,null,null,a,d);return e};b.getValue=function(a){return a.value};b.prototype._unchain=function(){this.errback=this.callback=this.chainedPromise=null};b.prototype._addToChain=function(a){a.chainedPromise=this.firstPromise;this.firstPromise=a};b.tryResolveAsync=function(a,d){var e=Object.create(b.prototype);e.init(c.Pending);l(function(){e.tryResolve(a,d)});return e};b.prototype.tryResolve=
function(a,b){try{var c=a(b);this.resolve(c)}catch(g){console.error(g.stack instanceof Error?g.stack:g),this.reject(g)}};b.prototype.resolve=function(a){var d=this;this.state===c.Pending?a instanceof b?a.state===c.Pending?(this._unchain(),a._addToChain(this)):a.state===c.Resolved?this.resolve(a.value):a.state===c.Rejected&&this.reject(a.error):k(a)?a.then(function(a){d.resolve(a)},function(a){d.reject(a)}):(this.state=c.Resolved,this.value=a,this.resolveHandlers()):console.error("Error: Promise is already resolved")};
b.prototype.reject=function(a){this.state===c.Pending?(this.state=c.Rejected,this.error=a,this.rejectHandlers()):console.error("Error: Promise is already resolved")};b.prototype.resolveHandlers=function(){this.callResolveHandlers(this.firstPromise);this.firstPromise=null};b.prototype.callResolveHandlers=function(a){null!=a&&(this.callResolveHandlers(a.chainedPromise),null!=a.callback?a.tryResolve(a.callback,this.value):a.resolve(this.value))};b.prototype.rejectHandlers=function(){this.callRejectHandlers(this.firstPromise);
this.firstPromise=null};b.prototype.callRejectHandlers=function(a){null!=a&&(this.callRejectHandlers(a.chainedPromise),null!=a.errback?a.tryResolve(a.errback,this.error):a.reject(this.error))};return b}()});