// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../support/RenderCoordsHelper ../../constraints/SceneViewTiltConstraint ../../lib/glMatrix ../../webgl-engine/lib/Util ../../../../geometry/support/scaleUtils".split(" "),function(e,k,q,v,r,s,w,x){var f=s.vec3d,t=s.vec4d,u=t.create(),l=f.create(),m=f.create();return e.createSubclass({declaredClass:"esri.views.3d.navigation.planar.ConstraintsPlanar",defaultConstraints:{tilt:new e.Tilt({min:function(){return k.deg2rad(r.MAX_DEFAULT)},
max:k.makePiecewiseLinearFunction([[4E3,k.deg2rad(r.MIN_DEFAULT)],[1E4,k.deg2rad(88)],[6E6,k.deg2rad(88)]])}),altitude:new e.Altitude({min:function(b){return b._autoAltitudeConstraints.min},max:function(b){return b._autoAltitudeConstraints.max}}),collision:new e.Collision},_updateAutoAltitudeConstraints:function(b){var a=Math.max(b.xmax-b.xmin,b.ymax-b.ymin);b.hasZ&&(a=Math.max(a,b.zmax-b.zmin));a=3*a/Math.atan((this._targetCameraBeforeElevationUpdate||this.targetCamera)._fov/2);b=x.getUnitValueForSR(b.spatialReference);
this._autoAltitudeConstraints.min=0;this._autoAltitudeConstraints.max=a*b},limitAltitude:function(b,a,c,f){return this.constraints.altitude.apply(this,b)},limitTiltByAltitudeConstraints:function(b,a,c,f){return b},distanceToSilhouette:function(b,a,c,p,d){d||(d={maxFarNearRatio:0,distance:0});d.maxFarNearRatio=this.maxFarNearRatio;var n=v.Planar.prototype.getAltitude(b.eye),h=n*=c;p=n-p;var g=this.elevationProvider?this.elevationProvider.getElevationBounds():null;g&&(n=0<=p?h-c*g[0]:c*g[1]-h);var h=
a.xmax-a.xmin,g=a.ymax-a.ymin,e=8*Math.max(a.xmax-a.xmin,a.ymax-a.ymin),h=Math.max(h,g,e);f.subtract(b.center,b.eye,m);l[0]=0<m[0]?a.xmax:a.xmin;l[1]=0<m[1]?a.ymax:a.ymin;l[2]=0<m[2]?h/2:-h/2;f.subtract(l,b.eye);f.normalize(m);b=f.dot(l,m);b=1.1*b*c;g=n+q.earthRadius;g=Math.sqrt(g*g-q.earthRadius*q.earthRadius);a=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);e=1E-4*a*c;c=k.clamp((n-e)/(0.001*a*c-e),0,1);d.distance=k.lerp(g,b,c*c*c);d.maxFarNearRatio=2E4;d.distance*=Math.max(Math.log(Math.abs(p)),1);d.distance=
Math.min(d.distance,Math.max(34064E4,h));return d},intersectManifold:function(b,a,c,e){var d=this.renderCoordsHelper.worldUp;t.set4(d[0],d[1],d[2],c,u);return!w.rayPlane(b,a,u,e)||0>f.dot(f.subtract(e,b,l),a)?!1:!0},getFallbackCenterAlongViewDirection:function(b,a,c){f.set(a,c)}})});