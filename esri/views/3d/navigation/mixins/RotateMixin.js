// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["../../../../core/declare","../../lib/glMatrix","../../support/mathUtils","../NavigationConstants"],function(u,e,v,w){var p=e.vec2d,b=e.vec3d,f=e.mat4d,q=b.create(),g=b.create(),n=p.create(),k=f.create(),s=b.create(),t=[3,1.5],l=w.Rotate.PivotPoint;return u([],{declaredClass:"esri.views.3d.navigation.mixins.RotateMixin",type:"rotate",constructor:function(){this._rotLastPoint=p.create()},begin:function(a,c){this.navigation.begin(this);this.active=!0;this.emit("begin");this.setPoiAuto(a);this.normalizeCoordinate(a,
this._rotLastPoint)},update:function(a,c){void 0===c&&(c=l.POI);var b,d;switch(c){case l.EYE:b=this.targetCamera.center;d=this.targetCamera.eye;break;default:b=this.targetCamera.eye,d=this.targetCamera.center,c!==l.POI&&console.error("[RotateMixin.update]: invalid pivot specified")}this._applyRotation(a,c,b,d);this.constrainTargetEyeByElevation();this.fixTargetUpVector();this.targetAndCurrentChanged();this.emit("update")},_applyRotation:function(a,c,e,d){this.renderCoordsHelper.worldUpAtPosition(d,
q);this.normalizeCoordinate(a,n);a=(n[1]-this._rotLastPoint[1])*t[c-1];var r=(n[0]-this._rotLastPoint[0])*t[c-1];b.subtract(e,d,g);var m=b.length(g),h=v.acos(b.dot(g,q)/m);c===l.POI?a=this.limitTiltByConstraints(h+a,d,m)-h:(h=0.5*Math.PI-h,m=0.495*Math.PI,a=h-Math.max(-m,Math.min(m,h+-0.5*a)));f.identity(k);b.cross(this.targetCamera.up,g,s);c==l.POI&&(r=-r);f.rotate(k,r,q);f.rotate(k,a,s);f.multiplyVec3(k,g);b.add(d,g,e);f.multiplyVec3(k,this.targetCamera.up);p.set(n,this._rotLastPoint)},end:function(a){this.active=
!1;this.emit("end");this.navigation.end(this)}})});