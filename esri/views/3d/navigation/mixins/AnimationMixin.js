// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["../../../../core/Accessor","dojo/on","dojo/_base/lang","../../animation/pointToPoint/Animation","../../../animation/easing"],function(k,l,m,d,n){d=d.default;return k.createSubclass([],{declaredClass:"esri.views.3d.navigation.mixins.AnimationMixin",properties:{interpolation:{set:function(a){if("string"===typeof a){var b=this.interpolationTypes[a];b?this._set("interpolation",new b(this)):console.error("[AnimationMixin] Invalid interpolation type "+a)}else this._set("interpolation",a)}},isAnimating:!1},
initialize:function(){this._pointToPointAnimation=new d(this.view.viewingMode);this._targetCameraAnimated=this.cameras.current.copy();this.animationId=0},getDefaults:function(){return{interpolation:"linear"}},easeInOutInterpLinear:function(a,b,c,d,h,e,f){var g=f.dist(c,d);if(g<0.1/this.renderUnitInMeters)return f.set(d,c),0;b=Math.min(Math.sqrt(g*a),b);e=Math.min(e+a*h,b);a=Math.min(e/g*h,1);f.set(f.lerp(c,d,a),c);return e},step:function(a){this.inherited(arguments);var b=this.currentHasReachedTarget();
this._stepTimeAnimation(a/1E3,b);b&&this.pan.updateContinuous(a)},startAnimation:function(a,b){this.animationId++;this._startTimeAnimation(a,b);this.animationStarted()},_stepTimeAnimation:function(a,b){if(this.isAnimating)if(b)this.setCurrentToTarget(!0);else{var c=this._pointToPointAnimation;c.step(a,this.cameras.current);c.finished?(this.isAnimating=!1,this._updateTargetCenterForElevationWhenIdle()||(this.isAnimating=!0,this.setCurrentToTarget(!0))):this.currentChanged()}},_startTimeAnimation:function(a,
b){this.isAnimating=!0;var c={};!a||!a.internalUpdate?c.apex={maximumDistance:this.view.constraints.altitude.max/6}:(c.apex=null,c.duration=0.3,c.easing=n.outExpo);a=m.mixin(c,"object"===typeof a?a:null);this._pointToPointAnimation.update(this.cameras.current,b?this._targetCameraAnimated:this.cameras.target,a)},animationStarted:function(){l.emit(this,"animationStarted")},stop:function(){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.currentHasAlmostReachedTarget()?this.currentReachedTarget(!1,
!0):(this.cameras.target.copyFrom(this.cameras.current),this.targetAndCurrentChanged(!0))},currentReachedTarget:function(){this.inherited(arguments);this.isAnimating=!1}})});