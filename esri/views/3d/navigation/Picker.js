// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["../../../core/declare","../support/RenderCoordsHelper","../lib/glMatrix","../webgl-engine/lib/Selector"],function(m,l,n,p){var e=n.vec3d,g=e.create(),f=e.create();return m([],{constructor:function(d,c){this.navigation=d;this.pickAlongRay=c._pickRay.bind(c);this.createPickRay=c._pickRayWithBeginPoint.bind(c);this.selector=new p},pickPointInScreen:function(d,c){return this.pickedIntersectionPoint(this.pickInScreen(d,!1),c)},pickFreePointInScreen:function(d,c){this.createPickRay(d,void 0,this.navigation.currentCamera.viewMatrix,
g,f);c||(c=e.create());e.subtract(f,g);e.normalize(f);var b=this.navigation.view.dataExtent,k=b.xmax-b.xmin,a=b.ymax-b.ymin,h=8*Math.max(b.xmax-b.xmin,b.ymax-b.ymin),k=Math.max(k,a,h),a=this.navigation.currentCamera,h=Math.max(0,b.xmin-a.eye[0],a.eye[0]-b.xmax),b=Math.max(0,b.ymin-a.eye[1],a.eye[1]-b.ymax),b=Math.sqrt(h*h+b*b),h="global"==this.navigation.view.viewingMode?l.Spherical.prototype.getAltitude(a.eye):l.Planar.prototype.getAltitude(a.eye),a=this.navigation._getTerrainElevationBelowCamera(a),
a=Math.abs(h-a)+Number.MIN_VALUE,a=Math.pow(Math.max(0,Math.log(k/a)),2),a=k/Math.max(1,a),a=Math.max(a,Math.min(b,k));e.scale(f,a);e.add(g,f,c)},pickInScreen:function(d,c){this.createPickRay(d,void 0,this.navigation.currentCamera.viewMatrix,g,f);c&&e.set(this.navigation.currentCamera.eye,g);return this.pickAlongRay(g,f,d,d,null,null,this.selector)},pickedIntersectionPoint:function(d,c){if(!d)return!1;c||(c=e.create());return d.getMinResult().getIntersectionPoint(c)}})});