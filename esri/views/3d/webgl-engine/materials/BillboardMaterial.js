// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/BillboardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboard"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tvec3 zDir \x3d normalize(-pos);\r\n\t\tvec3 xDir \x3d normalize(cross(vec3(.0, 1.0, .0), zDir));\r\n\t\tvec3 yDir \x3d cross(zDir, xDir);\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * size;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * size;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBillboard"\x3e\x3c![CDATA[\r\n\tprecision mediump float;\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec3 lightDirection;\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .15) discard;\r\n\t\tgl_FragColor \x3d texColor;\r\n\t\tgl_FragColor.rgb *\x3d lightAmbient.rgb * lightAmbient.w + lightDiffuse.rgb * lightDiffuse.w * dot(lightDirection, vnormal);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboardDepth"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying float depth;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tpos.x +\x3d (uv01.x - .5) * size;\r\n\t\tpos.y +\x3d (uv01.y - .5) * size;\r\n\t\tvec4 eye \x3d vec4(pos, 1.0);\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\t\tvtc \x3d uv;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e'}});
define("dojo/text!./BillboardMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(v,m,q,n,r,w,x){var u=function(f,g){m.basicMaterialConstructor(this,g);var e=w.Pos3NormTex;this.getSize=function(){return 1.05};this.dispose=function(){};this.getTextureId=function(){return f};this.getOutputAmount=function(h){var k=x.getStride(e)/4;return 6*h*k};this.getVertexBufferLayout=
function(){return e};this.fillInterleaved=function(h,k,d,c,b,a){c=m.fill;var f=h.faces.indices.va,g=h.vertexAttr.va.data,e=h.vertexAttr.tc4.data,n=h.vertexAttr.n0.data,r=h.vertexAttr.n1.data,q=h.vertexAttr.n2.data;h=h.vertexAttr.n3.data;for(var s=0;s<f.length;++s){var l=4*f[s],p=3*f[s];a+=c(g,l,b,a,k,3);a+=c(n,p,b,a,d,3);b[a++]=e[l];b[a++]=e[l+1];a+=c(g,l,b,a,k,3);a+=c(r,p,b,a,d,3);b[a++]=e[l+2]+1;b[a++]=e[l+1];a+=c(g,l,b,a,k,3);a+=c(q,p,b,a,d,3);b[a++]=e[l+2]+1;b[a++]=e[l+3]+1;a+=c(g,l,b,a,k,3);
a+=c(q,p,b,a,d,3);b[a++]=e[l+2]+1;b[a++]=e[l+3]+1;a+=c(g,l,b,a,k,3);a+=c(h,p,b,a,d,3);b[a++]=e[l];b[a++]=e[l+3]+1;a+=c(g,l,b,a,k,3);a+=c(n,p,b,a,d,3);b[a++]=e[l];b[a++]=e[l+1]}};this.intersect=function(){};this.getGLMaterials=function(){return{color:y,depthShadowMap:z,normal:void 0,depth:t,highlight:void 0}};this.getAllTextureIds=function(){return[f]}},y=function(f,g,e){m.basicGLMaterialConstructor(this,f);var h=q.TRANSPARENT_MATERIAL,k=g.get("billboard");m.singleTextureGLMaterialConstructor(this,
e,{textureId:f.getTextureId()});this.beginSlot=function(d){return h===d};this.getProgram=function(){return k};this.bind=function(d,c){d.bindProgram(k);this.bindTexture(d,k)};this.release=function(d){};this.bindView=function(d,c){m.bindView(c.origin,c.view,k)};this.bindInstance=function(d,c){k.setUniformMatrix4fv("model",c.transformation);k.setUniformMatrix4fv("modelNormal",c.transformationNormal)};this.getDrawMode=function(d){return d.gl.TRIANGLES}},t=function(f,g,e,h){m.basicGLMaterialConstructor(this,
f);var k=q.TRANSPARENT_MATERIAL,d=null==h?g.get("billboardDepth"):g.get("billboardDepthShadowMap");m.singleTextureGLMaterialConstructor(this,e,{textureId:f.getTextureId()});this.beginSlot=function(c){return k===c};this.getProgram=function(){return d};this.bind=function(c,b){c.bindProgram(d);this.bindTexture(c,d);d.setUniform2fv("nearFar",b.nearFar)};this.release=function(c){};this.bindView=function(c,b){m.bindView(b.origin,b.view,d)};this.bindInstance=function(c,b){d.detUniformMatrix4fv("model",b.transformation)};
this.getDrawMode=function(c){return c.gl.TRIANGLES}},z=function(f,g,e){t.call(this,f,g,e,!0)};u.loadShaders=function(f,g,e,h){f._parse(v);var k=new n(h,f.vertexShaderBillboard,f.fragmentShaderBillboard,r.Default3D),d=g.get("fsDepthTextured");g=g.get("fsDepthTexturedShadowMap");d=new n(h,f.vertexShaderBillboardDepth,d.source,r.Default3D,d.defines);f=new n(h,f.vertexShaderBillboardDepth,g.source,r.Default3D,g.defines);e.add("billboard",k);e.add("billboardDepth",d);e.add("billboardDepthShadowMap",f)};
return u});