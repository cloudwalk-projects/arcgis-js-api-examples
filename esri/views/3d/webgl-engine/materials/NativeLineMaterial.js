// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(u,v,w,C,D,E){var a=w.vec3d,x=w.vec2d,y=w.mat4d,F=v.VertexAttrConstants,e=a.create(),b=a.create(),k=a.create(),s=a.create(),q=x.create(),r=x.create(),z=a.create(),A=a.create(),m=function(H,B,f,p){"string"===typeof f&&(p=f,f=void 0);u.basicMaterialConstructor(this,p);this.lineType=f||m.LINES;var n=D.Pos3,t=E.getStride(n)/4;this.canBeMerged=this.lineType===
m.LINES;this.setColor=function(c){B=c;this.notifyDirty("matChanged")};this.getColor=function(){return B};this.dispose=function(){};this.getOutputAmount=function(c){c=c/2+1;if(this.lineType===m.STRIP)return c*t;if(this.lineType===m.LINES)return(2*c-2)*t};this.getVertexBufferLayout=function(){return n};this.fillInterleaved=function(c,d,a,n,l,e){c=c.vertexAttr[F.POSITION].data;if(d||this.lineType===m.LINES){n=c.length/3;for(a=0;a<n;a++){var b=3*a,g=c[b],k=c[b+1],h=c[b+2];if(d)var b=g,f=k,g=d[0]*b+d[4]*
f+d[8]*h+d[12],k=d[1]*b+d[5]*f+d[9]*h+d[13],h=d[2]*b+d[6]*f+d[10]*h+d[14];l[e++]=g;l[e++]=k;l[e++]=h;this.lineType===m.LINES&&(0!==a&&a!==n-1)&&(l[e++]=g,l[e++]=k,l[e++]=h)}}else for(a=0;a<c.length;a++)l[e++]=c[a]};this.intersect=function(c,d,n,f,l,m,t){if(f.isSelection){d=c.getData().getVertexAttr("position").position.data;c=Number.MAX_VALUE;var g,p;l=f.camera;m=f.point;for(var h=0;h<d.length-5;h+=3){e[0]=d[h];e[1]=d[h+1];e[2]=d[h+2];y.multiplyVec3(n,e);b[0]=d[h+3];b[1]=d[h+4];b[2]=d[h+5];y.multiplyVec3(n,
b);l.projectPoint(e,q);l.projectPoint(b,r);if(0>q[2]&&0<r[2])a.subtract(e,b,k),g=l.frustumPlanes,p=-(a.dot(g[4],e)+g[4][3]),g=p/a.dot(k,g[4]),a.scale(k,g,k),a.add(e,k,e),l.projectPoint(e,q);else if(0<q[2]&&0>r[2])a.subtract(b,e,k),g=l.frustumPlanes,p=-(a.dot(g[4],b)+g[4][3]),g=p/a.dot(k,g[4]),a.scale(k,g,k),a.add(b,k,b),l.projectPoint(b,r);else if(0>q[2]&&0>r[2])continue;g=v.projectVectorVector2D(q,r,m);g<c&&(c=g,a.set(e,z),a.set(b,A))}n=f.p0;f=f.p1;2>c&&(c=v.linelineDistance3D(z,A,n,f),d=Number.MAX_VALUE,
c[0]&&(a.subtract(c[2],n,s),c=a.length(s),a.scale(s,1/c),d=0.98*c/a.dist(n,f)),t(d,s))}};this.getGLMaterials=function(){return{color:G,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[]}};m.STRIP=1;m.LINES=2;var G=function(a,e){u.basicGLMaterialConstructor(this,a);var f=e.get("simple"),b=a.getColor();this.beginSlot=function(a){return a===C.OPAQUE_MATERIAL};this.getProgram=function(){return f};this.bind=function(a,e){a.bindProgram(f);f.setUniform4fv("color",
b);1>b[3]&&a.setBlendingEnabled(!0)};this.release=function(a){1>b[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){u.bindView(b.origin,b.view,f)};this.bindInstance=function(a,b){f.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(b){b=b.gl;return a.lineType===m.STRIP?b.LINE_STRIP:b.LINES}};return m});