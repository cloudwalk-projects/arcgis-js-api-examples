// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n    vtc \x3d $uv0.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  precision mediump float;\r\n\r\n  uniform sampler2D tex;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e'}});
define("require exports ./Util dojo/text!../materials/internal/offscreen.xml ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),function(p,q,d,f,g,h,k,l,m,r,n,e){return function(){function b(a,b){this._enabled=!1;this.height=this.width=0;this._programRep=a;this._rctx=b;this.height=this.width=null}b.prototype.enable=function(){if(!this.getEnableState()){var a=
this._rctx;this._enabled=!0;this.framebuffer=g.createWithAttachments(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:a.extensions.depthTexture?4:3});this.quadVAO=this.createQuadVAO(a)}};b.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};b.prototype.createQuadVAO=function(a){var b=
new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,1,1,1]);return new h(a,e.Default3D,{geometry:n.Pos2Tex},{geometry:k.createVertex(a,35044,b)})};b.prototype.setEnableState=function(a){a?this.enable():this.disable()};b.prototype.getEnableState=function(){return this._enabled};b.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};b.prototype.getDepthTexture=function(){return b.supportsDepthTexture(this._rctx.extensions)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:
null};b.supportsDepthTexture=function(a){return!!a.depthTexture};b.prototype.initializeFrame=function(a){d.assert(this.getEnableState());var b=this._rctx,c=b.gl;a=a.fullViewport;this.width=a[2];this.height=a[3];this.framebuffer.resize(this.width,this.height);b.bindFramebuffer(this.framebuffer);b.setStencilWriteMask(255);b.setClearStencil(0);b.setClearColor(0,0,0,1);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
b.prototype.getFramebuffer=function(){return this.framebuffer};b.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};b.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};b.prototype.drawQuad=function(a){d.assert(this.getEnableState());a=this._rctx;var b=a.gl,c=this._programRep.get("offscreenProgram");
a.bindFramebuffer();a.setDepthTestEnabled(!1);a.clear(b.COLOR_BUFFER_BIT);a.bindProgram(c);c.setUniform1i("tex",1);a.bindTexture(this.framebuffer.colorTexture,1);a.bindVAO(this.quadVAO);a.drawArrays(5,0,m.vertexCount(this.quadVAO,"geometry"));a.setDepthTestEnabled(!0)};b.loadShaders=function(a,b,c,d){a._parse(f);a=new l(d,a.vsOffscreenRenderer,a.fsOffscreenRenderer,e.Default3D);c.add("offscreenProgram",a)};return b}()});