// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),function(m,n,k,h,l,p){return function(){function a(e,c,b){this._idHint=b;this._text=e;this._textLines=e.split(/\r?\n/);this._params=c||{color:[0,0,0]};this._params.size=this._params.size||18;this._params.font=this._params.font||{family:"Arial"};this._params.font.family=this._params.font.family||"Arial";this._params.font.weight=this._params.font.weight||"normal";this._params.font.style=this._params.font.style||
"normal";this._fillStyle="rgb("+this._params.color.map(function(e){return Math.floor(255*e)}).toString()+")"}a.prototype.getId=function(){null==this._id&&(this._id=k.idGen.gen(this._idHint));return this._id};a.prototype.getParams=function(){return this._params};a.prototype.getString=function(){return this._text};a.prototype.initializeThroughRender=function(e,c){var b=this._create2DCanvas(),a=b.getContext("2d");a.save();var d=this.getTextWidth(),f=this.getTextHeight();b.setAttribute("width",d.toString());
b.setAttribute("height",f.toString());c.samplingMode=9729;c.wrapMode=33071;c.flipped=!0;this._params.enableMipmapping&&(d=h.nextHighestPowerOfTwo(d),f=h.nextHighestPowerOfTwo(f),c.hasMipmap=!0,c.samplingMode=9985);this.renderText(1,d,f,a);b=new l(e,c,b);this._params.enableMipmapping&&this._renderMipmap(b);a.restore();return b};a.prototype.getTextWidth=function(){var e=this._create2DCanvas().getContext("2d");this._setTextProperties(e,this._params.size);var c=0,b;for(b in this._textLines){var a=e.measureText(this._textLines[b]).width;
a>c&&(c=a)}b=this._params.font;if("italic"===b.style||"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)c+=0.3*e.measureText("A").width;return c};a.prototype.getTextHeight=function(){return this.getLineHeight()*this._textLines.length};a.prototype.getTexcoordScale=function(){if(this._params.enableMipmapping){var e=this.getTextHeight(),a=this.getTextWidth();return[a/h.nextHighestPowerOfTwo(a),e/h.nextHighestPowerOfTwo(e)]}return[1,
1]};a.prototype.getLineHeight=function(){return Math.floor(1.275*this._params.size)};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};a.prototype.renderText=function(a,c,b,g,d,f){void 0===d&&(d=0);void 0===f&&(f=0);b=this.getLineHeight()*a;this._setTextProperties(g,this._params.size*a);a="center"===g.textAlign?0.5*c:"right"===g.textAlign?c:0;a+=d;d=0+f;for(var h in this._textLines)g.fillText(this._textLines[h],
a,d),d+=b};a.prototype._create2DCanvas=function(){null==a._textCanvas2D&&(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width","1024"),a._textCanvas2D.setAttribute("height","1024"),a._textCanvas2D.setAttribute("style","display:none"));return a._textCanvas2D};a.prototype._setTextProperties=function(a,c){a.fillStyle=this._fillStyle;var b=this._params.font;a.font=b.style+" "+b.weight+" "+c+"px "+b.family;a.textAlign="left";
a.textBaseline="top";this._params.canvasStyle&&h.mergeObjects(a,this._params.canvasStyle,a)};a.prototype._renderMipmap=function(a){var c=this._create2DCanvas(),b=c.getContext("2d"),g=parseInt(c.getAttribute("width"),10)/2,d=parseInt(c.getAttribute("height"),10)/2,f=0.5,h=1;do c.setAttribute("width",g.toString()),c.setAttribute("height",d.toString()),this.renderText(f,g,d,b),a.updateData(h,0,0,g,d,c),f*=0.5,g*=0.5,d*=0.5,h++;while(1<g&&1<d)};return a}()});