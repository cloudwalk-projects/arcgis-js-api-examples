// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["dojo/_base/lang","./Util","../../../webgl/Program","./DefaultVertexAttributeLocations"],function(r,s,v,w){var e=s.assert,x=function(e,n){return e+n.toString()};return function(s,n,p,u,A,y,z){e(2===n.length,"you must specify shader snippet prefixes for vertex and fragment shaders");if(!p||0===p.length)p=[];var m=[],q=!1,t={};this.addDefine=function(a,c,d,g){e(!q,"you cannot add another variable after the first program has been generated");e(a,"you must specify a program name suffix");m.push({programNameSuffixes:["",
a],shaderNameSuffixes:g||a,defineStr:c,affectsShaderTypes:d||[!0,!0]})};this.addBinaryShaderSnippetSuffix=function(a,c,d){e(!q,"you cannot add another variable after the first program has been generated");e(a,"you must specify a program name suffix");m.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",c],affectsShaderTypes:d||[!0,!0]})};this.addNaryShaderSnippetSuffix=function(a,c){e(!q,"you cannot add another variable after the first program has been generated");var d=a.map(function(a){e(null!=
a.value,"value must always be specified");return a.value});m.push({values:d,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:d[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:d[b]}),affectsShaderTypes:c||[!0,!0]})};this.getShaderVariation=function(a){e(a.length===m.length,"you must specify a value for each variable");for(var c=s,d=r.clone(n),g=r.clone(n),b=r.clone(p),k=0;k<m.length;k++){var h=m[k],
f=a[k],l;h.values?(l=h.values.indexOf(f),e(0<=l,"invalid value "+f+" for variable "+k)):l=f?1:0;c+=h.programNameSuffixes[l];for(f=0;2>f;f++)h.affectsShaderTypes[f]&&(h.shaderSnippetSuffixes&&(d[f]+=h.shaderSnippetSuffixes[l],g[f]+=h.shaderSnippetSuffixes[l]),h.defineStr&&l&&(b.push(h.defineStr),g[f]+=h.shaderNameSuffixes))}return{programName:c,shaderSnippetNames:d,shaderNames:g,defines:b}};this.getProgram=function(a,c,d){c=c||y;d=d||z;q=!0;var g=a.reduce(x,"");if(t[g])return t[g];a=this.getShaderVariation(a);
var b=u.get(a.programName);if(b)return b;var k,b=a.shaderSnippetNames[0];k=c[b];e(null!=k,"shader snippet '"+b+"' does not exist");b=a.shaderSnippetNames[1];c=c[b];e(null!=c,"shader snippet '"+b+"' does not exist");b=new v(d,k,c,w.Default3D,a.defines);t[g]=b;u.add(a.programName,b);return b}}});