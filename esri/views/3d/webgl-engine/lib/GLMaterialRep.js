// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","./Util"],function(k,l,g){var h=function(){function b(a){this.refCnt=0;this.glMaterial=a}b.prototype.incRefCnt=function(){++this.refCnt};b.prototype.decRefCnt=function(){--this.refCnt;g.assert(0<=this.refCnt)};b.prototype.getRefCnt=function(){return this.refCnt};b.prototype.getGLMaterial=function(){return this.glMaterial};return b}();return function(){function b(a,e){this.textureRep=a;this.programRep=e;this.id2glMaterialRef={}}b.prototype.aquire=function(a){return this.aquireExt(a,
"color")};b.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};b.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};b.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};b.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};b.prototype.aquireExt=function(a,e){var b;b=a.getId()+"_"+e;var c=this.id2glMaterialRef[b],d;null==c?(d=(c=a.getGLMaterials()[e])?new c(a,this.programRep,this.textureRep):void 0,c=new h(d),
this.id2glMaterialRef[b]=c):d=c.getGLMaterial();c.incRefCnt();d&&this.increaseProgramReferences(d);return d};b.prototype.release=function(a){this.releaseExt(a,"color")};b.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};b.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};b.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};b.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};b.prototype.releaseExt=function(a,b){var f=a+
"_"+b,c=this.id2glMaterialRef[f];c.decRefCnt();if(0===c.getRefCnt()){if(c=c.getGLMaterial())this.decreaseProgramReferences(c),void 0!==c.dispose&&c.dispose();delete this.id2glMaterialRef[f]}};b.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&
this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};b.prototype.updateParamsForMat=function(a){a.updateParameters&&a.updateParameters()};b.prototype.increaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.increaseRefCount(a[b])}else this.programRep.increaseRefCount(a.getProgram())};
b.prototype.decreaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.decreaseRefCount(a[b])}else this.programRep.decreaseRefCount(a.getProgram())};return b}()});