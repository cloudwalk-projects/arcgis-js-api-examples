// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","./Util","./gl-matrix"],function(w,x,p,v){var q=v.vec3d;return function(){function d(f,k,d,e,a){p.assert(1<=f.length);p.assert(0===d.length%k);p.assert(d.length>=f.length*k);p.assert(3===e.size||4===e.size);this.primitiveIndices=f;this.indices=d;this.position=e;this._numIndexPerPrimitive=k;this._faceRange=a;var m=e.data;e=e.size;var b=0,r=f.length;null!=a&&(b=a[0],r=a[1]+1);var c=e*d[k*f[b]];this.bbMin=q.createFrom(m[c],m[c+1],m[c+2]);this.bbMax=q.create(this.bbMin);for(a=
b;a<r;++a)for(var g=k*f[a],l=0;l<k;++l)for(var c=e*d[g+l],h=0;3>h;++h){var n=m[c+h];n<this.bbMin[h]?this.bbMin[h]=n:n>this.bbMax[h]&&(this.bbMax[h]=n)}this.center=q.create();q.lerp(this.bbMin,this.bbMax,0.5,this.center);this.bsRadius=0;for(a=b;a<r;++a){g=k*f[a];for(l=0;l<k;++l)c=e*d[g+l],b=m[c]-this.center[0],h=m[c+1]-this.center[1],c=m[c+2]-this.center[2],c=b*b+h*h+c*c,c>this.bsRadius&&(this.bsRadius=c)}this.bsRadius=Math.sqrt(this.bsRadius)}d.prototype.getCenter=function(){return this.center};d.prototype.getBSRadius=
function(){return this.bsRadius};d.prototype.getBBMin=function(){return this.bbMin};d.prototype.getBBMax=function(){return this.bbMax};d.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};d.prototype.getIndices=function(){return this.indices};d.prototype.getPosition=function(){return this.position};d.prototype.getChildren=function(){if(this.children)return this.children;if(1<q.dist2(this.bbMin,this.bbMax)){for(var f=q.lerp(this.bbMin,this.bbMax,0.5,q.create()),k=this.primitiveIndices.length,
p=new Uint8Array(k),e=Array(8),a=0;8>a;++a)e[a]=0;for(var m=this.position.size,a=0;a<k;++a){for(var b=0,r=this._numIndexPerPrimitive*this.primitiveIndices[a],c=this.position.data,g=m*this.indices[r],l=c[g],h=c[g+1],n=c[g+2],s=1;s<this._numIndexPerPrimitive;++s){var g=m*this.indices[r+s],t=c[g],u=c[g+1],g=c[g+2];t<l&&(l=t);u<h&&(h=u);g<n&&(n=g)}l<f[0]&&(b|=1);h<f[1]&&(b|=2);n<f[2]&&(b|=4);p[a]=b;++e[b]}for(a=b=0;8>a;++a)0<e[a]&&++b;if(2>b)return;f=Array(8);for(a=0;8>a;++a)f[a]=0<e[a]?new Uint32Array(e[a]):
void 0;for(a=0;8>a;++a)e[a]=0;for(a=0;a<k;++a)b=p[a],f[b][e[b]++]=this.primitiveIndices[a];this.children=Array(8);for(a=0;8>a;++a)void 0!==f[a]&&(this.children[a]=new d(f[a],this._numIndexPerPrimitive,this.indices,this.position))}return this.children};return d}()});