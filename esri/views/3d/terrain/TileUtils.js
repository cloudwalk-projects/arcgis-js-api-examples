// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["./UpsampleInfo","../support/PreallocArray"],function(n,l){function g(a){this.q=new l(a||100);this._last=null;this.done=!0}function k(a){this.q=new l(a||100);this.done=!0}var h=12756274*Math.PI;g.prototype.reset=function(a){this.q.clear();a&&this.q.pushEither(a);this._last=null;this.done=0===this.q.length};g.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)};g.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var b=
4;0<=b;b--){var c=a[b];c&&this.q.push(c)}this._last=null}this._last=this.q.pop();0===this.q.length&&!this._last.children[0]&&(this.done=!0);return this._last};k.prototype.reset=function(a){this.q.clear();this.q.pushEither(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],c=0;4>c;c++){var d=b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};k.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};var f={li2lat:function(a,b){return 2*Math.atan(Math.exp(-Math.PI+
2*Math.PI*b/(1<<a)))-0.5*Math.PI},lj2lon:function(a,b){return-Math.PI+2*Math.PI*b/(1<<a)},lij2webMerc:function(a,b,c){return[-0.5*h+h*c/(1<<a),-0.5*h+h*b/(1<<a)]},lij2str:function(a,b,c){return a+"/"+b+"/"+c},tile2str:function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]},latLon2WebMercator:function(a,b,c){1.570796<a?a=1.570796:-1.570796>a&&(a=-1.570796);c[0]=6378137*b;c[1]=3189068.5*Math.log((1+Math.sin(a))/(1-Math.sin(a)))},traverseTilesPreorder:function(a,b,c,d){if(Array.isArray(a))for(var e=0;e<
a.length;e++)f._traverseTilesPreorder(a[e],b,c,d);else f._traverseTilesPreorder(a,b,c,d)},_traverseTilesPreorder:function(a,b,c,d){d=b.call(c,a,d);for(var e=0;4>e;e++){var m=a.children[e];m&&f.traverseTilesPreorder(m,b,c,d)}},traverseTilesPostorder:function(a,b,c){if(Array.isArray(a))for(var d=0;d<a.length;d++)f._traverseTilesPostorder(a[d],b,c);else f._traverseTilesPostorder(a,b,c)},_traverseTilesPostorder:function(a,b,c){for(var d=0;4>d;d++){var e=a.children[d];e&&f.traverseTilesPostorder(e,b,c)}b.call(c,
a)},IteratorPreorder:g,IteratorPostorder:k,fallsWithinLayer:function(a,b,c){b=b.layer;var d=b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale?!1:a>=0.99999999*b.maxScale},isPosWithinTile:function(a,b){var c=a.extent;return b[0]>=c[0]&&b[1]>=c[1]&&b[0]<=c[2]&&b[1]<=c[3]},getTileNLevelsUp:function(a,
b){for(;0<b;)a=a.parent,b--;return a},nextTileInAncestry:function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]},computeUpsampleInfoForAncestor:function(a,b){for(var c=1,d=0,e=0;a!==b;)if(c*=0.5,d*=0.5,e*=0.5,a.lij[2]&1&&(d+=0.5),0===(a.lij[1]&1)&&(e+=0.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");var f=n.Pool.acquire();f.init(b,d,e,c);return f}};return f});