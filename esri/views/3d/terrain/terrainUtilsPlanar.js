// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ./TilingScheme ./TerrainConst ../../../core/Error ../support/aaBoundingRect ../lib/glMatrix".split(" "),function(w,m,q,r,p,n,u){function k(c,b,d,a){e.set(d,l);l[a]=b[a];a=e.subtract(l,b);var f=e.subtract(c,b,v),f=e.dot(f,a),s=e.dot(a,a);b=0>=f?b:s<=f?d:e.add(b,e.scale(a,f/s),l);c=e.subtract(c,b,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function t(c,b){var d=c.getElevationBounds(),a=c.extent,d=0.5*(d[0]+d[1]);h[0]=a[0];h[1]=a[1];h[2]=d;g[0]=a[2];g[1]=
a[3];g[2]=d;d=a=Infinity;b[0]<h[0]?a=k(b,h,g,0):b[0]>g[0]&&(a=k(b,g,h,0));b[1]<h[1]?d=k(b,h,g,1):b[1]>g[1]&&(d=k(b,g,h,1));return Math.min(a,d)}var e=u.vec3d,l=e.create(),v=e.create(),h=e.create(),g=e.create();m.autoUpdateSkirtsVisibility=function(c,b){var d,a=!0,f=c.extent,e=n.contains(f,b);e?d=c.getElevation(b):(d=c.getElevationBounds(),d=0.5*(d[0]+d[1]));d>b[2]?a=!1:e||(e=Math.min(f[2]-f[0],f[3]-f[1]),n.containsWithMargin(f,b,c.hideSkirtsDistanceFromExtentMargin*e)?t(c,b)>c.hideSkirtsMinimumCameraTilt&&
(a=!1):a=!1);a!==c.skirts&&(c.skirts=a)};m.tiltOnEdge=k;m.tiltToExtentEdge=t;m.checkIfTileInfoSupportedForViewSR=function(c,b,d){if(c.spatialReference.isGeographic)return new p("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var a=q.checkUnsupported(c);if(a)return a;var f=c.lods,a=f[0].resolution*Math.pow(2,f[0].level),e=[a*c.size[0],a*c.size[1]],h=[c.origin.x,c.origin.y];b=n.fromExtent(b);var g=n.create();q.computeRowColExtent(b,e,h,g);e=
(g[2]-g[0])*(g[3]-g[1]);e>r.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),a=Math.max((b[3]-b[1])/c.size[1],(b[2]-b[0])/c.size[0])*f/a,b=Math.floor(Math.log(a)/Math.log(10)),a=Math.ceil(a/Math.pow(10,b))*Math.pow(10,b),a=new p("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+a.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:a,requiredNumRootTiles:e,allowedNumRootTiles:r.MAX_ROOT_TILES})):
a=null;return a?a:d&&!c.spatialReference.equals(d)?new p("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}});