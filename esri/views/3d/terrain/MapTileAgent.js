// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["./TileAgentBase","./TileUtils","./UpsampleInfo","../../../core/ObjectPool"],function(d,l,g,p){var a=function(){d.apply(this,arguments)};a.prototype=new d;a.prototype.constructor=a;a.prototype.dataArrived=function(c){c!==this.tile?this._setUpsamplingTile(c):this.tile.updateTexture();this._dataRequested=null;c!==this.tile&&this._requestNext()};a.prototype._findNextDownload=function(){var c,a=this.layerIdx,h=this.layerClass,k=this.tile.parentSurface.layerViewByIndex(a,h),d=k.minDataLevel,g=
k.maxDataLevel;if(this._tileLayerInfo.data||d>this.tile.lij[0])c=null;else{for(var m=0,b=this.tile,f=this.tile.parentSurface,e=f.getTilemapTile(b),f=f.tilemapStats,n=!1;b&&4>=m&&l.fallsWithinLayer(b,k,!1)&&b.lij[0]>=d;){if(b.layerInfo[h][a].data){this._setUpsamplingTile(b);break}e&&!e.tileDataAvailable(b,a,h)?n=!0:b.lij[0]<=g&&(c=b);b=b.parent;e=e?e.parent:null;m++}!c&&n&&f.tilesNotPresent++}return c};a.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===
a||(this._tileLayerInfo.upsampleFromTile&&g.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=l.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};a.Pool=new p(a,function(){},!1);return a});