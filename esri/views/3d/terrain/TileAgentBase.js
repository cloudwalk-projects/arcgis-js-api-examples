// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["./UpsampleInfo"],function(g){var f=Error("Abstract method called on TileAgentBase"),b=function(){};b.prototype.init=function(a,h,b,c){this.tile=a;this.layerIdx=h;this.layerClass=b;this._tileLayerInfo=a.getLayerInfo(h,b);this._dataRequested=null;this.suspended=c;if(!a.data)return(a=this._findAncestorWithData())?(this._setUpsamplingTile(a.tile),g.Pool.release(a)):(this._tileLayerInfo.upsampleFromTile&&g.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=
null),this._requestNext(!0)};b.prototype.dispose=function(a){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this,a),this._dataRequested=null);this._tileLayerInfo=this.tile=null};b.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};b.prototype.update=function(){var a=
this._findAncestorWithData();a&&this._tileLayerInfo.upsampleFromTile&&a.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(a.tile):a&&g.Pool.release(a);return this._requestNext()};b.prototype.dataArrived=function(a){throw f;};b.prototype.dataMissing=function(a){this._dataRequested=null;this._agentDone()};b.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};b.prototype._requestNext=function(a){if(this.suspended)return!0;var b=this._findNextDownload();
if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};b.prototype._findAncestorWithData=function(){return k(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};var k=function(a,b,f,c,d,e,l){if(!a.parent||6<l)return null;c*=0.5;d*=0.5;e*=0.5;a.lij[2]&1&&(d+=0.5);0===
(a.lij[1]&1)&&(e+=0.5);return a.parent.hasLayerData(b,f)?(b=g.Pool.acquire(),b.init(a.parent,d,e,c),b):k(a.parent,b,f,c,d,e,l+1)};b.prototype._findNextDownload=function(){throw f;};return b});