// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports dojo/promise/all ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/support/FeatureSet".split(" "),function(l,m,g,f,h,k){return function(){function d(a,b){this._support=a;this._options=b}d.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,e=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;e.add(a)});return{count:c,extent:0===c?null:e.getExtent()}})};d.prototype.queryFeatureCount=function(a){var b=
this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};d.prototype.queryFeatures=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[],e=a&&a.outFields;b._forAllQueried(a,function(a){c.push(b._support.createGraphic(a,e))});return g(c)}).then(function(a){var b=new k;b.features=a;return b})};d.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,
function(a){return c.push(a.id)});return c})};d.prototype._forAllQueried=function(a,b){var c=[];if(a&&a.objectIds){var d=a.objectIds;c.push(function(a){return 0<=d.indexOf(a.id)})}this._options.addVisibilityFilter&&c.push(this._support.createVisibilityFilter());this._support.forAll(function(a){for(var d=0;d<c.length;d++)if(!c[d](a))return;b(a)})};d.prototype._rejectUnsupported=function(a){if(null==a)return f.resolve();var b=function(a){return f.reject(new h("Unsupported Query","Unsupported property '"+
a+"'"))};return null!=a.distance?b("distance"):null!=a.geometryPrecision?b("geometryPrecision"):a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length?b("groupByFieldsForStatistics"):null!=a.maxAllowableOffset?b("maxAllowableOffset"):a.multipatchOption?b("multipatchOption"):null!=a.num?b("num"):a.orderByFields&&a.orderByFields.length?b("orderByFields"):a.outSpatialReference?b("outSpatialReference"):a.outStatistics&&a.outStatistics.length?b("outStatistics"):a.pixelSize?b("pixelSize"):a.quantizationParameters?
b("quantizationParameters"):a.relationParam?b("relationParam"):a.returnDistinctValues?b("returnDistinctValues"):null!=a.start?b("start"):a.text?b("text"):a.timeExtent?b("timeExtent"):a.where?b("where"):a.geometry?b("geometry"):!this._options.enableOutFields&&a.outFields&&a.outFields.length?b("outFields"):!this._options.enableObjectId&&a.objectIds&&a.objectIds.length?b("objectIds"):f.resolve()};return d}()});