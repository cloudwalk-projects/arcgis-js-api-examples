// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(g,D,x,y,z,A,s,p){var B=A.VertexAttrConstants;g=y.vec3d;var q=new x,h=g.create(),a=g.create(),n=g.create(),t={perVertexElevationAligner:function(k,b,d){var f=k.stageObject;k=k.elevationInfo;q.spatialReference=b.spatialReference;for(var u=f.getGeometryRecords(),C=u.length,m=0;m<C;m++){var c=u[m].geometry,l=u[m].getShaderTransformation();
a[0]=l[12];a[1]=l[13];a[2]=l[14];c.invalidateBoundingInfo();for(var l=c.getData().getVertexAttr(),c=l[B.POSITION].data,l=l.mapPos.data,g=c.length/2,e=0,v=0,p=!1,w=0;w<g;w++){q.x=l[v++];q.y=l[v++];q.z=l[v++];n[0]=c[e];n[1]=c[e+1];n[2]=c[e+2];var r=s.computeElevation(b,q,k);h[0]=c[e]+a[0];h[1]=c[e+1]+a[1];h[2]=c[e+2]+a[2];d.setAltitude(r,h,0);c[e]=h[0]-a[0];c[e+1]=h[1]-a[1];c[e+2]=h[2]-a[2];r=t.updateThresholdInMeters/d.unitInMeters;if(Math.abs(n[0]-c[e])>=r||Math.abs(n[1]-c[e+1])>=r||Math.abs(n[2]-
c[e+2])>=r)p=!0;e+=3}p&&f.geometryVertexAttrsUpdated(m)}},perObjectElevationAligner:function(k,b,d){var f=k.elevationInfo,a=f.centerPointInElevationSR,g=0;if(k.stageObject.metadata.usesVerticalDistanceToGround){var m={verticalDistanceToGround:0},g=s.computeElevation(b,a,f,m);p.updateVertexAttributeAuxpos1w(k.stageObject,m.verticalDistanceToGround)}else g=s.computeElevation(b,a,f);b=k.stageObject.getObjectTransformation();f=[b[12],b[13],b[14]];t.iterativeUpdatesEnabled?d.setAltitudeOfTransformation(g,
b):(h[0]=a.x,h[1]=a.y,h[2]=g,z.computeLinearTransformation(a.spatialReference,h,b,d.spatialReference)&&k.stageObject.setObjectTransformation(b));d=t.updateThresholdInMeters/d.unitInMeters;(Math.abs(b[12]-f[0])>=d||Math.abs(b[13]-f[1])>=d||Math.abs(b[14]-f[2])>=d)&&k.stageObject.setObjectTransformation(b)},perObjectVerticalDistanceToGroundAligner:function(a,b,d){d=a.elevationInfo;var f={verticalDistanceToGround:0};s.computeElevation(b,d.centerPointInElevationSR,d,f);p.updateVertexAttributeAuxpos1w(a.stageObject,
f.verticalDistanceToGround)},updateThresholdInMeters:0.01,iterativeUpdatesEnabled:!0};return t});