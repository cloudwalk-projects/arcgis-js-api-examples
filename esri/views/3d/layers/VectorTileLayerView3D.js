// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/promise/all ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../vectorTiles/SchemaHelper ../../vectorTiles/TileHandler ../../vectorTiles/renderers/Renderer ../../layers/LayerView ./support/LayerViewUpdatingPercentage ../terrain/terrainUtils".split(" "),function(u,v,k,d,l,c,e,g,m,n,p,q,r,s,t){return function(h){function a(){h.call(this);
this._isUpdating=!1;this.minDataLevel=0;this.maxDataLevel=Infinity}k(a,h);a.prototype.initialize=function(){var a=this,b=t.checkIfTileInfoSupportedForView(this.layer.tileInfo256,this.layer.fullExtent,this.view.spatialReference,this.view.basemapTerrain.manifold),c;if(b){var d={layer:this.layer,error:b},f=void 0;switch(b.name){case "tilingscheme:local-gcs-not-supported":f=new e("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",d);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":f=
new e("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",d);break;default:f=new e("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",d)}this.addResolvingPromise(g.reject(f))}else c=m.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var b=a.view.basemapTerrain.tilingScheme.pixelSize[0];a.schemeHelper=new n(b);if(!a.view.basemapTerrain.tilingScheme.compatibleWith(256===
b?a.layer.tileInfo256:a.layer.tileInfo))return b=new e("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"),g.reject(b)});this.tileHandler&&this.tileHandler.destroy();b=this.layer;b.tileInfo&&0<b.tileInfo.lods.length&&(this.minDataLevel=b.tileInfo.lods[0].level,this.maxDataLevel=b.tileInfo.lods[b.tileInfo.lods.length-1].level);this.tileHandler=new p(this.layer,function(){},1);b=this.tileHandler.start();b.then(function(){a.renderer=
new q(a.tileHandler.spriteMosaic,a.tileHandler.glyphMosaic,!1)});c=l([c,b]);this.addResolvingPromise(c)};a.prototype.destroy=function(){this.renderer=null;this.tileHandler.destroy();this.tileHandler=null};Object.defineProperty(a.prototype,"isTransparent",{get:function(){return!0},enumerable:!0,configurable:!0});a.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};a.prototype.isUpdating=function(){return this._isUpdating};a.prototype._evaluateUpdatingState=function(a){this._isUpdating=
!!a;this.notifyChange("updating")};d([c.property()],a.prototype,"view",void 0);d([c.property()],a.prototype,"layer",void 0);d([c.property({readOnly:!0})],a.prototype,"isTransparent",null);d([c.property()],a.prototype,"updatingPercentageValue",void 0);return a=d([c.subclass("esri.views.3d.layers.VectorTileLayerView3D")],a)}(c.declared(r,s))});