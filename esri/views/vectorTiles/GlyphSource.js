// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/promiseUtils","../../request","../../core/pbf"],function(t,u,n,p,q){var r=function(){function a(d){this._metrics=[];for(this._bitmaps=[];d.next();)switch(d.tag()){case 1:for(var c=d.getMessage();c.next();)switch(c.tag()){case 3:for(var b=c.getMessage(),a=void 0,e=void 0,g=void 0,h=void 0,k=void 0,l=void 0,m=void 0;b.next();)switch(b.tag()){case 1:a=b.getUInt32();break;case 2:e=b.getBytes();break;case 3:g=b.getUInt32();break;case 4:h=b.getUInt32();break;case 5:k=
b.getSInt32();break;case 6:l=b.getSInt32();break;case 7:m=b.getUInt32();break;default:b.skip()}a&&(this._metrics[a]={width:g,height:h,left:k,top:l,advance:m},this._bitmaps[a]=e);break;default:c.skip()}break;default:d.skip()}}a.prototype.getMetrics=function(d){return this._metrics[d]};a.prototype.getBitmap=function(d){return this._bitmaps[d]};return a}(),s=function(){function a(){this._ranges=[]}a.prototype.getRange=function(d){return this._ranges[d]};a.prototype.addRange=function(d,c){this._ranges[d]=
c};return a}();return function(){function a(d){this._glyphInfo={};this._baseURL=d}a.prototype.getRange=function(d,c){var b=this._getFontStack(d);if(b.getRange(c))return n.resolve();var a=256*c,e=a+255,a=this._baseURL.replace("{fontstack}",d).replace("{range}",a+"-"+e);return p(a,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){b.addRange(c,new r(new q(new Uint8Array(a.data),new DataView(a.data))))})};a.prototype.getGlyph=function(a,c){var b=this._getFontStack(a);if(b){var f=
Math.floor(c/256);if(!(256<f))return b=b.getRange(f),!b?void 0:{metrics:b.getMetrics(c),bitmap:b.getBitmap(c)}}};a.prototype._getFontStack=function(a){var c=this._glyphInfo[a];c||(c=this._glyphInfo[a]=new s);return c};return a}()});