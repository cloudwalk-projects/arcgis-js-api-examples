// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang dojo/on dojo/dom dojo/dom-construct ../core/Accessor ../core/HandleRegistry ../core/Scheduler ../core/watchUtils ../widgets/Popup ./PopupManager ./ui/DefaultUI ../core/accessorSupport/decorators".split(" "),function(A,B,r,f,s,t,m,p,u,v,w,n,x,y,z,e){var k=[0,0],h=16,g=750;return function(q){function c(){var a=this;q.call(this);this.height=0;this.position=null;this.resizing=!1;this.surface=
this.root=null;this.suspended=!0;this.width=0;Object.defineProperty(this,"_measureInfo",{enumerable:!1,writable:!1,value:{task:null,freq:h,time:g}});this._domHandles=new v;this.watch("interacting",function(b){var d=a.surface;d&&d.setAttribute("data-interacting",b.toString())})}r(c,q);c.prototype.getDefaults=function(){return s.mixin(this.inherited(arguments),{popup:{},ui:{}})};c.prototype.initialize=function(){var a=this,b=this._measureInfo,d=null;n.init(this,"container",function(c,l,e,f){null==c&&
null==l||(d&&(d.remove(),d=null,b.freq=h,b.time=g),b.task&&(b.task.remove(),b.task=null),c?(d=t(window,"resize",function(){b.freq=h;b.time=g}),b.task=w.addFrameTask({prepare:function(b){var d=a._measureInfo;d.time+=b.deltaTime;d.time<d.freq||(d.time=0,a._measure()?(d.freq=h,a._set("resizing",!0)):(d.freq=Math.min(g,2*d.freq),512<=d.freq&&a._set("resizing",!1)))}})):a._set("resizing",!1),a._measure(),c=a.root,l=a.surface,e=a.width,f=a.height,c&&(l&&e&&f)&&(c.style.width=l.style.width=e+"px",c.style.height=
l.style.height=f+"px"))})};c.prototype.destroy=function(){this.ui.destroy();this.popup&&this.popup.destroy();this.container=null};Object.defineProperty(c.prototype,"container",{set:function(a){var b=this._get("container");if(b!==a){b&&(b.classList.remove("esri-view"),this.popupManager.destroy(),this.popupManager=null,p.destroy(this.root),this._set("root",null));if(a){a.classList.add("esri-view");b=document.createElement("div");b.className="esri-view-root";a.insertBefore(b,a.firstChild);this._set("root",
b);var d=document.createElement("div");d.className="esri-view-surface";m.setSelectable(d,!1);b.appendChild(d);this._set("surface",d);this._forceReadyCycle();this.popupManager=new y({enabled:!0,view:this})}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null);this._set("container",a)}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"popup",{set:function(a){var b=this._get("popup");a!==b&&(this._domHandles.remove("view-popup"),
b&&b.destroy(),a&&(a.viewModel.view=this,a._started||a.startup(),this._domHandles.add([n.init(this,"root",function(d,b){var c=a.domNode;m.isDescendant(c.parentNode,b)&&c.parentNode.removeChild(c);d&&!c.parentNode&&a.placeAt(d)})],"view-popup")),this._set("popup",a))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"ui",{set:function(a){var b=this._get("ui");a!==
b&&(this._domHandles.remove("ui"),b&&b.destroy(),a&&(a.view=this,this._domHandles.add([n.init(this,"root",function(b){a.container=b?p.create("div",null,b):null})],"ui")),this._set("ui",a))},enumerable:!0,configurable:!0});c.prototype.pageToContainer=function(a,b,d){var c=this.position;a-=c[0];b-=c[1];d?(d[0]=a,d[1]=b):d=[a,b];return d};c.prototype.containerToPage=function(a,b,d){var c=this.position;a+=c[0];b+=c[1];d?(d[0]=a,d[1]=b):d=[a,b];return d};c.prototype._measure=function(){var a=this.container,
b=a?a.clientWidth:0,d=a?a.clientHeight:0;if(0===b||0===d||"hidden"===window.getComputedStyle(a).visibility)return this._set("suspended",!0),!1;var c=this.root,e=this.surface,f=this.width,h=this.height,g=this.position;if(b===f&&d===h)return this._set("suspended",!1),!1;c&&e&&(c.style.width=e.style.width=b+"px",c.style.height=e.style.height=d+"px");this._set("width",b);this._set("height",d);this._set("suspended",!1);c=(a.ownerDocument||window.document).defaultView;a=a.getBoundingClientRect();k[0]=a.left+
c.pageXOffset;k[1]=a.top+c.pageYOffset;(!g||k[0]!==g[0]||k[1]!==g[1])&&this._set("position",k.slice());this.emit("resize",{oldWidth:f,oldHeight:h,width:b,height:d});return!0};f([e.property({value:null,cast:function(a){return m.byId(a)}})],c.prototype,"container",null);f([e.property({readOnly:!0})],c.prototype,"height",void 0);f([e.property({type:x})],c.prototype,"popup",null);f([e.property({readOnly:!0})],c.prototype,"position",void 0);f([e.property({readOnly:!0})],c.prototype,"resizing",void 0);
f([e.property({readOnly:!0})],c.prototype,"root",void 0);f([e.property({value:null,dependsOn:["width","height"],readOnly:!0})],c.prototype,"size",null);f([e.property({readOnly:!0})],c.prototype,"surface",void 0);f([e.property({readOnly:!0})],c.prototype,"suspended",void 0);f([e.property({type:z})],c.prototype,"ui",null);f([e.property({readOnly:!0})],c.prototype,"width",void 0);return c=f([e.subclass("esri.views.DOMContainer")],c)}(e.declared(u))});