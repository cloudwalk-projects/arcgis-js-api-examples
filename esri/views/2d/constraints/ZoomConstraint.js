// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../layers/support/LOD".split(" "),function(u,v,r,h,g,s,t){return function(l){function d(){l.apply(this,arguments);this._lodByScale={};this._scales=[];this.effectiveLODs=null;this.effectiveMaxZoom=this.effectiveMinZoom=-1;this.effectiveMaxScale=this.effectiveMinScale=0;this.enabled=!0;this.lods=null;this.maxZoom=this.minZoom=
-1;this.maxScale=this.minScale=0;this.snapToZoom=!0}r(d,l);d.prototype.initialize=function(){var b=this,a=this.lods,c=this.minScale,k=this.maxScale,e=this.minZoom,f=this.maxZoom,d=-1,g=-1,h=!1,l=!1;0!==c&&(0!==k&&c<k)&&(k=[k,c],c=k[0],k=k[1]);if(a&&a.length){a=a.map(function(a){return a.clone()});a.sort(function(a,b){return b.scale-a.scale});a.forEach(function(a,b){return a.level=b});for(var n,p=0,q=a;p<q.length;p++){var m=q[p];!h&&(0<c&&c>=m.scale)&&(d=m.level,h=!0);!l&&(0<k&&k>=m.scale)&&(g=n?n.level:
-1,l=!0);n=m}-1===e&&(e=0===c?0:d);-1===f&&(f=0===k?a.length-1:g);e=Math.max(e,0);e=Math.min(e,a.length-1);f=Math.max(f,0);f=Math.min(f,a.length-1);e>f&&(c=[f,e],e=c[0],f=c[1]);c=a[e].scale;k=a[f].scale;a.splice(0,e);a.splice(f-e+1,a.length);a.forEach(function(a,c){b._lodByScale[a.scale]=a;b._scales[c]=a.scale});this._set("effectiveLODs",a);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",f)}this._set("effectiveMinScale",c);this._set("effectiveMaxScale",k)};d.prototype.constrain=function(b,
a){if(!this.enabled||a&&b.scale===a.scale)return b;var c=this.effectiveMinScale,d=this.effectiveMaxScale,e=b.targetGeometry,f=a&&a.targetGeometry,g=0!==c&&b.scale>c;if(0!==d&&b.scale<d||g)c=g?c:d,f&&(d=(c-a.scale)/(b.scale-a.scale),e.x=f.x+(e.x-f.x)*d,e.y=f.y+(e.y-f.y)*d),b.scale=c;this.snapToZoom&&this.effectiveLODs&&(b.scale=this._getClosestScale(b.scale));return b};d.prototype.zoomToScale=function(b){if(!this.effectiveLODs)return 0;b-=this.effectiveMinZoom;b=Math.max(0,b);var a=this._scales;if(0>=
b)return a[0];if(b>=a.length)return a[a.length-1];var c=Math.round(b-0.5),d=Math.round(b);return a[d]+(d-b)*(a[c]-a[d])};d.prototype.scaleToZoom=function(b){if(!this.effectiveLODs)return-1;var a=this._scales,c=0,d=a.length-1,e,f;for(c;c<d;c++){e=a[c];f=a[c+1];if(e<=b)return c+this.effectiveMinZoom;if(f===b)return c+1+this.effectiveMinZoom;if(e>b&&f<b)return c+1-(b-f)/(e-f)+this.effectiveMinZoom}return c};d.prototype.snapScale=function(b,a){void 0===a&&(a=0.95);if(!this.effectiveLODs)return b;var c=
this.scaleToZoom(b);return(c+1)%Math.floor(c+1)>=a?this.zoomToScale(Math.ceil(c)):this.zoomToScale(Math.floor(c))};d.prototype.clone=function(){return new d({enabled:this.enabled,lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})};d.prototype._getClosestScale=function(b){if(this._lodByScale[b])return this._lodByScale[b].scale;b=this._scales.reduce(function(a,c,d,e){return Math.abs(c-b)<=Math.abs(a-b)?c:a},this._scales[0]);return this._lodByScale[b].scale};
h([g.property({readOnly:!0})],d.prototype,"effectiveLODs",void 0);h([g.property({readOnly:!0})],d.prototype,"effectiveMinZoom",void 0);h([g.property({readOnly:!0})],d.prototype,"effectiveMaxZoom",void 0);h([g.property({readOnly:!0})],d.prototype,"effectiveMinScale",void 0);h([g.property({readOnly:!0})],d.prototype,"effectiveMaxScale",void 0);h([g.property()],d.prototype,"enabled",void 0);h([g.property({type:[t]})],d.prototype,"lods",void 0);h([g.property()],d.prototype,"minZoom",void 0);h([g.property()],
d.prototype,"maxZoom",void 0);h([g.property()],d.prototype,"minScale",void 0);h([g.property()],d.prototype,"maxScale",void 0);h([g.property()],d.prototype,"snapToZoom",void 0);return d=h([g.subclass("esri.views.2d.constraints.ZoomConstraint")],d)}(g.declared(s))});