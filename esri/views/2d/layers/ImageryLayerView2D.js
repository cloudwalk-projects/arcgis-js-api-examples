// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/HandleRegistry ../../../core/promiseUtils ../../../core/watchUtils ../../../Graphic ./LayerView2D ./support/ExportStrategy ../engine/GeoBitmap ../engine/Canvas2DContainer ../engine/GeoBitmapContainer".split(" "),function(v,w,h,k,e,l,m,n,p,q,r,s,t,u){return function(g){function a(){g.apply(this,arguments);this._handles=new l;this.container=new t}
h(a,g);a.prototype.hitTest=function(c,b){var a=this.view.toMap(c,b);return m.resolve(new p({attributes:{},geometry:a}))};a.prototype.update=function(c){this.strategy.update(c);this.notifyChange("updating")};a.prototype.attach=function(){var c=this;this._tileContainer=new u;this.container.addChild(this._tileContainer);this.strategy=new r(this._tileContainer,function(b){return c._fetchImage(b)},function(){return c.requestUpdate()},0,!1,2048,2048,!1);this._handles.add([n.watch(this,"layer.exportImageServiceParameters.version",
function(b){c._exportImageVersion!==b&&(c._exportImageVersion=b,c.requestUpdate())}),this.layer.on("redraw",function(){c.strategy.updateExports(function(b){c.pixelData=c.layer.applyFilter(c._rawPixelData);b=b.source.getContext("2d");c._drawPixelData(b,c.pixelData,0,0);return null})})])};a.prototype.detach=function(){this.container.removeChild(this._tileContainer);this.strategy.destroy();this._handles.removeAll()};a.prototype.moveStart=function(){};a.prototype.viewChange=function(){};a.prototype.moveEnd=
function(){this.requestUpdate()};a.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};a.prototype._fetchImage=function(c){var b=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");return this.layer.fetchImage(c).then(function(a){b._rawPixelData=a.pixelData;b.pixelData=b.layer.applyFilter(b._rawPixelData);a=document.createElement("canvas");a.width=c.width;a.height=c.height;var f=a.getContext("2d");b._drawPixelData(f,
b.pixelData,0,0);b.notifyChange("updating");return new s(a)})};a.prototype._drawPixelData=function(a,b,e,f){if(b.pixelBlock){var d=b.pixelBlock;b=a.createImageData(d.width,d.height);d=d.getAsRGBA();b.data.set(d);a.putImageData(b,e,f)}};return a=k([e.subclass("esri.views.2d.layers.ImageryLayerView2D")],a)}(e.declared(q))});