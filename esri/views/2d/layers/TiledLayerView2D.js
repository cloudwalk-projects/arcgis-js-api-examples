// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./LayerView2D ./support/TileStrategy ../engine/GeoBitmap ../engine/GeoBitmapContainer ../engine/Canvas2DContainer ./support/loader ./support/TileKey ./support/TileInfoView".split(" "),function(u,v,l,g,d,m,n,p,q,r,s,h,t){return function(k){function a(){k.apply(this,arguments);this._numTileMapCacheRequests=0;this.container=new r}l(a,k);a.prototype.hitTest=function(b,
a){return null};a.prototype.update=function(b){this.strategy.update(b);this.notifyChange("updating")};a.prototype.attach=function(){var b=this;this._tileContainer=new q;this.container.addChild(this._tileContainer);this.strategy=new n(this._tileContainer,new t(this.layer.tileInfo,this.layer.fullExtent),function(){return b.requestUpdate()},function(a){return b._fetchTile(a)},function(a,e){return b._tileFilter(a,e)})};a.prototype.detach=function(){this.strategy.destroy();this.strategy=null;this.container.removeChild(this._tileContainer);
this._tileContainer=null};a.prototype.moveStart=function(){this.requestUpdate()};a.prototype.viewChange=function(){this.requestUpdate()};a.prototype.moveEnd=function(){this.requestUpdate()};a.prototype.isUpdating=function(){return this.attached&&(0!==this._numTileMapCacheRequests||this.strategy.updating||this.updateRequested)};a.prototype._tileFilter=function(b,a){var e=this,d=this.layer.tilemapCache;b.length=0;if(!d)return b.push.apply(b,a),b;for(var f=0;f<a.length;f++){var c=h.fromId(a[f]);switch(d.getAvailabilityUpsample(c.level,
c.row,c.col,c)){case "unknown":this._numTileMapCacheRequests++;b.push(c.id);d.fetchAvailabilityUpsample(c.level,c.row,c.col,c).always(function(){e.requestUpdate();e._numTileMapCacheRequests--});break;case "available":-1===b.indexOf(c.id)&&b.push(c.id)}}return b};a.prototype._fetchTile=function(a){a=h.fromId(a);a=this.layer.getTileUrl(a.level,a.row,a.col);return s.loadImage(a).then(function(a){return new p(a)})};g([d.property({dependsOn:["updateRequested"]})],a.prototype,"updating",void 0);return a=
g([d.subclass("esri.views.2d.layers.TiledLayerView2D")],a)}(d.declared(m))});