// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define(["require","exports","../../viewStateUtils","../../../../geometry/Extent"],function(m,n,k,l){var c=[0,0,0,0],d=[0,0];return function(){function a(f,d,e,b,g,c,a,h){void 0===b&&(b=0);void 0===g&&(g=!1);void 0===c&&(c=2048);void 0===a&&(a=2048);void 0===h&&(h=!1);this.container=f;this.fetchImage=d;this.requestUpdate=e;this.debouncing=b;this.imageRotationSupported=g;this.maxImageWidth=c;this.maxImageHeight=a;this.shiftCentralMeridian=h;this._imagePromise=null}a.prototype.destroy=function(){};Object.defineProperty(a.prototype,
"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});a.prototype.update=function(f){var a=this;f=f.state;this._imagePromise&&(this._imagePromise.cancel(),this._imagePromise=null);this.imageRotationSupported||k.getOuterSize(d,f);d[0]=Math.min(d[0],this.maxImageWidth||2048);d[1]=Math.min(d[1],this.maxImageHeight||2048);k.getBBox(c,f,d);var e={extent:new l(c[0],c[1],c[2],c[3],f.spatialReference),width:d[0],height:d[1],rotation:f.rotation};f=this.fetchImage(e);
f.then(function(b){a._imagePromise=null;b.topLeft[0]=e.extent.xmin;b.topLeft[1]=e.extent.ymax;b.bottomRight[0]=e.extent.xmax;b.bottomRight[1]=e.extent.ymin;b.resolution=e.extent.width/d[0];a.container.removeAllChildren();a.container.addChild(b)}).otherwise(function(b){a._imagePromise=null;if("cancel"!==b.dojoType)throw b;});this._imagePromise=f};a.prototype.updateExports=function(a,d){for(var e=0,b=this.container.children;e<b.length;e++){var c=b[e];if(!c.visible||!c.attached)break;a(c,d)?console.error("ExportStrategy.updateExports doesn't support promise yet"):
c.requestRender()}};return a}()});