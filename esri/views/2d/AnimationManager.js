// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("../../core/declare ../../core/Accessoire ../../core/Scheduler ../../core/now ../ViewAnimation ./unitBezier ./viewpointUtils".split(" "),function(n,p,q,h,k,g,l){var m=function(a,c,b,d){var e=a.targetGeometry,f=c.targetGeometry;d?"string"===typeof d&&(d=g.parse(d)||g.ease):d=g.ease;this.easing=d;this.duration=b;this.sCenterX=e.x;this.sCenterY=e.y;this.sScale=a.scale;this.sRotation=a.rotation;this.tCenterX=f.x;this.tCenterY=f.y;this.tScale=c.scale;this.tRotation=c.rotation;this.dCenterX=this.tCenterX-
this.sCenterX;this.dCenterY=this.tCenterY-this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)};m.prototype.applyRatio=function(a,c){var b=this.easing(c),d,e,f;1<=c?(d=this.tCenterX,e=this.tCenterY,f=this.tRotation,b=this.tScale):(d=this.sCenterX+b*this.dCenterX,e=this.sCenterY+b*this.dCenterY,f=this.sRotation+b*this.dRotation,b=this.sScale+b*this.dScale);a.targetGeometry.x=
d;a.targetGeometry.y=e;a.scale=b;a.rotation=f};return n(p,{constructor:function(){this._updateTask=q.addFrameTask({postRender:this._postRender.bind(this)});this._updateTask.pause()},getDefaults:function(){return{viewpoint:l.create()}},duration:200,transition:null,easing:g.ease,animateTo:function(a,c,b){l.copy(this.viewpoint,c);this.transition=new m(this.viewpoint,a,b&&b.duration||this.duration,b&&b.easing||this.easing);this.animation&&(this.animation.stop(),this.animation=null);a=this.animation=new k({target:a.clone()});
a.always(function(){this._updateTask&&(this._updateTask.pause(),this.animation=null)}.bind(this));this._startTime=h();this._updateTask.resume();return a},_postRender:function(a){a=this.animation;if(!a||a.state===k.STOPPED)this._updateTask.pause();else{a=(h()-this._startTime)/this.transition.duration;var c=1<=a;this.transition.applyRatio(this.viewpoint,a);this.animation._dfd.progress(this.viewpoint);c&&this.animation.finish()}}})});