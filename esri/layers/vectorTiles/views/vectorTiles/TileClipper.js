// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/vectorTiles/TileClipper",["require","exports","./Geometry","./GeometryUtils"],function(r,v,p,t){var u=function(){return function(c,a,b){this.ratio=c;this.x=a;this.y=b}}();r=function(){function c(a,b,g){this.dz=a;this.yPos=b;this.xPos=g}c.prototype.setExtent=function(a){this.finalRatio=4096/a*(1<<this.dz);var b;b=64/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+
a+2*b};c.prototype.reset=function(a){this.type=a;this._prevIsIn=!1;this.lines=[];this.line=null};c.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new p.Point(a,b);this._firstPt=new p.Point(a,b)};c.prototype.lineTo=function(a,b){var g=this._isIn(a,b),e,f,l,d,h,c;if(g)this._prevIsIn?this._lineTo(a,b,!0):(e=this._prevPt,f=new p.Point(a,b),l=this._intersect(f,e),this._lineTo(l.x,l.y,!0),this._lineTo(f.x,f.y,!0));else{if(this._prevIsIn)f=
this._prevPt,e=new p.Point(a,b),l=this._intersect(f,e),this._lineTo(l.x,l.y,!0);else{var k=this._prevPt;e=new p.Point(a,b);if(!(k.x<=this.xmin&&e.x<=this.xmin||k.x>=this.xmax&&e.x>=this.xmax||k.y<=this.ymin&&e.y<=this.ymin||k.y>=this.ymax&&e.y>=this.ymax)){f=[];if(k.x<this.xmin&&e.x>this.xmin||k.x>this.xmin&&e.x<this.xmin)l=(this.xmin-k.x)/(e.x-k.x),c=k.y+l*(e.y-k.y),c<=this.ymin?h=!1:c>=this.ymax?h=!0:f.push(new u(l,this.xmin,c));if(k.x<this.xmax&&e.x>this.xmax||k.x>this.xmax&&e.x<this.xmax)l=(this.xmax-
k.x)/(e.x-k.x),c=k.y+l*(e.y-k.y),c<=this.ymin?h=!1:c>=this.ymax?h=!0:f.push(new u(l,this.xmax,c));if(k.y<this.ymin&&e.y>this.ymin||k.y>this.ymin&&e.y<this.ymin)l=(this.ymin-k.y)/(e.y-k.y),c=k.x+l*(e.x-k.x),c<=this.xmin?d=!1:c>=this.xmax?d=!0:f.push(new u(l,c,this.ymin));if(k.y<this.ymax&&e.y>this.ymax||k.y>this.ymax&&e.y<this.ymax)l=(this.ymax-k.y)/(e.y-k.y),c=k.x+l*(e.x-k.x),c<=this.xmin?d=!1:c>=this.xmax?d=!0:f.push(new u(l,c,this.ymax));if(0===f.length)d?h?this._lineTo(this.xmax,this.ymax,!0):
this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<f.length&&f[0].ratio>f[1].ratio)this._lineTo(f[1].x,f[1].y,!0),this._lineTo(f[0].x,f[0].y,!0);else for(l=0;l<f.length;l++)this._lineTo(f[l].x,f[l].y,!0)}}this._lineTo(e.x,e.y,!1)}this._prevIsIn=g;this._prevPt=new p.Point(a,b)};c.prototype.close=function(){var a,b;if(0<this.line.length&&(a=this._firstPt,b=this._prevPt,(a.x!==b.x||a.y!==b.y)&&this.lineTo(a.x,a.y),a=this.line,b=
a.length,4<=b&&(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)))a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y};c.prototype.result=function(){this._pushLine();if(0===this.lines.length)return null;3===this.type&&w.simplify(this.margin*this.finalRatio,this.lines);return this.lines};c.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};c.prototype._intersect=function(a,b){var g,e;if(b.x>=this.xmin&&b.x<=this.xmax)e=b.y<=this.ymin?this.ymin:this.ymax,
g=a.x+(e-a.y)/(b.y-a.y)*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)g=b.x<=this.xmin?this.xmin:this.xmax,e=a.y+(g-a.x)/(b.x-a.x)*(b.y-a.y);else{e=b.y<=this.ymin?this.ymin:this.ymax;g=b.x<=this.xmin?this.xmin:this.xmax;var f=(g-a.x)/(b.x-a.x),c=(e-a.y)/(b.y-a.y);f<c?e=a.y+f*(b.y-a.y):g=a.x+c*(b.x-a.x)}return new p.Point(g,e)};c.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&this.lines.push(this.line):2===this.type?1<this.line.length&&this.lines.push(this.line):3===
this.type&&3<this.line.length&&this.lines.push(this.line));this.line=[]};c.prototype._moveTo=function(a,b,g){3!==this.type?g&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new p.Point(a,b))):(g||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),
this.line.push(new p.Point(a,b)),this._is_v=this._is_h=!1)};c.prototype._lineTo=function(a,b,g){if(3!==this.type)if(g){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(g=this.line[this.line.length-1],g.equals(a,b)))return;this.line.push(new p.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(g||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&
(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){g=this.line[this.line.length-1];var e=g.x===a,f=g.y===b;if(!e||!f)this._is_h&&e?(g.x=a,g.y=b,g=this.line[this.line.length-2],this._is_h=g.x===a,this._is_v=g.y===b):this._is_v&&f?(g.x=a,g.y=b,g=this.line[this.line.length-2],this._is_h=g.x===a,this._is_v=g.y===b):(this.line.push(new p.Point(a,b)),this._is_h=e,this._is_v=f)}else this.line.push(new p.Point(a,
b))};return c}();v.TileClipper=r;r=function(){function c(){}c.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};c.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};c.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var g=this._ratio;this.line.push(new p.Point(Math.round(a*g),Math.round(b*g)))};c.prototype.lineTo=function(a,b){var g=this._ratio;this.line.push(new p.Point(Math.round(a*g),Math.round(b*g)))};c.prototype.close=function(){var a=
this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};c.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&w.simplify(64,this.lines);return this.lines};return c}();v.SimpleBuilder=r;var w=function(){function c(){}c.simplify=function(a,b){if(b){for(var g=-a,e=4096+a,f=-a,l=4096+a,d=[],h=[],p=b.length,k=0;k<p;++k){var s=b[k];if(s&&!(2>s.length))for(var n=s[0],q=void 0,r=s.length,m=1;m<r;++m)q=s[m],n.x===q.x&&(n.x<=
g&&(n.y>q.y?(d.push(k),d.push(m),d.push(0),d.push(-1)):(h.push(k),h.push(m),h.push(0),h.push(-1))),n.x>=e&&(n.y<q.y?(d.push(k),d.push(m),d.push(1),d.push(-1)):(h.push(k),h.push(m),h.push(1),h.push(-1)))),n.y===q.y&&(n.y<=f&&(n.x<q.x?(d.push(k),d.push(m),d.push(2),d.push(-1)):(h.push(k),h.push(m),h.push(2),h.push(-1))),n.y>=l&&(n.x>q.x?(d.push(k),d.push(m),d.push(3),d.push(-1)):(h.push(k),h.push(m),h.push(3),h.push(-1)))),n=q}0===d.length||0===h.length||(c.fillParent(b,h,d),c.fillParent(b,d,h),g=[],
c.calcDeltas(g,h,d),c.calcDeltas(g,d,h),c.addDeltas(g,b))}};c.fillParent=function(a,b,g){for(var e=g.length,f=b.length,c=0;c<f;c+=4){for(var d=b[c],h=b[c+1],p=b[c+2],k=a[d][h-1],d=a[d][h],h=8092,s=-1,n=0;n<e;n+=4)if(g[n+2]===p){var q=g[n],r=g[n+1],m=a[q][r-1],q=a[q][r];switch(p){case 0:case 1:t.between(k.y,m.y,q.y)&&t.between(d.y,m.y,q.y)&&(m=Math.abs(q.y-m.y),m<h&&(h=m,s=n));break;case 2:case 3:t.between(k.x,m.x,q.x)&&t.between(d.x,m.x,q.x)&&(m=Math.abs(q.x-m.x),m<h&&(h=m,s=n))}}b[c+3]=s}};c.calcDeltas=
function(a,b,g){for(var e=b.length,f=0;f<e;f+=4){var l=c.calcDelta(f,b,g,[]);a.push(b[f]);a.push(b[f+1]);a.push(b[f+2]);a.push(l)}};c.calcDelta=function(a,b,g,e){a=b[a+3];if(-1===a)return 0;var f=e.length;if(1<f&&e[f-2]===a)return 0;e.push(a);return c.calcDelta(a,g,b,e)+1};c.addDeltas=function(a,b){for(var c=a.length,e=0,f=0;f<c;f+=4){var l=a[f+3];l>e&&(e=l)}for(f=0;f<c;f+=4){var d=b[a[f]],h=a[f+1],l=e-a[f+3];switch(a[f+2]){case 0:d[h-1].x-=l;d[h].x-=l;break;case 1:d[h-1].x+=l;d[h].x+=l;break;case 2:d[h-
1].y-=l;d[h].y-=l;break;case 3:d[h-1].y+=l,d[h].y+=l}}c=b.length;for(e=0;e<c;++e)(d=b[e])&&!(2>d.length)&&d[d.length-1].x!==d[0].x&&d[d.length-1].y!==d[0].y&&d.push(d[0])};return c}()});