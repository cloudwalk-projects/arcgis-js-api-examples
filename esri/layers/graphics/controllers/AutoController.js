// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require ../../../core/declare dojo/Deferred ../../../request ../../../core/Accessoire ../../../core/AccessoirePromise".split(" "),function(e,f,g,h,k,l){return f([k,l],{initialize:function(){var a=this,b=this.layer.then(function(){return a._getFeatureCount().then(function(c){c=a._canUseSnapshot(c&&c.count)?0:1;return a._createController(c)})}).then(function(c){a.activeController=c});this.addResolvingPromise(b)},controllerModulePaths:{"0":"./SnapshotController",1:"./OnDemandController"},_getFeatureCount:function(){var a=
this.layer,b=a.timeDefinition;return h(a.source.parsedUrl.path+"/query",{query:{f:"json",where:a.definitionExpression||"1\x3d1",timeExtent:b&&b.toJSON(),returnCountOnly:!0},callbackParamName:"callback"}).then(function(a){return a.data})},_canUseSnapshot:function(a){var b=this.layer,c=b.geometryType;return("polyline"===c||"polygon"===c||"multipoint"===c)&&a<=b.maxRecordCountForAuto||"point"===c&&a<=b.maxPointCountForAuto},_createController:function(a){var b=new g;(a=this.controllerModulePaths[a])?
e([a],function(a){var d=new a({layer:this.layer,layerView:this.layerView});d.then(function(){b.resolve(d)},function(a){b.reject(a)})}.bind(this)):b.reject(Error('Module path not found for controller type: "'+this.mode+'"'));return b.promise}})});