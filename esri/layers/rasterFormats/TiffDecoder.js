// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterFormats/TiffDecoder",["./Jpg","./Zlib"],function(Ma,ia){var Na=function(){var a=new ArrayBuffer(4),g=new Uint8Array(a),a=new Uint32Array(a);g[0]=1;g[1]=2;g[2]=3;g[3]=4;return 67305985===a[0]},db=function(){var a=[];a[254]="NEWSUBFILETYPE";a[255]="SUBFILETYPE";a[256]="IMAGEWIDTH";a[257]="IMAGELENGTH";a[258]="BITSPERSAMPLE";a[259]="COMPRESSION";a[262]="PHOTOMETRICINTERPRETATION";a[263]="THRESHHOLDING";a[264]="CELLWIDTH";a[265]="CELLLENGTH";a[266]="FILLORDER";a[269]="DOCUMENTNAME";
a[270]="IMAGEDESCRIPTION";a[271]="MAKE";a[272]="MODEL";a[273]="STRIPOFFSETS";a[274]="ORIENTATION";a[277]="SAMPLESPERPIXEL";a[278]="ROWSPERSTRIP";a[279]="STRIPBYTECOUNTS";a[280]="MINSAMPLEVALUE";a[281]="MAXSAMPLEVALUE";a[282]="XRESOLUTION";a[283]="YRESOLUTION";a[284]="PLANARCONFIGURATION";a[285]="PAGENAME";a[286]="XPOSITION";a[287]="YPOSITION";a[288]="FREEOFFSETS";a[289]="FREEBYTECOUNTS";a[290]="GRAYRESPONSEUNIT";a[291]="GRAYRESPONSECURVE";a[292]="T4OPTIONS";a[293]="T6OPTIONS";a[296]="RESOLUTIONUNIT";
a[297]="PAGENUMBER";a[300]="COLORRESPONSEUNIT";a[301]="TRANSFERFUNCTION";a[305]="SOFTWARE";a[306]="DATETIME";a[315]="ARTIST";a[316]="HOSTCOMPUTER";a[317]="PREDICTOR";a[318]="WHITEPOINT";a[319]="PRIMARYCHROMATICITIES";a[320]="COLORMAP";a[321]="HALFTONEHINTS";a[322]="TILEWIDTH";a[323]="TILELENGTH";a[324]="TILEOFFSETS";a[325]="TILEBYTECOUNTS";a[326]="BADFAXLINES";a[327]="CLEANFAXDATA";a[328]="CONSECUTIVEBADFAXLINES";a[330]="SUBIFD";a[332]="INKSET";a[333]="INKNAMES";a[334]="NUMBEROFINKS";a[336]="DOTRANGE";
a[337]="TARGETPRINTER";a[338]="EXTRASAMPLES";a[339]="SAMPLEFORMAT";a[340]="SMINSAMPLEVALUE";a[341]="SMAXSAMPLEVALUE";a[342]="TRANSFERRANGE";a[347]="JPEGTABLES";a[512]="JPEGPROC";a[513]="JPEGIFOFFSET";a[514]="JPEGIFBYTECOUNT";a[515]="JPEGRESTARTINTERVAL";a[517]="JPEGLOSSLESSPREDICTORS";a[518]="JPEGPOINTTRANSFORM";a[519]="JPEGQTABLES";a[520]="JPEGDCTABLES";a[521]="JPEGACTABLES";a[529]="YCBCRCOEFFICIENTS";a[530]="YCBCRSUBSAMPLING";a[531]="YCBCRPOSITIONING";a[532]="REFERENCEBLACKWHITE";a[33550]="GEOPIXELSCALE";
a[33922]="GEOTIEPOINTS";a[33432]="COPYRIGHT";a[42112]="GDAL_METADATA";a[42113]="GDAL_NODATA";a[50844]="RPCCOEFFICIENT";a[34735]="GEOKEYDIRECTORY";a[34736]="GEODOUBLEPARAMS";a[34737]="GEOASCIIPARAMS";return a}(),Oa=[0,1,1,2,4,8,1,1,2,4,8,4,8],Pa=function(a,g){var s="UNKNOWN";3===a?s="F32":1===a?8>=g?s="U8":16>=g?s="U16":32>=g&&(s="U32"):2===a&&(8>=g?s="S8":16>=g?s="S16":32>=g&&(s="S32"));return s};return{decode:function(a){var g,s=new DataView(a,0,8),Qa=s.getUint16(0,!1),V;if(18761===Qa)V=!0;else if(19789===
Qa)V=!1;else throw"unexpected endianess byte";if(42!==s.getUint16(2,V))throw"unexpected tiff identifier";var eb=s.getUint32(4,V);g=V;var W,va,X,wa,Y,ja,Z,Ra,Sa,xa,$;W=eb;for(var ya=[];W;){va=(new DataView(a,W,2)).getUint16(0,g);X=W+2;W=(new DataView(a,X+12*va,4)).getUint32(0,g);xa={};for(wa=0;wa<va;wa++)if(Y=new DataView(a,X,12),ja=Y.getUint16(0,g),Z=Y.getUint16(2,g),Ra=Y.getUint32(4,g),Sa=Y.getUint32(8,g),X+=12,!(7===Z||12<Z)){var fb=$={fieldTag:ja,fieldType:Z,fieldValueCount:Ra,fieldValueOffset:Sa},
r=a,w=g,Q=[],ka=$.fieldType,la=$.fieldValueCount,R=$.fieldValueOffset,n=R,za=Oa[ka],Ta=8*za,gb=la*za,Ua=8*la*Oa[ka],q=void 0,D=void 0;if(32>=Ua)if(w||(R>>>=32-Ua),1===la)Q=[R];else for(D=0;D<la;D++)Q.push(R<<Ta*D>>>32-Ta);else for(n=R;n<R+gb;n+=za){switch(ka){case 1:q=(new DataView(r,n,1)).getUint8(0);break;case 2:q=(new DataView(r,n,1)).getUint8(0);break;case 3:q=(new DataView(r,n,2)).getUint16(0,w);break;case 4:q=(new DataView(r,n,4)).getUint32(0,w);break;case 5:q=(new DataView(r,n,4)).getUint32(0,
w)/(new DataView(r,n+4,4)).getUint32(0,w);break;case 6:q=(new DataView(r,n,1)).getInt8(0);break;case 8:q=(new DataView(r,n,2)).getInt16(0,w);break;case 9:q=(new DataView(r,n,4)).getInt32(0,w);break;case 10:q=(new DataView(r,n,4)).getInt32(0,w)/(new DataView(r,n+4,4)).getInt32(0,w);break;case 11:q=(new DataView(r,n,4)).getFloat32(0,w);break;case 12:q=(new DataView(r,n,8)).getFloat64(0,w);break;case 7:q=null;break;default:q=null}Q.push(q)}if(2===ka)for(var ma="",Aa=Q,Q=[],D=0;D<Aa.length;D++)0===Aa[D]?
(Q.push(ma),ma=""):ma+=String.fromCharCode(Aa[D]);fb.fieldValues=Q;var hb=xa,Ba=db[ja];void 0===Ba&&(Ba="unknown"+ja);hb[Ba]={type:Z,values:$.fieldValues}}ya.push(xa)}if(0===ya.length)throw"no valid image file directory";var x,h,b=ya[0],S=void 0===b.GDAL_NODATA||null===b.GDAL_NODATA?null:parseFloat(b.GDAL_NODATA.values[0]);if(b.TILEOFFSETS){var Va,z,E,ib=Na()===g,H=b.TILEOFFSETS?b.TILEOFFSETS.values:void 0;if(void 0===H)h=void 0;else{var I=b.TILEBYTECOUNTS.values,J=b.TILEWIDTH.values[0],T=b.TILELENGTH.values[0],
U=b.IMAGEWIDTH.values[0],Ca=b.IMAGELENGTH.values[0],F=U*Ca,t=b.BITSPERSAMPLE.values[0],m=b.SAMPLESPERPIXEL.values[0],aa=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1,na=Pa(aa,t);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var y=b.COMPRESSION?b.COMPRESSION.values[0]:1;if(!(1===y||6===y||8===y||32946===y))throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";
if(3<aa)h=void 0;else{3===aa?(z=new Float32Array(F*m),E=Float32Array):1===aa?8>=t?(z=new Uint8Array(F*m),E=Uint8Array):16>=t?(z=new Uint16Array(F*m),E=Uint16Array):32>=t&&(z=new Uint32Array(F*m),E=Uint32Array):2===aa&&(8>=t?(z=new Int8Array(F*m),E=Int8Array):16>=t?(z=new Int16Array(F*m),E=Int16Array):32>=t&&(z=new Int32Array(F*m),E=Int32Array));var d,ba,k,ca,Da,Ea,Fa,Wa,Ga,Ha,Xa,Ya,A,e,K,Ia,oa,Ja,Za=Math.ceil(U/J);if(0===t%8)for(d=0;d<H.length;d++){Ea=Math.floor(d/Za)*T;Fa=d%Za*J;Wa=(Ea*U+Fa)*m;if("U8"===
na||"S8"===na||ib)if(8===y||32946===y)e=new Uint8Array(a,H[d],I[d]),oa=new ia(e),Ja=oa.getBytes(),A=new ArrayBuffer(Ja.length),e=new Uint8Array(A),e.set(Ja),e.length!==J*T*m*t/8&&console.log("tile byte counts is different than expected");else if(6===y){e=new Uint8Array(a,H[d],I[d]);var pa=new Ma;pa.parse(e);var $a=pa.getData(pa.width,pa.height);A=new ArrayBuffer($a.length);e=new Uint8Array(A);e.set($a)}else 1===y&&(I[d]!==J*T*m*t/8&&console.log("tile byte counts is different than expected"),A=a.slice(H[d],
H[d]+I[d]));else switch(8===y||32946===y?(e=new Uint8Array(a,H[d],I[d]),oa=new ia(e),e=oa.getBytes(),A=new ArrayBuffer(e.length),K=new Uint8Array(A),e.length!==J*T*m*t/8&&console.log("tile byte counts is different than expected")):1===y&&(I[d]!==J*T*m*t/8&&console.log("tile byte counts is different than expected"),A=new ArrayBuffer(I[d]),e=new Uint8Array(a,H[d],I[d]),K=new Uint8Array(A)),na){case "U16":case "S16":for(k=0;k<e.length;k+=2)K[k]=e[k+1],K[k+1]=e[k];break;case "U32":case "S32":case "F32":for(k=
0;k<e.length;k+=4)K[k]=e[k+3],K[k+1]=e[k+2],K[k+2]=e[k+1],K[k+3]=e[k]}Va=new E(A);Ya=Math.min(J,U-Fa);Xa=Math.min(T,Ca-Ea);for(ca=0;ca<Xa;ca++){Ga=Wa+ca*U*m;Ha=ca*J*m;for(Da=0;Da<Ya*m;Da++,Ga++,Ha++)z[Ga]=Va[Ha]}}var qa={width:U,height:Ca,pixelType:na};if(1===m)qa.pixels=[z];else{qa.pixels=[];for(d=0;d<m;d++){Ia=new E(F);for(ba=0;ba<F;ba++)Ia[ba]=z[ba*m+d];qa.pixels.push(Ia)}}h=qa}}}else if(b.STRIPOFFSETS){var ab,B,G,jb=Na()===g,L=b.STRIPOFFSETS?b.STRIPOFFSETS.values:void 0;if(void 0===L)h=void 0;
else{var M=b.STRIPBYTECOUNTS.values,da=b.ROWSPERSTRIP.values,N=b.IMAGEWIDTH.values[0],ea=b.IMAGELENGTH.values[0],O=N*ea,u=b.BITSPERSAMPLE.values[0],p=b.SAMPLESPERPIXEL.values[0],fa=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1,ra=Pa(fa,u);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var v=b.COMPRESSION?b.COMPRESSION.values[0]:1;if(!(1===v||6===v||8===v||32946===v))throw console.log("compressed tiff is not supported at this moment"),
"compressed tiff is not supported at this moment";if(3<fa)h=void 0;else{3===fa?(B=new Float32Array(O*p),G=Float32Array):1===fa?8>=u?(B=new Uint8Array(O*p),G=Uint8Array):16>=u?(B=new Uint16Array(O*p),G=Uint16Array):32>=u&&(B=new Uint32Array(O*p),G=Uint32Array):2===fa&&(8>=u?(B=new Int8Array(O*p),G=Int8Array):16>=u?(B=new Int16Array(O*p),G=Int16Array):32>=u&&(B=new Int32Array(N*ea*p),G=Int32Array));var c,ga,l,bb,C,f,P,Ka,sa,La,ha=da;if(0===u%8)for(c=0;c<L.length;c++){bb=c*(da*N)*p;ha=(c+1)*da>ea?ea-
c*da:da;if("U8"===ra||"S8"===ra||jb)if(8===v||32946===v)f=new Uint8Array(a,L[c],M[c]),sa=new ia(f),La=sa.getBytes(),C=new ArrayBuffer(La.length),f=new Uint8Array(C),f.set(La),f.length!==ha*N*p*u/8&&console.log("strip byte counts is different than expected");else if(6===v){f=new Uint8Array(a,L[c],M[c]);var ta=new Ma;ta.parse(f);var cb=ta.getData(ta.width,ta.height);C=new ArrayBuffer(cb.length);f=new Uint8Array(C);f.set(cb)}else 1===v&&(M[c]!==ha*N*p*u/8&&console.log("strip byte counts is different than expected"),
C=a.slice(L[c],L[c]+M[c]));else switch(6===v||8===v||32946===v?(f=new Uint8Array(a,L[c],M[c]),sa=new ia(f),f=sa.getBytes(),C=new ArrayBuffer(f.length),P=new Uint8Array(C),f.length!==ha*N*p*u/8&&console.log("strip byte counts is different than expected")):1===v&&(M[c]!==ha*N*p*u/8&&console.log("strip byte counts is different than expected"),C=new ArrayBuffer(M[c]),f=new Uint8Array(a,L[c],M[c]),P=new Uint8Array(C)),ra){case "U16":case "S16":for(l=0;l<f.length;l+=2)P[l]=f[l+1],P[l+1]=f[l];break;case "U32":case "S32":case "F32":for(l=
0;l<f.length;l+=4)P[l]=f[l+3],P[l+1]=f[l+2],P[l+2]=f[l+1],P[l+3]=f[l]}ab=new G(C);B.set(ab,bb)}var ua={width:N,height:ea,pixelType:ra};if(1===p)ua.pixels=[B];else{ua.pixels=[];for(c=0;c<p;c++){Ka=new G(O);for(ga=0;ga<O;ga++)Ka[ga]=B[ga*p+c];ua.pixels.push(Ka)}}h=ua}}}if(null!==S){h.maskData=new Uint8Array(h.width*h.height);if(1E24<Math.abs(S))for(x=0;x<h.width*h.height;x++)1E-6>Math.abs((h.pixels[0][x]-S)/S)?h.maskData[x]=0:h.maskData[x]=1;else for(x=0;x<h.width*h.height;x++)h.maskData[x]=h.pixels[0][x]===
S?0:1;h.noDataValue=S}return h}}});