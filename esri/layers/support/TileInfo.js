// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators ../../geometry/SpatialReference ../../geometry/Point ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(v,w,m,e,n,p,q,r,f,s,h,t,u){var k=q({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",
SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(l){function c(a){l.call(this);this.dpi=96;this.origin=this.format=null;this.maxScale=this.minScale=0;this.spatialReference=this.size=null}m(c,l);Object.defineProperty(c.prototype,"lods",{set:function(a){var b=this,g=0,d=0,c=[];this._levelToLOD={};a&&(g=-Infinity,d=Infinity,a.forEach(function(a){c.push(a.scale);g=a.scale>g?a.scale:g;d=a.scale<d?a.scale:d;b._levelToLOD[a.level]=a}));this._set("scales",c);this._set("minScale",
g);this._set("maxScale",d);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});c.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var c=Math.round(a-0.5),d=Math.round(a);return b[d]+(d-a)*(b[c]-b[d])};c.prototype.scaleToZoom=function(a){for(var b=this.scales,c=b.length-1,d=0;d<c;d++){var f=b[d],e=b[d+1];if(f<=a)break;if(e===a)return d+1;if(f>a&&e<a)return d+1-(a-e)/(f-e)}return d};c.prototype.snapScale=function(a,
b){void 0===b&&(b=0.95);var c=this.scaleToZoom(a);return c%Math.floor(c)>=b?this.zoomToScale(Math.ceil(c)):this.zoomToScale(Math.floor(c))};c.prototype.tileAt=function(a,b,c,d){var e=this.lodAt(a);if(!e)return null;d||(d={id:null,level:0,row:0,col:0,extent:[0,0,0,0]});var f;if("number"===typeof b)f=b,b=c;else{if(b.spatialReference.equals(this.spatialReference))f=b.x,b=b.y;else{d=t.project(b,this.spatialReference);if(!d)return null;f=d.x;b=d.y}d=c}c=e.resolution*this.size[0];e=e.resolution*this.size[1];
d.level=a;d.row=Math.floor((this.origin.y-b)/e+0.001);d.col=Math.floor((f-this.origin.x)/c+0.001);this.updateTileInfo(d);return d};c.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level),c=b.resolution*this.size[0],b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=[0,0,0,0]);a.extent[0]=this.origin.x+a.col*c;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=a.extent[0]+c;a.extent[3]=a.extent[1]+b};c.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];
if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+0.001);a.col=Math.floor(a.col/b.factor+0.001);this.updateTileInfo(a);return!0};c.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};c.prototype.clone=function(){return c.fromJSON(this.toJSON())};c.prototype.toJSON=function(){return r.fixJson({rows:this.size[0],cols:this.size[1],dpi:this.dpi,format:k.toJSON(this.format),compressionQuality:this.compressionQuality,origin:this.origin&&
this.origin.toJSON(),spatialReference:this.spatialReference&&this.spatialReference.toJSON(),lods:this.lods&&this.lods.map(function(a){return a.toJSON()})})};c.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,c=0;c<a.length;c++){var d=a[c];this._upsampleLevels[d.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};e([f.property()],c.prototype,"compressionQuality",void 0);e([f.property()],c.prototype,"dpi",void 0);e([f.property({json:{read:k.fromJSON}})],
c.prototype,"format",void 0);e([f.property({type:h,json:{read:function(a,b){return h.fromJSON(n.mixin({spatialReference:b.spatialReference},a))}}})],c.prototype,"origin",void 0);e([f.property({type:[u],value:null})],c.prototype,"lods",null);e([f.property({readOnly:!0})],c.prototype,"minScale",void 0);e([f.property({readOnly:!0})],c.prototype,"maxScale",void 0);e([f.property({readOnly:!0})],c.prototype,"scales",void 0);e([f.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,
a]:[256,256]},json:{readFrom:["rows","cols"],read:function(a,b){return[b.cols,b.rows]}}})],c.prototype,"size",void 0);e([f.property({type:s})],c.prototype,"spatialReference",void 0);return c=e([f.subclass("esri.layers.support.TileInfo")],c)}(f.declared(p))});