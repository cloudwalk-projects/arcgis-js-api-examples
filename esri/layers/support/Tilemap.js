// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../request ../../core/lang ../../core/Error".split(" "),function(l,g,n,p,q,e){function m(b){var a=b.service.tileServers,a=(a&&a.length?a[b.row%a.length]:b.service.url)+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height;(b=b.service.query)&&(a=a+"?"+b);return a}l=function(){function b(){this.location={left:0,top:0,width:0,height:0};this.byteSize=40}b.prototype.getAvailability=function(a,b){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";
var h=(a-this.location.top)*this.location.width+(b-this.location.left),d=h>>3,f=this._tileAvailabilityBitSet;return 0>d||d>f.length?"unknown":f[d]&1<<h%8?"available":"unavailable"};b.prototype._updateFromData=function(a){for(var b=!0,h=!0,d=Math.ceil(this.location.width*this.location.height/8),d=new Uint8Array(d),f=0,k=0;k<a.length;k++){var e=k%8;a[k]?(h=!1,d[f]|=1<<e):b=!1;7===e&&++f}this._isAllUnvailable=h;this._isAllAvailable=b;!this._isAllAvailable&&!this._isAllUnvailable&&(this._tileAvailabilityBitSet=
d,this.byteSize+=d.length)};b.fromDefinition=function(a,c){var h=a.service.request||p,d=a.row,f=a.col,k=a.width,g=a.height,l={failOk:!0,callbackParamName:"callback"};c=c?n.mixin(l,c):l;return h(m(a),c).then(function(a){var c=a.data;if(c.location&&(c.location.top!==d||c.location.left!==f||c.location.width!==k||c.location.height!==g))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:d,left:f,width:k,height:g}});return b.fromJSON(a.data)})};
b.fromJSON=function(a){b.validateJSON(a);var c=new b;c.location=Object.freeze(q.clone(a.location));c._updateFromData(a.data);return Object.freeze(c)};b.validateJSON=function(a){if(!a||!a.location)throw new e("tilemap:missing-location","Location missing from tilemap response");if(!a.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new e("tilemap:data-mismatch",
"Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return b}();g.Tilemap=l;g.tilemapDefinitionId=function(b){return b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height};g.tilemapDefinitionUrl=m;Object.defineProperty(g,"__esModule",{value:!0});g.default=l});