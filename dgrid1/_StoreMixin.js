//>>built
define("dgrid1/_StoreMixin","dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(r,l,p,s,n,v,q,t){function u(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;q.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return r(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",
loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};s.before(this,"configStructure",l.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_setCollection:function(a){this._renderedCollection&&(this.cleanup(),
this._cleanupCollection({shouldRevert:!a||a.storage!==this._renderedCollection.storage}));this.collection=a;if(this._started){if(a){var d=a;this.sort&&0<this.sort.length&&(d=a.sort(this.sort));d.track&&this.shouldTrackCollection&&(d=d.track(),this._rows=[],this._observerHandle=this._observeCollection(d,this.contentNode,{rows:this._rows}));this._renderedCollection=d}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},
_getTotal:function(){return this._total},_cleanupCollection:function(a){a=a||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=null);!1!==a.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},
_emitRefreshComplete:function(){var a=this;this._refreshTimeout=setTimeout(function(){q.emit(a.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:a});a._refreshTimeout=null},0)},_insertNoDataNode:function(a){a=a||this.contentNode;var d=this.noDataNode=n.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});a.insertBefore(d,this._getFirstRowSibling&&this._getFirstRowSibling(a));return d},row:function(){var a=this.inherited(arguments);a&&(a.data&&"undefined"!==typeof a.id)&&
(a.id=this.collection.getIdentity(a.data));return a},refresh:function(){var a=this.inherited(arguments);this.collection||this._insertNoDataNode();return a},refreshCell:function(a){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(a.row.id).then(l.hitch(this,"_refreshCellFromItem",a))},_refreshCellFromItem:function(a,d,f){var e=a.element;n.empty(e);var b=this.dirty&&this.dirty[a.row.id];b&&
(d=l.delegate(d,b));this._createBodyRowCell(e,a.column,d,f)},renderArray:function(){var a=this.inherited(arguments);this.collection||a.length&&this.noDataNode&&n.destroy(this.noDataNode);return a},insertRow:function(a,d,f,e,b){var g=this.collection,k=this.dirty,g=g&&g.getIdentity(a),m;g in k&&!(g in this._updating)&&(m=k[g]);m&&(a=l.delegate(a,m));k=this.inherited(arguments);b&&b.rows&&(b.rows[e]=k);this.noDataNode&&(n.destroy(this.noDataNode),this.noDataNode=null);return k},updateDirty:function(a,
d,f){var e=this.dirty,b=e[a];b||(b=e[a]={});b[d]=f},save:function(){function a(a,b){return function(c){var m=d._columnsWithSet,h=d._updating,k,l;if("function"===typeof c.set)c.set(b);else for(k in b)c[k]=b[k];for(k in m)l=m[k].set(c),void 0!==l&&(c[k]=l);h[a]=!0;return f.put(c).then(function(b){delete e[a];delete h[a];g[a]=b;return g})}}var d=this,f=this.collection,e=this.dirty,b=new p,g={},k=function(a){var b;return d.getBeforePut||!(b=d.row(a).data)?function(){return f.get(a)}:function(){return b}},
m=b.then(function(){return g}),c;for(c in e)var h=a(c,e[c]),m=m.then(k(c)).then(h);b.resolve();return m},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){"string"===typeof a&&(a=l.hitch(this,a));var d=this,f;try{f=t(a())}catch(e){a=new p,a.reject(e),f=a.promise}f.otherwise(function(a){u.call(d,a)});return f},removeRow:function(a,d,f){var e={element:a};!d&&(this.up(e).element===a&&this.down(e).element===a)&&this._insertNoDataNode();(e=f&&f.rows||this._rows)&&delete e[a.rowIndex];
return this.inherited(arguments)},renderQueryResults:function(a,d,f){f=l.mixin({rows:this._rows},f);var e=this;return a.then(function(a){a=e.renderArray(a,d,f);delete e._lastCollection;return a})},_observeCollection:function(a,d,f){var e=this,b=f.rows,g,k=[a.on("delete, update",function(a){var c=a.previousIndex,h=a.index;void 0!==c&&b[c]&&("max"in b&&(void 0===h||h<b.min||h>b.max)&&b.max--,g=b[c],g.parentNode===d&&e.removeRow(g,!1,f),b.splice(c,1),("delete"===a.type||"update"===a.type&&(c<h||void 0===
h))&&b[c]&&b[c].rowIndex--);"delete"===a.type&&(g=null)}),a.on("add, update",function(a){var c=a.previousIndex,h=a.index;if(void 0!==h&&(!("max"in b)||h>=b.min&&h<=b.max)){"max"in b&&(void 0===c||c<b.min||c>b.max)&&b.max++;if(b.length){if(c=b[h],!c&&(c=b[h-1]))c=(c.connected||c).nextSibling}else c=e._getFirstRowSibling&&e._getFirstRowSibling(d);g&&(c&&g.id===c.id)&&(c=(c.connected||c).nextSibling);c&&!c.parentNode&&(c=document.getElementById(c.id));b.splice(h,0,void 0);g=e.insertRow(a.target,d,c,
h,f);e.highlightRow(g)}g=null}),a.on("add, delete, update",function(d){var c="undefined"!==typeof d.previousIndex?d.previousIndex:Infinity,f="undefined"!==typeof d.index?d.index:Infinity,g=Math.min(c,f);c!==f&&b[g]&&e.adjustRowIndices(b[g]);Infinity!==c&&(e._processScroll&&(b[c]||b[c-1]))&&e._processScroll();e._onNotification(b,d,a);a===e._renderedCollection&&"totalLength"in d&&(e._total=d.totalLength)})];return{remove:function(){for(;0<k.length;)k.pop().remove()}}},_onNotification:function(){}})});